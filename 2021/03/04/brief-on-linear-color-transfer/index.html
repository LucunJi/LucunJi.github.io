<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lucunji.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.3.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":6,"width":260},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="前阵子做了一个关于线性颜色转移（Linear Color Transfer）的期末研究，准备闲下来把相关的东西发到在博客上面，分享的同时顺便帮自己巩固一下知识点。相关的代码可以在这里看到。当时写的 paper 为了充字数写得比较繁琐，也有一些不严谨的问题，因此就不放上来了。这篇博文相当于根据当初 paper 的思路重新梳理一遍。如有錯漏之处烦请斧正。">
<meta property="og:type" content="article">
<meta property="og:title" content="线性颜色转移">
<meta property="og:url" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/index.html">
<meta property="og:site_name" content="LucunJi">
<meta property="og:description" content="前阵子做了一个关于线性颜色转移（Linear Color Transfer）的期末研究，准备闲下来把相关的东西发到在博客上面，分享的同时顺便帮自己巩固一下知识点。相关的代码可以在这里看到。当时写的 paper 为了充字数写得比较繁琐，也有一些不严谨的问题，因此就不放上来了。这篇博文相当于根据当初 paper 的思路重新梳理一遍。如有錯漏之处烦请斧正。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@2x.png">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@2x.png">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/26e3cc77/scotland_plain@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.jpg">
<meta property="og:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.jpg">
<meta property="article:published_time" content="2021-03-05T01:27:03.000Z">
<meta property="article:modified_time" content="2021-05-02T08:13:27.722Z">
<meta property="article:author" content="LucunJi">
<meta property="article:tag" content="CV(computer vision)">
<meta property="article:tag" content="math">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg">


<link rel="canonical" href="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>线性颜色转移 | LucunJi</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="LucunJi" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LucunJi</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档与标签</a></li>
        <li class="menu-item menu-item-booklist"><a href="/booklist/" rel="section"><i class="fas fa-book-open fa-fw"></i>书单</a></li>
        <li class="menu-item menu-item-gallery"><a href="/gallery/" rel="section"><i class="fas fa-images fa-fw"></i>相册</a></li>
        <li class="menu-item menu-item-apps"><a href="/apps/" rel="section"><i class="fas fa-cogs fa-fw"></i>应用</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E8%A7%A3%E6%80%9D%E8%B7%AF1"><span class="nav-number">2.</span> <span class="nav-text">求解思路1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reinhard-%E6%96%B9%E6%B3%952"><span class="nav-number">3.</span> <span class="nav-text">Reinhard 方法2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3%E6%B3%954%E5%92%8C%E5%85%B6%E5%AE%83%E4%B8%80%E4%BA%9B%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">奇异值分解法4和其它一些矩阵分解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E7%9A%84%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3%E6%B3%95"><span class="nav-number">4.1.</span> <span class="nav-text">其它的矩阵分解法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%92%99%E6%97%A5-%E5%BA%B7%E6%89%98%E7%BD%97%E7%BB%B4%E5%A5%87%E8%A7%A3%E6%B3%951"><span class="nav-number">5.</span> <span class="nav-text">蒙日-康托罗维奇解法7</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">6.</span> <span class="nav-text">结语</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LucunJi"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">LucunJi</p>
  <div class="site-description" itemprop="description">“祝我们新年痛苦”</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LucunJi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LucunJi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/2117299/" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;2117299&#x2F;" rel="noopener" target="_blank"><i class="fab bili-tv fa-fw"></i>Bilibili</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://tis.world/" title="https:&#x2F;&#x2F;tis.world" rel="noopener" target="_blank">TIS Union</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://cfpa.team/" title="http:&#x2F;&#x2F;cfpa.team" rel="noopener" target="_blank">CFPA 汉化组</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://xiaoyuan-xyz.github.io/" title="https:&#x2F;&#x2F;xiaoyuan-xyz.github.io" rel="noopener" target="_blank">小渊的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fallenbreath.me/" title="https:&#x2F;&#x2F;fallenbreath.me" rel="noopener" target="_blank">Fallen的博客</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LucunJi">
      <meta itemprop="description" content="“祝我们新年痛苦”">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucunJi">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          线性颜色转移
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-04 19:27:03" itemprop="dateCreated datePublished" datetime="2021-03-04T19:27:03-06:00">2021-03-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 03:13:27" itemprop="dateModified" datetime="2021-05-02T03:13:27-05:00">2021-05-02</time>
      </span>

  
    <span id="/2021/03/04/brief-on-linear-color-transfer/" class="post-meta-item leancloud_visitors" data-flag-title="线性颜色转移" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>前阵子做了一个关于线性颜色转移（Linear Color Transfer）的期末研究，准备闲下来把相关的东西发到在博客上面，分享的同时顺便帮自己巩固一下知识点。相关的代码可以在<a target="_blank" rel="noopener" href="https://github.com/LucunJi/Linear-Color-Transfer-Methods">这里</a>看到。当时写的 paper 为了充字数写得比较繁琐，也有一些不严谨的问题，因此就不放上来了。这篇博文相当于根据当初 paper 的思路重新梳理一遍。如有錯漏之处烦请斧正。</p>
<span id="more"></span>
<h2 id="简介">简介</h2>
<style>
    td {
        text-align: center;
    }
    .post-body>figure>picture>* {
        max-width: 70%;
    }
</style>
<p>首先说明一下线性颜色转移，即 Linear Color Transfer 是什么。</p>
<p>所谓“颜色转移”，就是将一幅图片里的色调、明暗、对比、调色板（palette）等颜色特征，通过一种映射转移到第二幅图片上，从而使第二幅图片拥有与第一幅图片相似的颜色特征。颜色转换的应用场合有色彩修正，黑白图片的染色，调色盘预览等。</p>
<p>上文所说的第一幅图片，即拥有想要的颜色特征的图片，被称作<strong>目标图片</strong>（target image）。有着想要的内容的图片，被称作<strong>源图片</strong>（original image/source image）。最终的输出成功是<strong>转换后图片</strong>（transferred image）。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg" alt="转换后图片（Reinhard）" />
    </picture>
        <figcaption>转换后图片（Reinhard）</figcaption>
</figure>



</td>
</tr>
</table>
<p>如果这种颜色转移是<strong>线性</strong>的，那么说明这种颜色转换等价于一个在色彩空间中的线性映射 <span class="math inline">\(\mathbf{u} \rightarrow \mathbf{Tu}\)</span>。</p>
<h2 id="求解思路1">求解思路<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h2>
<p>如果将颜色特征当作一个多元随机分布，每个像素都是一个三维向量，例如<span class="math inline">\([r, g, b]\)</span>。 设向量 <span class="math inline">\(\mathbf{u}\in\mathbb{R}^3\)</span> 为源图片的随机变量，向量 <span class="math inline">\(\mathbf{v}\in\mathbb{R}^3\)</span> 为转换后的随机变量， 那么可以将颜色转移问题看作一个变量变换： <span class="math display">\[
t(\mathbf{u}) = \mathbf{v}
\]</span> 并列出关于随机分布函数的等式：</p>
<p><span class="math display">\[
\begin{gather}
&amp;P(\mathbf{U} \le \mathbf{u}) = P(t(\mathbf{U}) \le t(\mathbf{u})) = P(\mathbf{V} \le t(\mathbf{u})) = P(\mathbf{V} \le \mathbf{v})\\
\nonumber\Downarrow\\
&amp;F_u(\mathbf{u}) = F_v(t(\mathbf{u})) = F_v(\mathbf{v})
\end{gather}
\]</span> 然后微分，得出密度函数的关系：</p>
<p><span class="math display">\[
\begin{equation}
f_u(\mathbf{u}) = f_v(t(\mathbf{u}))|\det J_t(\mathbf{u})|
\end{equation}
\]</span> 进一步将问题简化到线性变换 <span class="math inline">\(t(\mathbf{u}) = \mathbf{Tu+t_0}\)</span>，雅可比矩阵会与 <span class="math inline">\(3\times3\)</span> 的转换矩阵 <span class="math inline">\(\mathbf{T}\)</span> 相等，其行列式的值会变为常数。<span class="math inline">\(\mathbf{t_0}\in\mathbb{R^3}\)</span> 是一个表示色彩平移量的向量。</p>
<p><span class="math display">\[
\begin{gather}
&amp;|\det J_t(\mathbf{u})| = |\det \mathbf{T}| = c\\
\nonumber\Downarrow\\
&amp;f_u(\mathbf{u}) \varpropto f_v(t(\mathbf{u}))
\label{eq:proportional_1}
\end{gather}
\]</span></p>
<p>为了能近似地求出转换矩阵 <span class="math inline">\(\mathbf{T}\)</span>，假设变量 <span class="math inline">\(\mathbf{U},\mathbf{V}\)</span> 都遵循多元高斯分布。由此可得以下两个新的正比例关系。<span class="math inline">\(\mathbf{\Sigma}\)</span> 为下标对应的变量的协方差矩阵，<span class="math inline">\(\mu\)</span> 为对应的平均值。<span class="math inline">\(exp()\)</span> 是自然底数 <span class="math inline">\(e\)</span> 的幂。 <span class="math display">\[
\begin{gather}
f_u(\mathbf{u}) \varpropto \exp(-\frac{1}{2} (\mathbf{u} - \mu_u)^T \mathbf{\Sigma}^{-1}_u (\mathbf{u} - \mu_u))\label{eq:proportional_2}\\
f_v(\mathbf{v}) \varpropto \exp(-\frac{1}{2} (\mathbf{v} - \mu_v)^T \mathbf{\Sigma}^{-1}_v (\mathbf{v} - \mu_v))
\label{eq:proportional_3}
\end{gather}
\]</span></p>
<p>整理以上的式子<span class="math inline">\((\ref{eq:proportional_1}),(\ref{eq:proportional_2}), (\ref{eq:proportional_3})\)</span>，可解出线性变换函数 <span class="math inline">\(t()\)</span> 和它的转换矩阵 <span class="math inline">\(\mathbf{T}\)</span>：</p>
<p><span class="math display">\[
\begin{gather}
&amp;(\mathbf{u} - \mu_u)^T \mathbf{\Sigma}^{-1}_u (\mathbf{u} - \mu_u) = (t(\mathbf{u}) - \mu_v)^T \mathbf{\Sigma}^{-1}_v (t(\mathbf{u}) - \mu_v)\\
\nonumber\Downarrow\\
&amp;\color{green}\begin{cases}
    t(\mathbf{u}) = \mathbf{T}(\mathbf{u} - \mu_u) + \mu_v\\
    \mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v
\end{cases}
\label{eq:key_equations}
\end{gather}
\]</span></p>
<p>利用分配率不难看出，<span class="math inline">\(\mathbf{T}(\mathbf{u} - \mu_u) + \mu_v = \mathbf{T}\mathbf{u} - \mathbf{T}\mu_u + \mu_v\)</span>，因此上面推导出的关系式完全符合之前假设的方程形式 <span class="math inline">\(t(\mathbf{u}) = \mathbf{Tu+t_0}\)</span>，并且 <span class="math inline">\(\mathbf{t_0} = - \mathbf{T}\mu_u + \mu_v\)</span></p>
<p>严格意义上，<span class="math inline">\(+\mathbf{t_0}\)</span> 进行的平移变换使得 <span class="math inline">\(\mathbf{Tu} + \mathbf{t_0}\)</span> 并不是线性变换。但是如果将三维的颜色向量转换到齐次坐标系 <span class="math inline">\([x, y, z]^T \rightarrow [x, y, z, 1]^T\)</span> 那么就可以将平移变换看作线性变换了： <span class="math display">\[
\begin{gather}
\begin{bmatrix}
    1 &amp; 0 &amp; 0 &amp; t_{01}\\
    0 &amp; 1 &amp; 0 &amp; t_{02}\\
    0 &amp; 0 &amp; 1 &amp; t_{03}\\
    0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\begin{bmatrix}
    x\\ y\\ z\\ 1
\end{bmatrix} = \begin{bmatrix}
    x + t_{01}\\ y + t_{02}\\ z + t_{03}\\ 1
\end{bmatrix} \Longleftarrow \text{等价于} \Longrightarrow \begin{bmatrix}
    x\\ y\\ z
\end{bmatrix} + \begin{bmatrix}
    t_{01}\\ t_{02}\\ t_{03}
\end{bmatrix} = \begin{bmatrix}
    x + t_{01}\\ y + t_{02}\\ z + t_{03}
\end{bmatrix}
\end{gather}
\]</span></p>
<p>在实际操作中，我们不知道转换后图片的协方差和平均值。这里就要用到目标图片了。目标图片相当于提供了一个色彩分布的“范本”。通过计算目标图片的协方差和平均值，可以获取到转换后图片参数的近似值。</p>
<p>至此，我们推导出了关键的关系式 <span class="math inline">\((\ref{eq:key_equations})\)</span>，并同时涉及到了目标图片、源图片和转换后图片。接下来，本文会介绍几种方法来计算出关系式中的矩阵 <span class="math inline">\(\mathbf{T}\)</span>，即对 <span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 一式进行求解。为了方便讨论并尽量减少混淆，下文会分别用下标<span class="math inline">\(tgt, src, trans\)</span>来代表目标图片、源图片和转换后图片。</p>
<h2 id="reinhard-方法2">Reinhard 方法<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></h2>
<p>Reinhard 在他的论文中提出的颜色转移方法简易，色彩转换比较柔和，一般更适用于自然风景的图片。</p>
<p>上个式子中的协方差的矩阵给求解带来了较大的问题。但如果假设三个通道互相独立，那么协方差矩阵会变成一个对角矩阵，问题能被进一步简化成三个独立的高斯变量转换问题。</p>
<p>单变量高斯分布，或者说正态分布的标准化计算为 <span class="math inline">\(z = \frac{x-\mu}{\sigma}\)</span>。那么先用一组平均值和标准差，<span class="math inline">\(\mu, \sigma\)</span>，将源图片单一通道的色彩分布进行正态化，再用另一组 <span class="math inline">\(\mu, \sigma\)</span> 参数进行反向操作，就能进行变换。下面的等式中， <span class="math inline">\(c\)</span> 表示任意一个独立的颜色通道，即 channel 的缩写；<span class="math inline">\(n\)</span> 是被操作的像素在图片中的序号。 <span class="math display">\[
\begin{equation}
\mathbf{c}_{trans}[n] = \frac{\sigma^c_{tgt}}{\sigma^c_{src}}(\mathbf{c}_{src}[n] - \mu^c_{src}) + \mu^c_{tgt}
\end{equation}
\]</span></p>
<p>如果用之前的关系式 <span class="math inline">\((\ref{eq:key_equations})\)</span> 来书写，那么转换矩阵 <span class="math inline">\(\mathbf{T}\)</span> 就等于：</p>
<p><span class="math display">\[
\begin{equation}
\mathbf{T} = \begin{bmatrix}
    \sqrt{\frac{Var(\mathbf{c}_{tgt, 1})}{Var(\mathbf{c}_{src, 1})}} &amp;0 &amp;0\\
    0 &amp;\sqrt{\frac{Var(\mathbf{c}_{tgt, 2})}{Var(\mathbf{c}_{src, 2})}} &amp;0\\
    0 &amp;0 &amp;\sqrt{\frac{Var(\mathbf{c}_{tgt, 3})}{Var(\mathbf{c}_{src,3})}}\\
\end{bmatrix}
\end{equation}
\]</span></p>
<p>RGB 色彩空间中，红绿蓝三个通道相关性较大，上文所说的简化会导致较差的颜色转移效果。但是如果先把颜色转换到三个通道相关性较小的色彩空间中，效果会好很多。Reinhard 在他的论文中使用了他以前提出的 lαβ 色彩空间。<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>这个色彩空间是根据人眼锥细胞对自然风景反应的统计数据得出的，因此使用在自然风景图片上更容易得到较好的效果。</p>
<p>可以先从 RGB 色彩空间变换到常见的 LMS 色彩空间，再变换到 lαβ 色彩空间。由于这里取了对数，色彩空间变换本身是非线性的。具体如下：</p>
<p><span class="math display">\[
\begin{equation}
\begin{bmatrix}
    l\\
    \alpha\\
    \beta
\end{bmatrix} = \begin{bmatrix}
    \frac{1}{\sqrt{3}} &amp; 0 &amp; 0 \\
    0 &amp; \frac{1}{\sqrt{6}} &amp; 0 \\
    0 &amp; 0 &amp; \frac{1}{\sqrt{2}}
\end{bmatrix} \begin{bmatrix}
    1 &amp; 1 &amp; 1 \\
    1 &amp; 1 &amp; -2\\
    1 &amp; -1 &amp; 0
\end{bmatrix} \begin{bmatrix}
    \log L\\
    \log M\\
    \log S
\end{bmatrix}
\end{equation}
\]</span></p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
</tr>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.jpg" alt="转换后图片（Reinhard，RGB 空间中）" />
    </picture>
        <figcaption>转换后图片（Reinhard，RGB 空间中）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg" alt="转换后图片（Reinhard，lαβ 空间中）" />
    </picture>
        <figcaption>转换后图片（Reinhard，lαβ 空间中）</figcaption>
</figure>



</td>
</tr>
</table>
<h2 id="奇异值分解法4和其它一些矩阵分解">奇异值分解法<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>和其它一些矩阵分解</h2>
<p>Reinhard 的近似方法虽然计算简单，但是会导致色彩转换力度偏低，并且对非自然场景的照片效果较差。<span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 的精确解通常会用到矩阵分解。这里主要介绍奇异值分解法，即 SVD(Singular Value Decomposition)。其它一些类似的解法会一笔带过。</p>
<p>SVD 类似更加常见的特征值分解，但是对非方阵也能使用。对矩阵 <span class="math inline">\(\mathbf{A}\)</span> 使用 SVD 能够将其分解为三个处理起来更加简单的矩阵： <span class="math display">\[
\begin{equation}
\mathbf{A} = \mathbf{U}\mathbf{\Lambda}\mathbf{V}^T
\end{equation}
\]</span> 如果 <span class="math inline">\(\mathbf{A}\)</span> 是一个 <span class="math inline">\(m \times n\)</span> 的矩阵，那么 <span class="math inline">\(\mathbf{U}, \mathbf{\Lambda}, \mathbf{V}^T\)</span> 三者的大小分别是 <span class="math inline">\(m \times m, m \times n, n \times n\)</span>。<span class="math inline">\(\mathbf{\Lambda}\)</span> 是一个对角矩阵，对角线上的元素是矩阵 <span class="math inline">\(\mathbf{A}\)</span> 的奇异值（类似特征值）。由于协方差矩阵 <span class="math inline">\(\mathbf{\Sigma}\)</span> 是一个 <span class="math inline">\(3 \times 3\)</span> 且对称的正半定方阵，<span class="math inline">\(\mathbf{V} = \mathbf{U}\)</span>，于是有以下特殊情况：</p>
<p><span class="math display">\[
\begin{equation}
\mathbf{\Sigma} = \mathbf{U\Lambda U}^T
\label{eq:svd_special}
\end{equation}
\]</span> 对特征值分解的一个较好的理解方法是将其与二维空间中的椭圆做对比。当对一个单位圆上的点进行变换操作 <span class="math inline">\(\mathbf{v} \rightarrow \mathbf{Av} = \mathbf{U}\mathbf{\Lambda}\mathbf{V}^T\mathbf{v}\)</span> 时（<span class="math inline">\(\mathbf{A}\)</span> 当然是 <span class="math inline">\(2 \times 2\)</span>矩阵），相当于先用 <span class="math inline">\(\mathbf{V}^T\)</span> 对整个椭圆进行一次旋转，再用对角矩阵 <span class="math inline">\(\mathbf{\Lambda}\)</span> 在 <span class="math inline">\(x, y\)</span> 轴上进行缩放，最后用 <span class="math inline">\(\mathbf{U}\)</span> 再进行一次旋转。观察最终得出的椭圆，会发现它的两个半轴的长度分别为 <span class="math inline">\(\mathbf{\Lambda}\)</span> 中对角线上的两个奇异值。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@2x.png" alt="奇异值分解图示。图片来自 Wikipedia，作者 Georg-Johann。以 CC BY-SA 3.0 证书发布。图中所用的符号和文中略有不同。" />
    </picture>
        <figcaption>奇异值分解图示。图片来自 Wikipedia，作者 Georg-Johann。以 CC BY-SA 3.0 证书发布。图中所用的符号和文中略有不同。</figcaption>
</figure>



<p>以上的观察在理解 SVD 转换多元高斯分布时非常有帮助。当对一个高斯分布的协方差矩阵进行分解后，<span class="math inline">\(\mathbf{\Lambda}\)</span> 矩阵对角线上的每个特征值都是该分布的拟合椭球体的半轴长度之平方。那么 <span class="math inline">\(\mathbf{U\Lambda U}^T = \mathbf{U\Lambda U}^T\mathbf{I}\)</span> 可以看作对一个标准的多元正态分布进行一次旋转，一次缩放，再进行一次旋转。那么如果要进行变量变换，可以先将源图片的数据转换回标准的多元高斯分布，然后再将这一标准分布转换到与目标图片的分布一致。</p>
<p>下面的式子来自上海交大的论文《Color Transfer in Correlated Color Space》<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>其中介绍的就是这里描述的 SVD 分解法和对高斯分布拟合椭球体进行变换的思路。<span class="math inline">\(\mathbf{I}[n] \in \mathbb{R}^4\)</span> 表示的是图片 <span class="math inline">\(\mathbf{I}\)</span> 中的第 <span class="math inline">\(n\)</span> 个像素。变换都在齐次坐标系中进行。 <span class="math display">\[
\begin{equation}
    \mathbf{I}_{trans}[n] = (\mathbf{T}_{tgt}\mathbf{R}_{tgt}\mathbf{S}_{tgt}\mathbf{S}_{src}\mathbf{R}_{src}\mathbf{T}_{src})\mathbf{I}_{src}[n]
    \label{equ:svd_operation}
\end{equation}
\]</span> 其中， <span class="math inline">\(\mathbf{S}_{src}\mathbf{R}_{src}\mathbf{T}_{src}\)</span> 负责将原图片的色彩分布反向变换回去，<span class="math inline">\(\mathbf{T}_{tgt}\mathbf{R}_{tgt}\mathbf{S}_{tgt}\)</span> 负责将色彩分布变换到目标图片的分布。可以将 <span class="math inline">\(\mathbf{S, R, T}\)</span> 看作是缩放、旋转、平移矩阵。这些矩阵都为 <span class="math inline">\(4 \times 4\)</span> 的方阵，定义如下： <span class="math display">\[
\begin{gather}
    \mathbf{T}_{tgt} = \begin{bmatrix}
        1 &amp; 0 &amp; 0 &amp; \mu_{tgt}^r\\
        0 &amp; 1 &amp; 0 &amp; \mu_{tgt}^g\\
        0 &amp; 0 &amp; 1 &amp; \mu_{tgt}^b\\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{bmatrix}, \mathbf{T}_{src} = \begin{bmatrix}
        1 &amp; 0 &amp; 0 &amp; -\mu_{src}^r\\
        0 &amp; 1 &amp; 0 &amp; -\mu_{src}^g\\
        0 &amp; 0 &amp; 1 &amp; -\mu_{src}^b\\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{bmatrix}\\
    \mathbf{R}_{tgt} = \mathbf{U}_{tgt}, \mathbf{R}_{src} = \mathbf{U}^{-1}_{src}\\
    \mathbf{S}_{tgt} = \begin{bmatrix}
        \mathbf{\Lambda}^{1/2}_{tgt} &amp; | &amp; \mathbf{0}\\
        \hline
        \mathbf{0}       &amp; | &amp; 1
    \end{bmatrix}, \mathbf{S}_{src} = \begin{bmatrix}
        \mathbf{\Lambda}^{-1/2}_{src} &amp; | &amp; \mathbf{0}\\
        \hline
        \mathbf{0}       &amp; | &amp; 1
    \end{bmatrix}
\end{gather}
\]</span> 

<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@2x.png" alt="经过变换，图中红色的像素点拥有了与绿色像素点类似的拟合椭球体" />
    </picture>
        <figcaption>经过变换，图中红色的像素点拥有了与绿色像素点类似的拟合椭球体</figcaption>
</figure>


 这些操作也可以用 <span class="math inline">\((\ref{eq:key_equations})\)</span> 的格式来表示： <span class="math display">\[
\begin{gather}
    t(\mathbf{u}) = \mathbf{T}(\mathbf{u} - \mu_{src}) + \mu_{tgt}\\
    \mathbf{T} = \mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}
    \label{eq:svd_t}
\end{gather}
\]</span> 代入等式 <span class="math inline">\((\ref{eq:svd_t})\)</span> 和 <span class="math inline">\((\ref{eq:svd_special})\)</span> ，可以证明上面的等式是 <span class="math inline">\(\mathbf{T}\)</span> 在 <span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 中的精确解： <span class="math display">\[
\begin{gather}
    \begin{split}
      &amp;\mathbf{T}\mathbf{\Sigma}_{src}\mathbf{T}^T\\
      = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})(\mathbf{U}_{src}\mathbf{\Lambda}_{src}\mathbf{U}_{src}^T) (\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})^T\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})(\mathbf{U}_{src}\mathbf{\Lambda}_{src}\mathbf{U}_{src}^T) ((\mathbf{U}_{src}^{-1})^T(\mathbf{\Lambda}_{src}^{-1/2})^T(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{\Lambda}_{src}(\mathbf{\Lambda}_{src}^{-1/2})^T(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}\mathbf{U}_{tgt}^T = \mathbf{\Sigma}_{tgt}
    \end{split}
\end{gather}
\]</span></p>
<p>值得注意的是，变换 <span class="math inline">\((\ref{eq:svd_t})\)</span> 在<em>把源图片的高斯分布标准化</em> 和 <em>把标准化的高斯分布转换到目标图片的高斯分布</em> 这两步中分别只进行了一次旋转。更完整的转换应该是 <span class="math display">\[
\begin{equation}
\mathbf{T} = \mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{U}_{tgt}^T(\mathbf{U}_{src}^T)^{-1}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}
\label{eq:svd_t_full}
\end{equation}
\]</span> 不过考虑到进行 <span class="math inline">\(\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}\)</span> 变换后，源图片的高斯分布的拟合椭球体已经是一个正球体了，可以当作标准化已经结束。由于额外的旋转，完整的转换 <span class="math inline">\((\ref{eq:svd_t})\)</span> 和不完整的转换 <span class="math inline">\((\ref{eq:svd_t_full})\)</span> 产生的效果不同，这里不多赘述，有兴趣的可以自行尝试比对。总的来说，更精确的变换使得 SVD 能够进行差异更大的变换。从下图中不难看出，在将彩色照片转换成黑白照片的应用场景中， SVD 有着比 Reinhard 方法更强的变换能力。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@2x.jpg" alt="转换后图片（Reinhard）" />
    </picture>
        <figcaption>转换后图片（Reinhard）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.jpg" alt="转换后图片（SVD）" />
    </picture>
        <figcaption>转换后图片（SVD）</figcaption>
</figure>



</td>
</tr>
</table>
<h3 id="其它的矩阵分解法">其它的矩阵分解法</h3>
<p>除 SVD 以外，还有很多其它的矩阵分解法可以用于解决颜色转移问题。这里额外介绍两种在 F. Pitiee 的论文<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>中与他提出的新方法一并介绍的，效果较为一般的方法。</p>
<p><strong>乔累斯基分解法</strong>（Cholesky Decomposition）可以将协方差矩阵分解为两个三角矩阵。我们可以通过三角矩阵构建出变换矩阵。 <span class="math display">\[
\begin{gather}
\mathbf{\Sigma} = \mathbf{LL}^T\\
\mathbf{T} = \mathbf{L}_{tgt}\mathbf{L}_{src}^{-1}
\end{gather}
\]</span> 易证： <span class="math display">\[
\begin{gather}
\mathbf{T}\mathbf{\Sigma}_{src}\mathbf{T}^T = (\mathbf{L}_{tgt}\mathbf{L}_{src}^{-1})(\mathbf{L}_{src}\mathbf{L}_{src}^T)(\mathbf{L}_{tgt}\mathbf{L}_{src}^{-1})^T = \mathbf{L}_{tgt}\mathbf{L}_{src}^{-1}\mathbf{L}_{src}\mathbf{L}_{src}^T(\mathbf{L}_{src}^{-1})^T\mathbf{L}_{tgt}^T = \mathbf{L}_{tgt}\mathbf{L}_{tgt}^T = \mathbf{\Sigma}_{tgt}
\end{gather}
\]</span> <strong>平方根分解法</strong>是通过先将对称的协方差矩阵进行特征值分解，来算出每个协方差矩阵的平方，由此构建出变换矩阵。 <span class="math display">\[
\begin{gather}
&amp;\mathbf{\Sigma} = \mathbf{Q\Lambda Q}^{-1}\\
\nonumber\Downarrow\\
&amp;\mathbf{\Sigma}^{1/2} = \mathbf{Q\Lambda}^{1/2}\mathbf{Q}^{-1}\label{eq:sqrt}\\
&amp;\mathbf{T} = \mathbf{\Sigma}^{1/2}_{tgt}\mathbf{\Sigma}^{-1/2}_{src}
\end{gather}
\]</span> 同样易证出 <span class="math inline">\(\mathbf{T}\)</span> 的正确性，这里就略去证明过程。需要注意的是，由于协方差矩阵的对称性，<span class="math inline">\(\mathbf{Q}^{-1} = \mathbf{Q}^T\)</span>。</p>
<h2 id="蒙日-康托罗维奇解法1">蒙日-康托罗维奇解法<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></h2>
<p>之前的几种解法比较“瞎”——它们容易导致色差过大的转换结果。而且在进行特征值分解、奇异值分解时，特征值、奇异值的不同顺序，或者颜色通道的不同顺序可能会导致完全不同的结果。为了解决这些问题，F. Pitiee 在他的论文中提出，康托罗维奇为苏联经济规划提出的最优化问题解法也可以被用在色彩转移上。</p>
<p>蒙日-康托罗维奇转移问题（Monge-Kantorovitch transportation problem）被描述为在进行变换 <span class="math inline">\(t:\mathbb{R}^n \rightarrow \mathbb{R}^n\)</span> 的同时尽可能减少总共的转移花费。单次花费以一个函数 <span class="math inline">\(c()\)</span> 定义。 <span class="math display">\[
\begin{gather}
c(\mathbf{u}, t(\mathbf{u})) \text{（单次）}\\
c(t) = \sum_{\text{all } u} c(\mathbf{u}, t(\mathbf{u})) \text{（总共）}
\end{gather}
\]</span> 如果将花费函数定义为向量差的模长平方，并且对随机分布进行积分求出期望值，那么可以将这个问题的解应用在颜色转移上。 <span class="math display">\[
\begin{gather}
c(\mathbf{u}, t(\mathbf{u})) = ||\mathbf{u} - t(\mathbf{u})||^2 \text{（单次）}\\
c(t) = E[c(\mathbf{U})] = \int_{\text{all } u} ||\mathbf{u} - t(\mathbf{u})||^2 f_u(\mathbf{u}) du \text{（总共）}
\end{gather}
\]</span> 据此能解出变换矩阵。其中的求平方根操作与平方根分解法中的算法 <span class="math inline">\((\ref{eq:sqrt})\)</span> 一致。 <span class="math display">\[
\begin{equation}
\mathbf{T} = \mathbf{\Sigma}_{src}^{-1/2}(\mathbf{\Sigma}_{src}^{1/2}\mathbf{\Sigma}_{tgt}\mathbf{\Sigma}_{src}^{1/2})^{1/2}\mathbf{\Sigma}_{src}^{-1/2}
\end{equation}
\]</span></p>
<p>我没有去了解求解过程，因此就不给出具体过程和证明了。在 F. Pitiee 的论文中介绍了这个解的两个特征：</p>
<ol type="1">
<li>蒙-康解法总是给出一个唯一解，因此没有涉及奇异值分解、特征值分解时遇到的不稳定问题</li>
<li>通过计算总花费最优化，实现了转换的单调性：例如怪异最亮的区域在转换后依然是最亮的区域</li>
</ol>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/26e3cc77/scotland_plain@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/26e3cc77/scotland_plain@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.jpg" alt="SVD，RGB 空间中" />
    </picture>
        <figcaption>SVD，RGB 空间中</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.jpg" alt="蒙-康，RGB 空间中" />
    </picture>
        <figcaption>蒙-康，RGB 空间中</figcaption>
</figure>



</td>
</tr>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.jpg" alt="SVD，BGR 空间中" />
    </picture>
        <figcaption>SVD，BGR 空间中</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.jpg" alt="蒙-康，BGR 空间中" />
    </picture>
        <figcaption>蒙-康，BGR 空间中</figcaption>
</figure>



</td>
</tr>
<tr>
</table>
<p>这两个特征保证了颜色转换的稳定性。但是也带来了一个问题：在进行变化较大的转换时，蒙-康解法可能会显得更为保守。例如将白花转换成红花时，SVD 能较好地完成任务。但是蒙-康解法则会导致粉色大部分被转移到源图片右上角的红花上，图片整体更加怪异。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.jpg" alt="转换后图片（SVD）" />
    </picture>
        <figcaption>转换后图片（SVD）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.jpg" alt="转换后图片（蒙-康）" />
    </picture>
        <figcaption>转换后图片（蒙-康）</figcaption>
</figure>



</td>
</tr>
</table>
<h2 id="结语">结语</h2>
<p>以上介绍了三种比较简单的颜色转移方法的推导和理解。它们分别着重考虑了色彩空间的优化、概率分布的操作和最优化问题的求解，在实际应用上各有优劣。除此之外，还有很多非线性的转换法，例如根据图片梯度和分区优化的方法，以及使用机器学习、语义识别的颜色转移。这些方法更为复杂，功能更加强大。</p>
<p>这篇文章写好的时候，已经离当初的 paper 间隔了一个学期。撰写博文的时候常常会因为弄不懂原 paper 中自己当初亲自写下的公式，或是对自己当初的论述有所怀疑而去查阅其它论文和网络资料。本文中的第二个等式，随机变量转换，本来是只有第二行的。然而在连续两忘记推导过程后只好把第一行的推导过程老老实实写了下来。全篇写完，发现不仅帮自己复习了数学知识，还查出了原 paper 中的一些错误。“验证学习效果的最好方法是教给别人”，这句话诚不欺我。只是可惜原本准备将文章写得简明扼要，最后完整论述下来还是写出了几千字。现在想来，也许把一整篇博文分成三份撰写发布会更好一些。</p>
<p>文中用到的图片主要来自于 F. Pitiee 在<a target="_blank" rel="noopener" href="https://github.com/frcs/colour-transfer">他的颜色转移代码仓库</a>里发布的测试用图片，以及 <a target="_blank" rel="noopener" href="https://cc0.photo/">https://cc0.photo/</a> 提供的 CC-0 无版权图片。感谢他们的贡献。</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>E. Reinhard, M. Ashikhmin, B. Gooch, and P. Shirley. Color transfer between images. IEEE Comput. Graph. Appl., 21(5):34–41, Sept. 2001.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>D. L. Ruderman, T. W. Cronin, and C.-C. Chiao. Statistics of cone responses to natural images: implications for visual coding. J. Opt. Soc. Am. A, 15(8):2036–2045, Aug 1998.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>X. Xiao and L. Ma. Color transfer in correlated color space. In Proceedings of the 2006 ACM International Conference on Virtual Reality Continuum and Its Applications, VRCIA’06, page 305–309, New York, NY, USA, 2006. Association for Computing Machinery.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>X. Xiao and L. Ma. Color transfer in correlated color space. In Proceedings of the 2006 ACM International Conference on Virtual Reality Continuum and Its Applications, VRCIA’06, page 305–309, New York, NY, USA, 2006. Association for Computing Machinery.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</section>

    </div>

    
    
    

    <footer class="post-footer">
  <div class="addthis_inline_share_toolbox", style="text-align: center">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-6089b828ba6dc0ff" async="async"></script>
  </div>
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>LucunJi
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/" title="线性颜色转移">https://lucunji.github.io/2021/03/04/brief-on-linear-color-transfer/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://space.bilibili.com/2117299">
          <span class="icon">
            <i class="fa bili-tv"></i>
          </span>

          <span class="label">Bilibili</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/CV-computer-vision/" rel="tag"># CV(computer vision)</a>
              <a href="/tags/math/" rel="tag"># math</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/03/04/millet-van-gogh-and-dali/" rel="prev" title="画展，米勒以及梵高等">
                  <i class="fa fa-chevron-left"></i> 画展，米勒以及梵高等
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fas fa-biohazard"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LucunJi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-6089b828ba6dc0ff" async="async"></script>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>





  <script>
    NProgress.configure({
      showSpinner: false
    });
    NProgress.start();
    document.addEventListener('readystatechange', () => {
      if (document.readyState === 'interactive') {
        NProgress.inc(0.8);
      }
      if (document.readyState === 'complete') {
        NProgress.done();
      }
    });
    document.addEventListener('pjax:send', () => {
      NProgress.start();
    });
    document.addEventListener('pjax:success', () => {
      NProgress.done();
    });
  </script>

  


<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"GM3E9c3iav6Jjhwj4n9ktqIX-MdYXbMMI","app_key":"OIJ3z8gwKASYoJUUy3BQIFQU","server_url":null,"security":true};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



<script>
let inner = document.getElementsByClassName("main-inner archive")[0];
if (inner != null) {
    inner.children[0].style.marginTop = 0;
    inner.innerHTML = `
<div class="post-block animated fadeIn">
    <header class="post-header animated fadeInDown">
        <h1 class="post-title" itemprop="name headline"
        style="font-weight: normal;text-align: center;margin: initial">
            标签 
        </h1>
    </header>
    <div class="post-body animated fadeInDown">
        <div class="tag-cloud">
            <a href="/tags/CV-computer-vision/" style="font-size: 12px; color: #ccc">CV(computer vision)</a> <a href="/tags/Hexo/" style="font-size: 12px; color: #ccc">Hexo</a> <a href="/tags/Java/" style="font-size: 21px; color: #6f6f6f">Java</a> <a href="/tags/ML-machine-learning/" style="font-size: 12px; color: #ccc">ML(machine learning)</a> <a href="/tags/NexT/" style="font-size: 12px; color: #ccc">NexT</a> <a href="/tags/TekTopia/" style="font-size: 21px; color: #6f6f6f">TekTopia</a> <a href="/tags/ai/" style="font-size: 12px; color: #ccc">ai</a> <a href="/tags/anime-images/" style="font-size: 12px; color: #ccc">anime images</a> <a href="/tags/art/" style="font-size: 12px; color: #ccc">art</a> <a href="/tags/bytecode/" style="font-size: 12px; color: #ccc">bytecode</a> <a href="/tags/deepfake/" style="font-size: 12px; color: #ccc">deepfake</a> <a href="/tags/math/" style="font-size: 12px; color: #ccc">math</a> <a href="/tags/minecraft/" style="font-size: 30px; color: #111">minecraft</a> <a href="/tags/misc/" style="font-size: 12px; color: #ccc">misc</a> <a href="/tags/mod/" style="font-size: 21px; color: #6f6f6f">mod</a> <a href="/tags/noita/" style="font-size: 12px; color: #ccc">noita</a> <a href="/tags/paintings/" style="font-size: 12px; color: #ccc">paintings</a> <a href="/tags/tech/" style="font-size: 12px; color: #ccc">tech</a> <a href="/tags/translation/" style="font-size: 21px; color: #6f6f6f">translation</a> <a href="/tags/weird/" style="font-size: 12px; color: #ccc">weird</a>
        </div>
    </div>
</div>` + inner.innerHTML;
}
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">

<script>
NexT.utils.loadComments('.gitalk-container', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '8fd22f2eb6ea944a13c2',
      clientSecret: '9ed843020c43682254a95859546418fa8d7d43a1',
      repo        : 'LucunJi.github.io-gitalk',
      owner       : 'LucunJi',
      admin       : ['LucunJi'],
      id          : '58ad42817c2a8b80ead29ea66188e1b3',
      proxy       : 'https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render(document.querySelector('.gitalk-container'));
  }, window.Gitalk);
});
</script>

</body>
</html>

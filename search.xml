<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>3Ws</title>
    <url>/2018/12/11/3Ws/</url>
    <content><![CDATA[<h2 id="你好欢迎来到这里">你好，欢迎来到这里：</h2>
<p>3Ws, 即英文里的三个“W”：为什么（Why），哪里（Where），谁（Who）。 在这里，我将回答建立这里的原因，我，以及这篇博客。</p>
<span id="more"></span>
<h1 id="why-这里的建立">Why: 这里的建立</h1>
<p>网络审查。 由于反复的网站审核，每一个网络用户的言行都受到了夸张的限制。用户可以因为如下原因被删除言论，禁言，甚至短期或永久封号：</p>
<ul>
<li><font color=white>不可说</font>；</li>
<li>发布对于网站利益相关人不利的言论，包括但不限于高层人员、签约盈利用户以及拥有大量资本的其它人员；</li>
<li>被他人举报，理由任意；</li>
<li>进行网站运营方无法获得利润的商业活动；</li>
<li>拒绝网站的实名认证、客户端授权等获取用户隐私的行为；</li>
<li>发布链接或上传资源，导致被误认为发布广告；</li>
<li>异地登陆，高速发言，图文直播等异常行为；</li>
<li>……………………</li>
</ul>
<p>除此之外的原因还有对于其它网站环境和功能的不满，<del>一直想找个地方搭建伪春菜的愿望</del>（已放弃）以及其它的一些影响。</p>
<h1 id="where-这个博客">Where: 这个博客</h1>
<p>首先感谢以 <a href="https://www.simon96.online/tags/hexo/">TDsimon</a> 博客为主的许许多多简单易懂的教程，我这篇博客的很多设置都是照抄他的。 架设在 GitHub 上的博客，具体信息可以看网页的最底端↓↓↓ 排版参照 <a href="https://mazhuang.org/wiki/chinese-copywriting-guidelines/">中文文案排版指北</a>。 Hexo 官方的 HelloWorld 文件，出于对作者的感谢，没有删除。 评论区没有初始化或者有bug的话麻烦b站私信，谢谢合作。 书单和相册正准备搞。 反正出 bug 可以交 issue，但是不保证会修复。</p>
<h1 id="who-关于我">Who: 关于我</h1>
<ul>
<li>生卒年月（YYYY/MM/DD）：2000/11/29 - 不详。</li>
<li>性别：IRL, 男。</li>
<li>掌握技能：
<ul>
<li>初级的 PS, PR 使用；</li>
<li>SolidWorks 入门级使用，不包括仿真、曲线模型等技能；</li>
<li>英文翻译 + 打轴；</li>
<li><del>初级拉丁语</del>基本上忘记的较多；</li>
<li>计算机科学在读。</li>
</ul></li>
<li>身份/角色：
<ul>
<li>Minecraft 模组；</li>
<li>CFPA 模组汉化组成员；</li>
<li>TIS Trinity Union 服务器成员；</li>
<li><del>模组教程独立搬运工 + 翻译；</del>（现已停止活动）</li>
<li>计算机科学在读；</li>
<li>亚文化的游牧民族。</li>
</ul></li>
<li>人设什么的 naidesu，就算有的话也会很奇怪。暂时还不想把自己用标签框住。</li>
<li>知识水平并不丰富，身体素质较弱。除此之外就是比较懒。</li>
<li>由于对自己的执行力有着充分的不信任，目前倾向于自己一个人开坑填坑以及弃坑。</li>
<li>目前（2019 年 9 月 - ）大学本科就读，业余精力不多。</li>
<li>于2018年12月建立了这个博客。</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>自动写作尝试</title>
    <url>/2021/02/03/automatic-writing/</url>
    <content><![CDATA[<p align="center">
水中的水花，是绿色的天底下的太阳。<br> 地面上的计算机和打字机是同构的化学品。<br> 灯泡挂钩和你的家人都在这个世界上快乐地进食。<br> 鞋子，歌唱机和手机是彻夜亮着的灯塔。
</p>
]]></content>
      <tags>
        <tag>weird</tag>
      </tags>
  </entry>
  <entry>
    <title>【译】科技能救我们于深度伪造之中吗？</title>
    <url>/2020/07/22/can-tech-save-us-from-deepfakes/</url>
    <content><![CDATA[

<figure>
    <picture>
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/c7f5c1c4/nasa-mission-control-a@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/c7f5c1c4/nasa-mission-control-a@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/c7f5c1c4/nasa-mission-control-a@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/c7f5c1c4/nasa-mission-control-a@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2020/07/22/can-tech-save-us-from-deepfakes/c7f5c1c4/nasa-mission-control-a@2x.jpg" alt="【译】科技能救我们于深度伪造之中吗？" />
    </picture>
</figure>



<span id="more"></span>
<p><font color=gray size =2>原文：<em>Can Tech Save Us From Deepfakes?</em><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></font> <font color=gray size=2>翻译：<a href="https://www.deepl.com/translator">DeepL翻译</a> + 禄存天玑后期润色</font> <font color=gray size=2>译者注：仅对原文进行翻译搬运，旨在拓宽大众视野，不代表译者立场。以下的“deepfake”一律使用“深度伪造”作为译名。</font></p>
<h2 id="当深度伪造变得越来越复杂算法能够检测并排除它们吗">当深度伪造变得越来越复杂，算法能够检测并排除它们吗？</h2>
<p>深度伪造比以往任何时候都要强大而普遍。依赖于逼真的图像与完美合成的人类语音，这些复杂的后期编辑的视频被人工智能软件生成出来了。</p>
<p>即使是迪士尼也在投资深度学习驱动的技术。在2020年初发表的一篇论文中，来自迪士尼研究工作室的科学家们声称，他们已经成功地训练了一种算法，来以前所未有的高分辨率质量在图像和视频中呈现照片般逼真的换脸。论文作者写道，这家娱乐巨头希望在需要将演员描绘得更年轻，无法使用演员使用这种特效，其他一些场合使用这项特效。</p>


<figure>
    <picture>
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/937a7f38/young-deniro-1030x540@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/937a7f38/young-deniro-1030x540@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/07/22/can-tech-save-us-from-deepfakes/937a7f38/young-deniro-1030x540@2x.png" alt="【译】科技能救我们于深度伪造之中吗？" />
    </picture>
</figure>



<p><font size=2 text-align=center color=grey> 在网飞（Netflix）最近的影片《爱尔兰人》（The Irishman）中，罗伯特·德尼罗（Robert De Niro）在倒叙片段中被“返老还童”了。（来源：卢卡斯影业有限公司）</font></p>
<p>但即使在这种技术成为主流的时候，围绕着它的使用仍有未解决的忧虑。从网络上开始出现模仿、政治讽刺和假名人色情视频的那一刻起，人们就对深度伪造喜忧参半。据人工智能公司 <a href="https://deeptracelabs.com/">Deeptrace Labs</a> 去年发布的一份报告估计，目前大约有4.9万个深度伪造在流传，但社交平台上的换脸滤镜和由面部识别引擎驱动的应用程序的快速增长意味着可能还有成千上万个。</p>
<p>艺术家和记者最近一直在探索如何建设性地利用该技术来创造社会和政治评论，或保护边缘化和高危群体的隐私。例如，获得奥斯卡奖提名的纪录片制作人大卫·法兰西（David France）在上周于HBO上映的启示性影片《欢迎来到车臣》（Welcome to Chechneya）中，利用深层伪造技术掩盖了车臣同性恋者的身份。该技术甚至被一位星战超级粉丝用来“修饰"，以改善《星球大战：侠盗一号》中年轻的莱娅公主的客串。</p>
<p>但即便是个人和迪士尼这样的大型媒体公司将这项技术用于非恶意的目的，深层造假技术也正在引发关于假新闻、个人隐私和视频证据权重的激烈辩论。</p>


<figure>
    <picture>
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/1f6c72cb/carrie-fisher@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/1f6c72cb/carrie-fisher@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/1f6c72cb/carrie-fisher@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/1f6c72cb/carrie-fisher@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2020/07/22/can-tech-save-us-from-deepfakes/1f6c72cb/carrie-fisher@2x.jpg" alt="【译】科技能救我们于深度伪造之中吗？" />
    </picture>
</figure>



<p><font size=2 text-align=center color=grey>Youtube 上“derpfake”频道的建立者使用深度伪造技术来改善《星球大战：侠盗一号》中年轻的凯丽·费雪（Carrie Fisher）的外貌。建立者告诉卫报（The Guardian，英国著名日报），这个在上映几天就被观看了成千上万遍的工程，被在“用来看一季《辛普森》的时间里”做完了。（《辛普森》，即《辛普森一家》，The Simpsons，美国著名动画片，一季约20集，每集约20分钟）</font></p>
<h2 id="检测的挑战">检测的挑战</h2>
<p>1月，可能是为了在2020年大选前将问题解决在萌芽状态，Facebook 宣布将禁止扭曲现实或误导公众的操纵媒体。</p>
<p>这包括“在调整清晰度或质量之外进行编辑或合成的视频，其方式对普通人来说并不明显，很可能会误导别人认为视频主角说了他们实际上没有说过的话，”Facebook 全球政策管理副总裁 Monika Bickert 在一篇博客文章中写道。她补充说，音频或视频，无论是否深度伪造，也会受到Facebook的社区标准管理。如果包含裸露、图形暴力、压制选民或仇恨言论，就会被删除。</p>
<p>这个标准也适用于广告，不过《纽约时报》的报道指出，这一政策不会追溯标准制定以前的视频。</p>
<p>在全州范围内，加州已经先发制人地禁止在选举后60天内传播模仿真实镜头、故意伪造政治候选人言行的“恶意”操纵的视频、音频和图片。针对一段<a href="https://www.cbsnews.com/news/doctored-nancy-pelosi-video-highlights-threat-of-deepfake-tech-2019-05-25/">被篡改的南希·佩洛西（Nancy Pelosi）的，使美国众议院议长看起来像喝醉了酒的视频</a>，提出该法案的议员马克·伯曼（Marc Berman）称深度伪造是“一种强大而危险的新技术，可以作为武器，在已经过度党派化的选民中播撒错误信息和不和。”</p>


<figure>
    <picture>
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/beccd471/nancy-pelosi@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/beccd471/nancy-pelosi@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/beccd471/nancy-pelosi@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2020/07/22/can-tech-save-us-from-deepfakes/beccd471/nancy-pelosi@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2020/07/22/can-tech-save-us-from-deepfakes/beccd471/nancy-pelosi@2x.jpg" alt="【译】科技能救我们于深度伪造之中吗？" />
    </picture>
</figure>



<p><font size=2 text-align=center color=grey>华盛顿邮报对南希·佩洛西被操纵的视频进行分析。该视频被放慢了速度，使她看起来口齿不清。（来源：华盛顿邮报）</font></p>
<p>去年，美国参议院通过了“<a href="https://www.schatz.senate.gov/press-releases/schatz-portman-bipartisan-legislation-to-confront-rising-threat-of-disinformation-and-deepfakes-passes-senate#targetText=WASHINGTON%2C%20DC%20%E2%80%93%20Today%2C%20U.S.,other%20types%20of%20similar%20content.">深层假消息报告法</a>”，要求国土安全部每年对深层假消息和任何试图“破坏民主”的人工智能驱动的媒体进行研究。</p>
<p>纽约大学法学兼职教授保罗·巴雷特（Paul Barrett）告诉NPR的“巨魔观察"（Troll Watch），虚假信息越来越多地针对图像，而不是文字。“任何具有基本编码知识和“渴望在选举中捣乱的人都可以开始拼凑这些非常令人信服但虚假的视频，”巴雷特说。“而这些公司也意识到了这一点，并且正在争先恐后地，试图对此做出也许迟到的回应。”</p>
<p>现在知道立法能否成为阻止深层网络假货流传或病毒式传播的有效策略还为时过早，特别是考虑到搜索引擎无法进入深层网络的许多角落。另一个挑战是，这种法案可能会限制言论自由。因此，一些专家正在转向另一种遏制深度伪造浪潮的策略：以技术对抗技术。</p>
<h2 id="以科技反科技">以科技反科技？</h2>
<p>在识别深度伪造方面，技术专家和初创公司正在迎头赶上。然而，一些人正在投资开发面向未来的方法，以防范深度伪造的黑暗面。</p>
<p>6月，Facebook 公布了一项深度伪造检测挑战赛的结果，该挑战赛汇集了2000多名技术专家和人工智能研究人员，以创建和测试算法来检测Facebook制作的操纵视频。</p>
<p>在对 Facebook 的测试数据集进行测试时，表现最好的模型达到了 82.56% 的精度，但在对包含真实世界视频的“黑箱”数据集（这些视频通常是之前看不到的，而且更加复杂）进行测试时，准确率只有 65.18%。黑箱算法仍然是机器学习检测技术面临的最大挑战之一。</p>
<p>利用视频和技术策略揭露腐败和援助人权活动的国际非营利组织 Witness 一直在游说对<a href="https://blog.witness.org/2019/06/deepfakes-synthetic-media-updated-survey-solutions-malicious-usages/">媒体取证进行更好的投资</a>，并称<a href="https://www.darpa.mil/program/media-forensics">美国DARPA的MediFor计划</a>是一个有希望的一步。</p>
<p>华盛顿特区的智库布鲁金斯研究所（The Brookings Institute）正在<a href="https://www.brookings.edu/research/fighting-deepfakes-when-detection-fails/">敦促政策制定者</a>建立一个 "额外的资金流，用于开发新的工具，如反向视频搜索或基于区块链的验证系统，这些工具可能更好地坚持面对无法检测的深层伪造。" 该研究所还鼓励政策制定者投资培训记者和事实核查员，并支持与基于人工智能的检测公司合作。</p>
<p>Deeptrace Labs 就是这样一家检测公司。这是一家利用深度学习和计算机视觉来检测和监控深层伪造的初创公司，它将自己宣传为对抗基于人工智能的病毒式合成视频的 “杀毒软件”——这不失为深层技术前沿的智慧之战的证明。</p>
<p>Deeptrace 正在开发分析检测假视频的后端系统。它可用于个人用户和媒体公司，帮助他们识别伪造。“这句标语很好地概括了我们如何看待这个问题的一些表现方式，以及我们如何看待预防这个问题的潜在技术解决方案。”Deeptrace实验室的传播和研究分析主管Henry Ajder说。</p>
<p>Reality Defender 是另一款智能软件。它在你浏览网页时与你并肩作战，检测潜在的虚假媒体并提醒用户注意它的存在。</p>
<p>科学家们也是这场战斗的一部分。加利福尼亚大学河滨分校电气和计算机工程教授、智能系统研究中心主任 Amit Roy-Chowdhury 开发了一种深度神经网络架构，可以识别被篡改的图像，并以前所未有的精度识别伪造品。</p>
<p>Roy-Chowdhury 的系统可以通过检测物体周围边界每一个像素的质量，来分辨出被篡改的图像和未篡改的图像。如果图像被篡改或修改，这些边界可能会被“污染”，因此可以帮助研究人员精确地确定任何医生的位置。</p>
<p>虽然他的系统适用于静态图像，但理论上，同样的原理——经过一些调整——可以应用于由数千帧和图像组成的深层伪造视频。</p>
<p>但是，尽管做出了扎实的努力，大多数研究人员都认为，在外部环境检测深度伪造的过程是一个完全不同的比赛。另外，大体上，这些实验性的检测技术只掌握在专家手中，一般人无法接触到。</p>
<h2 id="但科技不是万金油">但科技不是万金油</h2>
<p>“随着我们的技术越来越好，打击深层假货将变得越来越困难，”麻省理工学院计算机科学副教授 Aleksander Madry 说，他的研究解决了计算和开发值得信赖的人工智能的关键算法挑战。“所以目前这更像是一场猫捉老鼠的游戏，人们可以尝试通过识别一些假象来检测它们，但随后对手可以改进他们的方法来避免这些假象。”</p>
<p>“更好的方法可能会欺骗检测机制，” Roy-Chowdhury 同意。这位计算机科学家说：“我们极不可能有一个系统能够检测到每一个深层伪造的东西。通常情况下，安全系统是由链条中最薄弱的环节来定义的。”</p>
<p>根据麻省理工学院计算机科学与人工智能实验室教授尼克-罗伊的说法，科学家们经常在黑暗中工作。Roy说：“在很多情况下，科学家不知道神经网络在做什么。”他对人工智能、机器学习和计算系统的研究主要集中在不确定性导致的问题上。</p>
<p>科学家“不能总是在出错的时候进行解释。神经网络不是黑魔法。我们确实了解很多基础知识，但我们没有掌握极限的……我们需要了解极限是什么，”他解释说。</p>
<p>随着基于深度学习技术的能力不断发展，Madry 说：“我担心的是，我们将不再能够自动依赖视频作为证明。”</p>
<h2 id="深度伪造与检测技术的未来">深度伪造与检测技术的未来</h2>
<p>对于生成较差的深层伪造视频——那种通常由粗制滥造的编辑导致的明显皱纹——智能软件和知情的眼睛很容易发现篡改。但是，随着合成视听媒体开发者对这些问题的解决，发现伪造的迹象将变得更加困难。</p>
<p>前些年，研究人员通过监测眨眼频率来训练软件发现深层伪造。人类平均每分钟眨眼17次，但旧的深度伪造视频的眨眼频率往往远低于此。“如果你看的是2018年1月的视频，缺乏眨眼的情况很可能还适用于那里，”阿杰德说。“但比如说在接下来的一年，或两年，或五年，就无法依赖这一点进行衡量。”</p>
<p>同样，随着深度伪造的发展，依靠训练人工智能的，针对对编辑错误（如移帧和灯光或肤色的变化）的检测工具可能很快就会过时。</p>
<p>阿杰德说，他有信心，他所说的一些假媒体的“民间检测”方法，绝大部分“几乎肯定会被训练出高级版本。只有在谨慎应用并结合分析方法的情况下，它们才会有用。”</p>
<p>另一个问题是社交媒体平台所使用的分享技术，它可以让深层假货在不被发现的情况下倍增。</p>
<p>例如，德雷克塞尔大学助理教授马修·斯塔姆（Matthew Stamm）去年在西南偏南会议上表示，一些检测技术会寻找“非常微小的数字签名”，这些签名被嵌入到视频文件中。但当视频文件被分享到社交媒体上时，它被缩小和压缩，这就消除了所有被篡改的迹象。</p>
<p>“有很多图像和视频认证技术存在，但有一处他们都失败了，就是在社交媒体上，” 斯塔姆说。</p>
<p>同时，纽约大学法律系的巴雷特力劝人们“高度怀疑对他们所见”，并表示公司应该对虚假信息采取积极行动，或许可以“降级”这些帖子或视频。“我认为，他们应该完全从他们的网站上删除这种材料，”他补充道。</p>
<p>最终，将需要新形式的集体行动来打击篡改视频的负面影响，特别是如果它们被用来制造虚假新闻，意图误导。这个问题已经很普遍，无法单独解决。人工智能公司、媒体监督机构、政府和个人必须分担责任，对事实进行核查，并决定什么是真相，什么不是。</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Pakinam Amer. "Can Tech Save Us From Deepfakes?" In Event of Moon Disaster. Nov. 22, 2019. Revised for online publishcation on Jul. 3, 2020. https://moondisaster.org/can-tech-save-us-from-deepfakes/<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
      <tags>
        <tag>tech</tag>
        <tag>ai</tag>
        <tag>deepfake</tag>
        <tag>ML(machine learning)</tag>
        <tag>translation</tag>
      </tags>
  </entry>
  <entry>
    <title>电梯</title>
    <url>/2020/07/12/elevator/</url>
    <content><![CDATA[<p>没人能准确说出这台玻璃电梯前往的最高层是第几层。电梯井数倍高于商厦本身，而凭空高出商厦的那部分自然没有任何中间楼层。也就是说，从大厦本身的第五层到电梯顶端的终点之间没有任何的停靠层。</p>
<p>上升不可撤销，下降亦然。</p>
<span id="more"></span>
<p>全玻璃构造的轿厢在玻璃电梯井内被一根明显不够粗的缆绳悬着。缆绳刚好连着轿厢顶部的正中心。若是轿厢没人，它可以以轻微摇晃的态势有惊无险地保持平衡。</p>
<p>这种设计的本意应该是让乘客在上升过程中饱览城市风景。可惜轿厢的地板也是玻璃的，再加上这摇摇欲坠的结构，很难想象乘客还能有心情去浏览风景。</p>
<p>这座城市也没有什么风景。建筑都是式样较老，稀稀拉拉的。商厦——更确切地说是这个电梯井——算是附近唯一的高楼。而天空每天基本上都是凄惨的白色，佐以不多不少，刚好让人可以偷懒不带口罩的雾霾。</p>
<p>这栋大厦不仅有这一部电梯。边上的另一部电梯的式样是在小区商场中随处可见的全金属结构，可惜它只在较低的楼层徘徊，并不通向几十层的高空。</p>
<p>电梯的顶部确实存在着一个楼层，那是仅靠着电梯井悬在半空的真正意义上的空中楼阁。原本那里是废弃的，但最近有人在上面办了一个英语补习班。这座城市中一部分有着勉勉强强，还算殷实的家底的学生，让这座电梯开始忙碌起来。</p>
<p>那个办补习班的人，想必是个万里挑一的优秀教师？并非如此，只是这座小城并无其他在英语水平上勉强称得上出众的人。边上的S城固然有不错的教育资源，可S城的生活开销太大，与小城之间也隔了几个小时的路途。也没有多少人称那个年轻人为某老师。家长们叫他小某，学生们则直呼姓名。</p>
<p>电梯上去又下来了。电梯门打开的时候里面是空的，因此大致可以推断之前进入的那位成功登顶了。既然之前的人平安无事，那这一次应该也是安全的。不过如果上升到一半出了故障，后果是可想而知的。</p>
<p>但在玻璃的移门在身后关上后，手不假思索地按下了最上面的那个按钮。</p>
<p>电梯开始不紧不慢地上升。上升到一半的时候，由人导致的重心偏移使轿厢开始在电梯井里打旋。渐渐地，人开始用后背贴着玻璃壁，站也站不稳了。想在电梯里惊呼，但电梯里并没有其他人去听。两个人的重量对于这部电梯来说太过勉强了。又约莫过了半分钟，电梯终于到达顶端。晃动的轿厢和外面的地板间有三四十公分的空隙，但人终究还是迈过去了。</p>
<p>这样的光景，每天要重复上下两遍，每个月总共有大约十次。并没有谁看到工人来维修过电梯，仿佛电梯对于这些学生以外的其它人来说是不存在的。电梯这么运行了将近半年，有过好几次在半空中卡住，又恢复过来继续运行的奇迹，从来没出过人命。至于办补习班的那位年轻人是怎么上去的，似乎没有多少人思考过。</p>
<p>在数十米的高空乘坐如此摇摇欲坠的电梯，这似乎严重有悖于生命的本能。然而比起从数十米高空跌下来的后果，似乎有更加抽象而恐怖的东西在逼迫着这些灵长目动物。</p>
<hr />
<h1 id="后记">后记</h1>
<p>这篇文章来源于做过的梦。后来添加上一些别的东西，就作成了这篇文章。写的时候尝试把字数尽量压缩，居然也写出了一千来字。这篇文章的一个更为完整的标题可以是《电梯-小城与那群妄想逃离的学生》。可以算是魔幻现实。艺术来源于生活，但是麻烦不要对号入座，qqqxx（3q谢谢）</p>
<p>这篇文章的隐喻我觉得不难看出来。如果要我多说一点的话是这样的：这部电梯虽然有来有回，但是整个小城以及更大的环境使得这部电梯和它代指的一些东西变成了真正意义上的单行道。</p>
<p>另外，这篇文章是以我的主观感受写的，如果有不同的想法，很正常，说，都可以说。</p>
]]></content>
      <tags>
        <tag>misc</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2018/12/10/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>. <span id="more"></span></p>
<h2 id="quick-start">Quick Start</h2>
<h3 id="create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="run-server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>浅谈活塞破基岩法的不稳定性起源及解决方法</title>
    <url>/2020/01/02/bedrock-breaking/</url>
    <content><![CDATA[<p>本文针对最早由 Myren Eario 提出的利用活塞移除基岩的方法所存在的不稳定性进行分析，并提出一种可行的解决方案。 <span id="more"></span></p>
<h2 id="原方法简介">原方法简介</h2>
<p><em>基岩</em>在 Minecraft 无法被生存模式下的玩家通过挖掘的方式破坏。但是由于高效刷怪塔、凋灵相关设施、地狱交通等需求，玩家有时需要移除基岩来完成某个工程。于是，陆续有玩家发现了 Minecraft 程序中的漏洞，并开发出了一些移除基岩的方法。</p>
<p>最早在 2016年5月3日，Myren Eario 在 YouTube 上发布了一个利用活塞和 TNT 移除基岩的方案<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>。不过由于这个方案存在随机性，并且当时还有稳定性更高的弱加载区块龙蛋移除法，该方案并没有受到较大的关注。但在 1.13 修复了龙蛋相关的漏洞之后，玩家只能利用活塞来移除基岩。本文中提到的这个方法的应用开始变得广泛了。</p>
<h2 id="复现过程">复现过程</h2>


<figure>
    <picture>
                <source srcset="/2020/01/02/bedrock-breaking/fdaaeeb2/method_myren@2x.png" type="image/png" />
            <img src="/2020/01/02/bedrock-breaking/fdaaeeb2/method_myren@2x.png" alt="浅谈活塞破基岩法的不稳定性起源及解决方法" />
    </picture>
</figure>



<p>如上图所示，使用该方法需要一个伸出的活塞（粘性或普通的均可）和一个 TNT（图中白色的即为点燃的 TNT 实体）。玩家需要不断尝试按下右键，在源活塞底座的位置放置一个朝向基岩的活塞。如果不使用辅助放置的模组的话，这里需要一个不会被爆炸破坏的方块（如黑曜石）作为放置的参照物。</p>
<p>在保证右键点击的频率足够高的前提下有几率会将原先被活塞背对的基岩移除，并留下一个活塞方块。</p>


<figure>
    <picture>
                <source srcset="/2020/01/02/bedrock-breaking/9c9354c0/method_newcake_1@2x.png" type="image/png" />
            <img src="/2020/01/02/bedrock-breaking/9c9354c0/method_newcake_1@2x.png" alt="浅谈活塞破基岩法的不稳定性起源及解决方法" />
    </picture>
</figure>



<p>这个方法的变体可以在其它的视频中看到。例如：活塞可以朝上放置以从上往下移除地狱上方的基岩层。<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>在右侧红石块上放置 TNT 后，装备鞘翅的玩家快速双击空格缩小碰撞体积，钻入楼梯下方（在 1.14 以及之后的版本中可以用活板门下压法替代）</p>


<figure>
    <picture>
                <source srcset="/2020/01/02/bedrock-breaking/4bfef929/method_newcake_2@2x.png" type="image/png" />
            <img src="/2020/01/02/bedrock-breaking/4bfef929/method_newcake_2@2x.png" alt="浅谈活塞破基岩法的不稳定性起源及解决方法" />
    </picture>
</figure>



<p>之后对着黑曜石离自己最近的上棱角快速点击右键，就可以达到和 Myren 的方法相似的效果，移除基岩。</p>
<h2 id="方法原理">方法原理</h2>
<p>根据游戏事件顺序<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>可以得出以下事件顺序： 1. <strong>TNT 爆炸：</strong> TNT 实体在 Entity Update 阶段引发爆炸，破坏活塞底座、活塞臂和信号源。 - 若信号源先于活塞底座或活塞臂被破坏，活塞接收到方块更新，并计划在下一次的 Block Event 开始收回动作。接着活塞被破坏，掉落； - 若活塞底座或活塞臂其一先于信号源被破坏，则活塞整体会被破坏并掉落，不会在下一次 Block Event 进行动作； - <em>活塞在被破坏后不撤回 Block Event 中的计划。</em></p>
<ol start="2" type="1">
<li><p><strong>玩家放置：</strong> 在 Network Update 阶段（这里采用另一篇文章<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>的习惯，将玩家更新相关的阶段合二为一），服务器处理发出放置活塞的数据。由于该位置原有活塞已被摧毁，活塞被成功放置并面朝基岩。</p></li>
<li><p><strong>移除基岩：</strong> 如果在 1 中的信号源被最先破坏，那么下一 gt 的 Block Event 中，会在原有活塞的位置进行收回动作。由于游戏在这时 <em>不检测活塞朝向</em>，会根据新放置的活塞进行从下往上的收回。由于游戏尝试把不存在的活塞臂从基岩的位置抽回，基岩被替换成了空气方块。新放下的活塞本身变成了一个 36号方块。</p></li>
<li><p><strong>剩余步骤：</strong> 剩余步骤为：36号方块在经过 3 个 Tile Entity Update 之后变为一个与最初的活塞朝向一致的收回的活塞。</p></li>
</ol>
<p>以上便是活塞移除基岩的事件顺序。不难看出成功的关键在于步骤 1 中爆炸破坏方块的顺序，以及 2 中玩家是否能及时发送尝试放置方块的数据包。最后一步完全由稳定的游戏机制保障运行，无须担心。</p>
<p>步骤 2 可以由一个稳定的外部连点器软件，或者一个快速点击的模组保证，于是唯一难以解决的问题出现在步骤 1 上，而这也是一般人所知的不稳定性的来源。</p>
<p>另外，由于有时基岩无法移除是因为玩家在 2 中放置的活塞朝向并不与原有活塞相反，这里提出一个判断玩家操作是否正确的方法。观察 4 中最后产生的活塞，如果朝向与最初活塞相反，那么可以认为操作无误。否则可能是操作不当。</p>
<h2 id="不稳定性起因">不稳定性起因</h2>
<p>在实际操作过程中不难发现：装置、操作方法一致，但在不同的位置会产生不同的效果。有点位置能够移除基岩，而有的则不能。而且即使位置相同，TNT的摆放位置不同，结果也不同。</p>
<p>举个例子，在 1.13.2 中的 x=48, y=1, z=-6 位置放置一个向上的活塞，它的北侧放置黑曜石，南侧放置红石块，采用上文提及的 newcake 的方法。当 TNT 被放置在红石块上引爆时，无法移除活塞正下方的基岩；而当 TNT 被放置在伸出的活塞臂上引爆时，可以移除基岩。</p>
<p>根据上一章节的分析，在排除玩家操作失误的因素后，唯一的问题在于爆炸破坏方块的先后顺序。<em>因此这一章对爆炸部分的游戏源码进行阅读、分析，旨在找出不稳定性在 Minecraft 中的起因</em>。</p>
<p>这里的源代码来自 1.13.2 Rift 模组开发环境自带的 Minecraft Coder Pack。爆炸相关的 Java 类是 <code>net.minecraft.world.Explosion</code>，主要法方法有两个：<code>doExplosionA()</code> 统计所有需要被破坏的方块，并伤害实体；<code>doExplosionB()</code> 破坏统计的方块，产生方块掉落物并显示粒子效果。</p>
首先是 <code>doExplosionA()</code> 中的代码：
<details>
<p><summary>点击展开代码</summary>``` java public void doExplosionA() { Set<BlockPos> set = Sets.<BlockPos>newHashSet(); // 与 Set<BlockPos> set = new HashSet<BlockPos>(); 等价 int i = 16;</p>
<pre><code>for (int j = 0; j &lt; 16; ++j) &#123;
    for (int k = 0; k &lt; 16; ++k) &#123;
        for (int l = 0; l &lt; 16; ++l) &#123;
            if (j == 0 || j == 15 || k == 0 || k == 15 || l == 0 || l == 15) &#123; // 产生爆炸射线
                double d0 = (double)((float)j / 15.0F * 2.0F - 1.0F);
                double d1 = (double)((float)k / 15.0F * 2.0F - 1.0F);
                double d2 = (double)((float)l / 15.0F * 2.0F - 1.0F);
                double d3 = Math.sqrt(d0 * d0 + d1 * d1 + d2 * d2);
                d0 = d0 / d3; // 计算成单位向量
                d1 = d1 / d3;
                d2 = d2 / d3;
                float f = this.size * (0.7F + this.world.rand.nextFloat() * 0.6F); // 爆炸的强度
                double d4 = this.x;
                double d6 = this.y;
                double d8 = this.z;

                for (float f1 = 0.3F; f &gt; 0.0F; f -= 0.22500001F) &#123; // 强度的自然衰减
                    BlockPos blockpos = new BlockPos(d4, d6, d8); // 进行破坏判断的方块坐标
                    IBlockState iblockstate = this.world.getBlockState(blockpos);
                    IFluidState ifluidstate = this.world.getFluidState(blockpos);

                    if (!iblockstate.isAir() || !ifluidstate.isEmpty()) &#123;
                        float f2 = Math.max(iblockstate.getBlock().getExplosionResistance(), ifluidstate.getExplosionResistance());

                        if (this.exploder != null) &#123;
                            f2 = this.exploder.getExplosionResistance(this, this.world, blockpos, iblockstate, ifluidstate, f2);
                        &#125;

                        f -= (f2 + 0.3F) * 0.3F; //强度在破坏方块后的额外衰减
                    &#125;

                    if (f &gt; 0.0F &amp;&amp; (this.exploder == null || this.exploder.canExplosionDestroyBlock(this, this.world, blockpos, iblockstate, f))) &#123;
                        set.add(blockpos); // 方块被加入集合
                    &#125;

                    d4 += d0 * (double)0.3F; // 步进 0.3 个单位向量
                    d6 += d1 * (double)0.3F;
                    d8 += d2 * (double)0.3F;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;

this.affectedBlockPositions.addAll(set); // 由集合产生便于遍历的列表
// 后面是实体相关代码，与方块无关</code></pre>
}```
</details>
<p>这是 <code>doExplosionB()</code> 中的代码：</p>
<details>
<p><summary>点击展开代码</summary> ``` java public void doExplosionB(boolean spawnParticles) { // 之前是声音和粒子部分代码，与方块无关</p>
<pre><code>if (this.damagesTerrain) &#123;
    for (BlockPos blockpos : this.affectedBlockPositions) &#123;
        // 逐个破坏方块并产生粒子效果
    &#125;
&#125;

// 之后是火焰相关代码，与方块无关</code></pre>
}```
</details>
<p>可以看到，在这一部分的代码中，为了防止多次破坏同一个位置的方块，采用了将方块先统一放进一个集合中，再统一处理的策略。因此，最终的顺序取决于 <code>addAll(set)</code> 方法产生的列表的顺序。为了弄清楚这一点，需要先观察集合的实现方法。</p>
<p>集合的的初始化是 <code>Sets.&lt;BlockPos&gt;newHashSet()</code> 这个静态方法本身返回一个使用默认构造器初始化的 <code>java.util.HashSet</code>，和 <code>Set&lt;BlockPos&gt; set = new HashSet&lt;BlockPos&gt;();</code> 等价。由于 Java 中 <code>HashSet</code> 直接使用了哈希表，也就是内置了一个 <code>HashMap&lt;HashSet,Object&gt; map</code>，这里直接当作哈希表考虑。</p>
<p>哈希表是一个通过索引进行高速插入、查找和删除的数据结构。由于实际存在的对象数量过多，几乎不可能为每一个对象分配一个独一无二的索引值，因此每一个索引值都对应一个“哈希桶”（Hash Bucket），用于存放索引值相同的“相似”对象。</p>
<p>当 Minecraft 中的方块坐标，即 <code>BlockPos</code> 要存入哈希表，需要用它的三轴数值先计算出一个哈希值，也就是调用 <code>hashCode()</code>。产生的哈希值取决于三轴数值。在这之后，哈希值被用来调用 <code>hash()</code>，产生存放该坐标的哈希桶的索引值。由于哈希桶总数有限，需要把哈希值约束到一定范围内，因此最终被分配到哪个哈希桶还取决于哈希桶的总数。</p>
<p>为了保证哈希集各项操作的时间复杂度在 <span class="math inline">\(O(1)\)</span>，需要保证元素总数，<span class="math inline">\(n\)</span>，与哈希桶总数，<span class="math inline">\(m\)</span>，之比低于一个固定值——装载因子（load factor，<span class="math inline">\(\alpha\)</span>），否侧过长的哈希桶会严重降低速度。元素过多时，Java 会重新设置哈希桶数组的大小（即哈希桶的总数），并将原有的元素再分配到这些新的哈希桶里。由于这里哈希集的初始化没有指定大小和装载因子，在 TNT 爆炸破坏方块的过程中，Java 会多次增加哈希桶，并重分配元素。</p>
<p><span class="math display">\[\alpha \ge \frac{n}{m}\]</span></p>
<p>综上所述，爆炸破坏的顺序取决于 <strong>TNT 的破坏顺序</strong>，<strong>方块坐标</strong>以及 <strong>TNT 破坏方块的总数</strong>。在下一章中会对这些因素进行进一步的剖析，并且提出可行的解决方案。</p>
<h2 id="解决方案">解决方案</h2>
<p>一个可行的方案是对玩家附近的活塞和 TNT 在客户端进行模拟计算，得出可能的信号源位置，并用客户端的渲染效果对玩家进行提示。</p>
<p>运算的结果会在世界的渲染函数中使用。这里借助 malilib，对 Minecraft 的 <code>GameRenderer</code> 类的 <code>updateCameraAndRender()</code> 方法进行注入。渲染时，首先要设置 OpenGL 的各项参数，并且将坐标变换玩家的视角。之后获取玩家周围一定范围内的所有方块，针对活塞方块调用之前的 <code>getResults()</code> 方法获得可以放置信号源的坐标，并根据权重设置颜色进行渲染。这部分代码不多阐述，具体可以在我的 Github 上看到<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>。</p>
<h2 id="其它可行方案">其它可行方案</h2>
<p>在这里对另外两种可行方案进行简短介绍。两个都是由 Fallen_Breath 发现的。</p>


<figure>
    <picture>
                <source srcset="/2020/01/02/bedrock-breaking/f4a977ca/method_fallen_1-413x262@2x.png" type="image/png" />
            <img src="/2020/01/02/bedrock-breaking/f4a977ca/method_fallen_1-413x262@2x.png" alt="浅谈活塞破基岩法的不稳定性起源及解决方法" />
    </picture>
</figure>



<p>其一是在同一游戏阶段激活两个 TNT，一个仅破坏红石块，另一个仅破坏活塞。这里用稳定的红石更新顺序所导致的多个 TNT 的先后爆炸顺序来替代不稳定的哈希表顺序，并且构造也比较简单。<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>


<figure>
    <picture>
                <source srcset="/2020/01/02/bedrock-breaking/ad4e24ae/method_fallen_2-227x281@2x.png" type="image/png" />
            <img src="/2020/01/02/bedrock-breaking/ad4e24ae/method_fallen_2-227x281@2x.png" alt="浅谈活塞破基岩法的不稳定性起源及解决方法" />
    </picture>
</figure>



<p>另一个方法是利用红石线达到多个信号源位置，并且只要其中一个最先被破坏，其余的就会熄灭，进而更新活塞。虽然这个方法依然存在一定的随机性，不能防止活塞先于所有红石线被破坏的情况，但对于彻底随机打乱了方块破坏顺序的 1.15 来说却是个不错的方法。<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<h2 id="感谢">感谢</h2>
<p>感谢 TIS Trinity Union 中的 Fallen_Breath 等人提供的修改意见。</p>
<h2 id="参考资料">参考资料</h2>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>《Simple sidewards bedrock breaking method》作者： Myren Eario https://youtu.be/BL98BDMwyWM<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>《Simplest way to break Bedrock - Minecraft 1.13.1》作者：newcake https://youtu.be/Tu4C3QNBdRY<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>《[理论分析] 红石更新延迟理论》作者：Gamepiaynmo https://tieba.baidu.com/p/4078230299<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>《深度剖析Minecraft #1 游戏流程》作者：Fallen_Breath https://www.bilibili.com/read/cv4122124 以及 https://forum.tis.world/topic/270/深度剖析minecraft-1-游戏流程<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>BedrockBreakHelper https://github.com/LucunJi/BedrockBreakHelper<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>《[1.10~1.15+] 100%成功率的铁头功破基岩法》作者：Fallen_Breath https://www.bilibili.com/video/av79942615<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>作者：Fallen_Breath https://t.bilibili.com/333412049128925077<a href="#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
      <tags>
        <tag>minecraft</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>译注——关于《为什么人们热爱战争》</title>
    <url>/2021/03/02/comments-on-why-men-love-war/</url>
    <content><![CDATA[<p>起初<span id="more"></span>遇见这篇文章是因为在 Jreg 的视频 <a href="https://b23.tv/BV16f4y127nE">《我想死在一场战争里》</a> 的评论区看到有人推荐了这篇文章，读过以后感觉不错，就想翻译一下。</p>
<p>翻译这篇文章遇到的困难有两个。其一，这篇文章的原文似乎是扫描件，除了不计其数不当使用的大小写和标点符号以外，有不少拼写错误的单词。更要命的是，这篇文章在网上的资源出人意料地少，只有 <a href="https://www.esquire.com/news-politics/news/a28718/why-men-love-war/">Esquire</a> 和 <a href="https://public.wsu.edu/~hughesc/why_men_love_war.htm">华盛顿州立大学</a> 两处能找到，而且这两处应该是完全一致的——也就是说，一旦在一处发现了错漏，另一处也会有相同的错误，几乎无法求证。 其二，这篇文章涉及到了不少军事用语，有越战相关的单词，国内还没记录的作家和书籍。这些都是在我知识领域之外的。</p>
<p>虽然我经常把 <a href="https://www.deepl.com/translator">DeepL</a> 翻译器吹到飞起，但是它在针对上述问题常常无能为力。军事术语时不时还能弄对一两个，但遇上了错词、大小写标点混乱这些问题后，句意常常会不准确，需要手动对着原文修正。标点符号也常常会被转换为半角符号，而非中文文章使用的全角符号。</p>
<p>这篇文章在二月初初步翻译完（主要是机翻）。当时急着做完，又有点过度信任了 DeepL，没有做过多的校对，就草草发布了。后来参考群里反间兄的意见，重新对全文进行了一次大修，重新考据了一些术语，修正了一些原文导致的错误，并且调整一些句子、段落的语序。在三月初终于完成了第二次校对。</p>
<p>第二次校对结束后，所有国内没有翻译或翻译较少的人名、作品名都标注了原文，如沃尔特·斯科特（Walter Scott），菲利普·卡普托（Philip Caputo），《战争传闻》（<em>A Rumor of War</em>）等。基本上所有人名和作品都可以根据列出的中文或英文搜索到出处（当然要在国际互联网而非中文互联网）。术语、习语，例如“Praxiteles Swan”，“deuce-and-a-half truck”等基本修正完毕。一些地名、习语和原文中似乎有错漏的地方还加了额外的脚注，方便理解。面对最后的成品我可以说是尽力了。</p>
<p>这篇文章本身带给我的感受很多，但是这些感受又难以下笔写成字句。不过我认为，读过这篇文章的人，只要不是丧失理智的战争疯子，都应该有类似的感受。</p>
<p>作者从比较私人的角度描写了个体的心灵在战争中受到的冲击。当看到性与战争、创造与毁灭的时候，我想到的是《奇爱博士》里的各种讽刺的性暗示和性明示。性和爱终究是物极必反导致的伴生物，死亡、毁灭和荒谬仍旧是主旋律。文章中描写的性与爱，要么是病态般的感情投射，要么是病态般的填补空虚。想到这里，我想引用一段文字：</p>
<blockquote>
<p>但对人类和国家来说，压制人们热爱战争的原因，可能比承认它们更危险。在《现代启示录》中，罗伯特·杜瓦尔（Robert Duvall）饰演的旅长，打量着特别恐怖的战斗场面，非常悲壮地说：“你知道，总有一天这场战争会结束。”他显然是要做一个精神病患者，用扑克牌装饰敌人的尸体，在瓦格纳的乐曲中骑马上战场。我们嘲笑他——嘿！没有人是那样的人！但去年，在格林纳达，美国男孩们播放着瓦格纳冲向战场，新一代的人在模仿越战的电影，就像我们模仿二战的电影一样，什么也没学到，什么也没记住。</p>
</blockquote>
<p>在校对后半部分文章的时候，电脑播放的背景音乐还是瓦格纳的音乐，但实在难以感受到那种关于战争的狂热。不过如今的网络上充斥着那种对于战争，对于挺身而出战斗的幻想，让我不禁感到后怕：</p>
<blockquote>
<p>男孩子们并不是唯一容易产生这种幻想的人，它也攥住了那些从未参加过战争的老人。他们主持我们的葬礼时，也会流下和电影中士兵死亡时一样的眼泪——幻想的眼泪，廉价的眼泪。战争中对毁灭和杀戮的热爱，源于那种把战争当做游戏的幻想，但它因为在可怕的风险中被放纵而更具诱惑力。</p>
</blockquote>
<p>当然，这篇文章更多的是对于越战的描写。年轻人们从日常生活中脱离，为了某个目标而赶赴异国他乡，身边仅有几个未曾谋面的战友同胞。但是对于其他的战争，哪些情况会相同、哪些情况会不同，何为日常生活又何为战乱，都是可以议一议的。</p>
]]></content>
  </entry>
  <entry>
    <title>画展，米勒以及梵高等</title>
    <url>/2021/03/04/millet-van-gogh-and-dali/</url>
    <content><![CDATA[<p>去年发现本地的艺术博物馆刚好有米勒同代以及往后的艺术家的画展，去看了以后觉得挺不错。部分画作——其实是相当大一部分——是允许拍照的，这里就发一些自己喜欢的作品。拍摄技术不好，希望多多包涵。</p>
<span id="more"></span>
<p>展出的米勒的画作里，有一大部分是素描、版画。和他的油画一样，作为现实主义运动的标志人物之一，米勒的素描和版画大多也聚焦在田野和劳动人民上。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/72f457ab/millet-the-four-times-of-the-day-evening@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/72f457ab/millet-the-four-times-of-the-day-evening@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/72f457ab/millet-the-four-times-of-the-day-evening@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/72f457ab/millet-the-four-times-of-the-day-evening@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/72f457ab/millet-the-four-times-of-the-day-evening@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
（这副画我不记得是米勒还是他的后人的了，当时漏拍了标签）
</center>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/fbe88d92/millet-the-flight-into-egypt@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/fbe88d92/millet-the-flight-into-egypt@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/fbe88d92/millet-the-flight-into-egypt@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/fbe88d92/millet-the-flight-into-egypt@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
Millet, <i>The Flight Into Egypt</i>
</center>
<p>米勒不少的油画作品都已经深入人心了，所以拍摄的不多。这里就稍微放几张平时可能见得不多的照片。<em>Spring</em> 这幅画比较吸引我的地方在于地上和树上星星点点的花和乌云下面的彩虹。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/8f246451/millet-spring@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/8f246451/millet-spring@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/8f246451/millet-spring@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/8f246451/millet-spring@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/8f246451/millet-spring@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
Millet, <i>Spring</i>
</center>
<p>威廉罗洛夫斯的 <em>The Rainbow</em> 也挺好看，当然手机拍出来和实际去看完全是两个效果，没法比。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/294216db/roelofs-the-rainbow@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/294216db/roelofs-the-rainbow@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/294216db/roelofs-the-rainbow@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/294216db/roelofs-the-rainbow@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/294216db/roelofs-the-rainbow@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
Willem Roelefs, <i>The Rainbow</i>
</center>
<p>米勒之后的不少画家，例如梵高，都对他的一些画作进行过再创作。各种版本《收割者》《播种者》都是很经典的例子。英语好的可以看下<a href="https://en.wikipedia.org/wiki/Copies_by_Vincent_van_Gogh#Copies_after_Jean-Fran%C3%A7ois_Millet">这份梵高对米勒等人的再创作清单</a>。<del>（梵高，我的同人神触……）</del></p>
<p><em>Starry Night</em> 这副画，在艺术馆里看的时候很有感觉，特别是从侧面这样看过去。然而拍成照片以后那种很棒的感觉完全消失掉了，难受。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/7d582f0b/millet-starry-night@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/7d582f0b/millet-starry-night@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/7d582f0b/millet-starry-night@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/7d582f0b/millet-starry-night@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/7d582f0b/millet-starry-night@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
Millet, <i>Starry Night</i>
</center>
<p>梵高也创作过一副叫做 <em>The Starry Night</em>（中文译名叫《星月夜》）和一副叫做 <em>Starry Night Over the Rhône</em>（《罗纳河上的星夜》）的画，且前者比后者更有名（都快滥大街了）。但是这两幅画的内容、风格和米勒的作品相去甚远，有没有受到米勒的影响很难说。</p>
<p>之前多多少少对梵高有一种愚蠢的敬仰之情——就像那些“文艺青年”对太宰治的崇拜一样。这次去了画展以后发现自己并不是真的那么喜欢梵高的画——实际欣赏的时候那些笔触和颜色的冲击力对我来说还是太大了。反倒是米勒的作品让我看得更舒服一点。</p>
<p>在 <em>The Sower</em>这副画里面其实能看出米勒的《播种者》里的经典形象：农夫右手播种，左手收在胸前，向右侧迈步走去。梵高画作里的的太阳经常会画得又圆又大，有一种神圣感。我猜这多半是因为梵高自己是一个虔诚的信徒。在他画的另一幅<a href="https://www.artsy.net/artwork/vincent-van-gogh-the-sower"><em>The Sower</em></a>（梵高有好几幅《播种者》）里，这种特征更明显。他直接把一个又大又黄又圆的太阳放在了背景正中心。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/3bd11d9b/van-gogh-the-sower@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/3bd11d9b/van-gogh-the-sower@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/3bd11d9b/van-gogh-the-sower@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/millet-van-gogh-and-dali/3bd11d9b/van-gogh-the-sower@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/millet-van-gogh-and-dali/3bd11d9b/van-gogh-the-sower@2x.jpg" alt="画展，米勒以及梵高等" />
    </picture>
</figure>



<center>
Van Gogh, <i>The Sower</i>
</center>
<p>那天除了米勒、梵高等一众人的画作以外，还看到了达利的画作若干。以前看画作的时候都没有注意过尺寸，实际去看的时候发现达利的许多画作都很小，但是细节却非常丰富。这是比较惊讶的一点。由于达利的画作不允许拍照，这里就不放出来了。有兴趣的可以去网上搜索一下。</p>
]]></content>
      <tags>
        <tag>art</tag>
        <tag>paintings</tag>
      </tags>
  </entry>
  <entry>
    <title>简易修改 Minecraft 字节码</title>
    <url>/2020/01/16/minecraft-bytecode-modding/</url>
    <content><![CDATA[<div data-align="center">
<font size=6>100% vanilla!</font>
</div>
<span id="more"></span>
<h2 id="简介">简介</h2>
<p>之前看到 1.15.2-pre1 更新了玩家种植树木也会刷新蜂巢的特性，研究完机制以后想着修改一下蜂巢刷新几率来方便测试。</p>
<p>可是这时候 fabric 啥的还没更新，于是想到了之前 EDDExample 说过的修改字节码大法。顺便用上 Mojang 1.14.4 以来的官方反混淆表。</p>
<p>EDDExample 在视频里用的是 JByteMod 来修改字节码。可以在 https://github.com/GraxCode/JByteMod-Beta/releases 下载到。</p>
<h2 id="反混淆">反混淆</h2>
<p>前往 https://github.com/hube12/DecompilerMC/releases ，在 Releases for lazy users 下面下载适合操作系统的版本，这里就选择 Windows.zip。</p>
<p>将压缩包解压，会看到有一个 McDecompiler.exe 文件，运行后根据提示选择，依次输入 <code>y</code>，<code>cfr</code>，<code>1.15.2-pre1</code> 以及 <code>y</code>。</p>
<p>等待几分钟，程序运行完毕后就可以在 <code>src</code> 文件夹里看到反混淆好的源码；在 <code>mappings</code> 里看到反混淆表。</p>
<h2 id="查找修改目标">查找修改目标</h2>
<p>通过在反混淆的源码中搜索，可以找到负责在树上生成蜂巢的装饰器 <code>net.minecraft.world.level.levelgen.feature.treedecorators.BeehiveDecorator</code></p>
<p>这里通过产生一个随机的单精度浮点数，实现了蜂巢生成概率的随机化： <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">place</span><span class="params">(LevelAccessor var1, Random var2, List var3, List var4, Set var5, BoundingBox var6)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (var2.nextFloat() &lt; <span class="keyword">this</span>.probability) &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由于 Minecraft 中的类名、方法名是经过混淆的，我们无法直接查看字节码。在反混淆表中搜索类名 <code>BeehiveDecorator</code>，会发现它的混淆后的类名是 <code>ciq</code>，方法 <code>place</code> 混淆后的名称是 <code>a</code>。值得注意的是，一个混淆的类会包含多个同名但不同参数的方法，因此需要额外留心方法的参数数量和类型。</p>
<h2 id="修改字节码">修改字节码</h2>
<p>用解压软件打开版本文件 <code>1.15.2-pre1.jar</code>，单独拖出 <code>ciq.class</code> 文件，用 JByteMod 打开这个类文件，开始修改。</p>
<p>之前我试过直接打开整个 jar，结果修改后无法正常启动游戏。后来折腾了半天才发现单独拖出来修改类文件就好了。</p>
<p>首先定位到要修改的方法。之前找到的方法拥有6个参数，其中第2、3、4、5个参数的类型分别是 <code>Random</code>，<code>List</code>，<code>List</code> 以及 <code>Set</code>（Java 自带的类型一般不会被反混淆）。点开这个方法，发现开头的几行字节码分别是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">aload 2</span><br><span class="line">invokevirtual float Random.nextFloat()</span><br><span class="line">aload 0</span><br><span class="line">getfield float ciq.b</span><br><span class="line">fcmpl</span><br><span class="line">iflt 2</span><br><span class="line">label 1</span><br><span class="line">return</span><br><span class="line">label 2</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>通过翻阅 <a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-6.html">JVM 指令集</a>，可以得知这几行指令的效果：</p>
<ol type="1">
<li>加载下标为 2，即类型为 <code>Random</code> 的传入参数的引用；</li>
<li>调用该对象的 <code>nextFloat()</code> 方法，返回一个 <code>float</code>；</li>
<li>加载下标为 0 的传入参数，即 <code>this</code> 的引用；</li>
<li>获取该对象的成员变量，对象属于类 <code>ciq</code>，对象名是 <code>b</code>，变量类型是 <code>float</code>；</li>
<li>比较 (2) (3) 两处的 <code>float</code> 值；</li>
<li>如果 (3) 处小于 (2) 处，跳转到标签 2 处执行剩余指令，否则继续往下执行 <code>return</code> 退出方法。</li>
</ol>
<p>这几行描述的内容和反编译出来的 <code>if (var2.nextFloat() &lt; this.probability) &#123;&#125;</code> 对应。没问题，接着进行下一步。把前两行删去，替换成 <code>ldc Float 0.0</code> 就可以变成每次尝试必定成功的 <code>if (0.0f &lt; this.probability) &#123;&#125;</code>。</p>
<p>删除前两行 -&gt; 右键点击 <code>getfield</code> -&gt; 插入之前 -&gt; LdcInsnNode -&gt; 类型选择 <code>Float</code>，值输入 <code>0.0</code>。</p>
<p>完成后保存类文件，准备替换。</p>
<h2 id="核心-jar-替换法">核心 jar 替换法</h2>
<p>核心 jar 替换法，顾名思义就是直接替换 <code>versions</code> 文件夹中核心版本文件 <code>1.15.2-pre1.jar</code> 的类。为了防止游戏对 jar 进行完整性检测，需要删除 jar 中的 <code>META-INF</code> 文件夹，并且删除 <code>1.15.2-pre1.json</code> 中的下载链接。具体链接内容因版本而异，并且注意逗号： <figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;downloads&quot;: &#123;&quot;client&quot;: &#123;&quot;sha1&quot;: &quot;9f28455f9f9d09294e0ba19beb13dc26b39a9582&quot;, &quot;size&quot;: 15531212, &quot;url&quot;: &quot;https://launcher.mojang.com/v1/objects/9f28455f9f9d09294e0ba19beb13dc26b39a9582/client.jar&quot;&#125;, &quot;client_mappings&quot;: &#123;&quot;sha1&quot;: &quot;6c81c6f2e6ff0c3a2795f5d336c63b0740a60a45&quot;, &quot;size&quot;: 4971880, &quot;url&quot;: &quot;https://launcher.mojang.com/v1/objects/6c81c6f2e6ff0c3a2795f5d336c63b0740a60a45/client.txt&quot;&#125;, &quot;server&quot;: &#123;&quot;sha1&quot;: &quot;5db50a719dc40d63aa95c6bdc5b302e425f673f2&quot;, &quot;size&quot;: 36175423, &quot;url&quot;: &quot;https://launcher.mojang.com/v1/objects/5db50a719dc40d63aa95c6bdc5b302e425f673f2/server.jar&quot;&#125;, &quot;server_mappings&quot;: &#123;&quot;sha1&quot;: &quot;f59bfc0ebb62bc7802af0567ad79592274c56943&quot;, &quot;size&quot;: 3737013, &quot;url&quot;: &quot;https://launcher.mojang.com/v1/objects/f59bfc0ebb62bc7802af0567ad79592274c56943/server.txt&quot;&#125;&#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="运行">运行</h2>
<p>如果一切操作都没有问题，那么游戏将能够正常的启动。</p>
<p>创建一个新的世界，在花的边上种下一棵白桦树或橡树，必定会产生一个蜂巢。</p>


<figure>
    <picture>
                <source srcset="/2020/01/16/minecraft-bytecode-modding/a7616155/2020-01-16_15.02.29@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/01/16/minecraft-bytecode-modding/a7616155/2020-01-16_15.02.29@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/01/16/minecraft-bytecode-modding/a7616155/2020-01-16_15.02.29@2x.png" alt="简易修改 Minecraft 字节码" />
    </picture>
</figure>



<h2 id="multimc-配置方法">MultiMC 配置方法</h2>
<p>MultiMC 提供了方便的 Jar mod 安装方式。只要删除 <code>META-INF</code> 文件夹，就可以在 Edit Instance 中选择 Add to Minecraft.jar 或者 Replace Minecraft.jar，选择修改后的 jar 载入就可以了。</p>
<p>需要注意的是，再次修改 jar 过后，需要在列表中移除并重新加入修改后的 jar。</p>
<h2 id="感谢">感谢</h2>
<p>EDDxample，他在 YouTube 上有不错的关于代码和模组制作的视频 https://youtu.be/T_658BztqVE ，使用 JByteMod 的点子也是从这个视频里学到的。</p>
]]></content>
      <tags>
        <tag>minecraft</tag>
        <tag>Java</tag>
        <tag>bytecode</tag>
      </tags>
  </entry>
  <entry>
    <title>极简风描图</title>
    <url>/2019/02/24/minimalist-images/</url>
    <content><![CDATA[<p>基本上就是PS用钢笔勾线然后涂色，分辨率很高。之前看到某位兄贵（不知道怎么称呼）的帖子 <a href="http://tieba.baidu.com/p/5841920541">极简主义样式化的hsi</a>，觉得很nb，自己也做了些图，就把图堆在这里吧。 <span id="more"></span> --- 《不吉波普不笑》的ED基本上都是这种极简的风格，自己挺喜欢的，于是就描了一张。 <a href="./boogiepop.png">点此查看高清大图(7680*4320)</a> | <a href="./boogiepop_wb.png">白色背景版本(7680*4320)</a> 

<figure>
    <picture>
                <source srcset="/2019/02/24/minimalist-images/697804b4/boogiepop_small@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2019/02/24/minimalist-images/697804b4/boogiepop_small@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2019/02/24/minimalist-images/697804b4/boogiepop_small@2x.png" alt="极简风描图" />
    </picture>
</figure>


 原图： 

<figure>
    <picture>
                <source srcset="/2019/02/24/minimalist-images/b84aac27/boogiepop_original@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2019/02/24/minimalist-images/b84aac27/boogiepop_original@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2019/02/24/minimalist-images/b84aac27/boogiepop_original@2x.png" alt="极简风描图" />
    </picture>
</figure>


 《不吉波普不笑》给我的感觉挺惊艳的，Boogiepop 跟我在中二时期的人设挺像的： - 能遮盖身体 95% 的长袍/披风/卫衣 √ - 平时没事的时候当一个普通的中学生 √ - 出场时恰到好处的笛声/口哨声 √ - 很强并且能恰到好处又独到地处理事件 √ 反正挺喜欢的，就用来作头像吧</p>
]]></content>
      <tags>
        <tag>anime images</tag>
      </tags>
  </entry>
  <entry>
    <title>Noita 施法机制分析</title>
    <url>/2020/09/12/noita-casting-mechanics/</url>
    <content><![CDATA[<p>类似编程语言的法术编排是 Noita 中的一大亮点，也是一大难点。<a href="https://www.bilibili.com/read/cv3761812">《如何在&lt;Noita&gt;中打造爆款法术》</a>（或曰《&lt;Noita&gt;法术编程指南》）一文较完整地讨论了法术编排和释放的机制，但依然存在不少失误。本文尝试在此基础上进行进一步的假设和实验，力图提出一个更加普适、更加易于理解和分析的理论，为 Noita 的游玩提供帮助。</p>
<span id="more"></span>
<h2 id="讨论范围">讨论范围</h2>
<p>本文将着重讨论以下几类法术：</p>
<ul>
<li><strong>投射物</strong>（projectile）：既包括从法杖中飞出后拥有初速度的法术，即火花弹、炸弹、链锯之类一般意义上的投射物；也包括一般情况下不拥有初速度的法术，即粘液雾、静止之环、雷霆爆炸等静态投射物（static projectile）。</li>
</ul>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/d9eaad0c/projectiles@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/d9eaad0c/projectiles@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/d9eaad0c/projectiles@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<ul>
<li><strong>投射修正</strong>（projectile modifiers）：单独放置于法杖中不提供任何效果，需要和投射物以一定的先后顺序搭配，才能依附投射物产生效果的法术。如伤害增强、火焰轨迹、物质吞噬者、反重力等。</li>
</ul>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/72cbaabb/projectile-modifiers@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/72cbaabb/projectile-modifiers@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/72cbaabb/projectile-modifiers@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<ul>
<li><strong>多重施放</strong>（multicast）：增加施放数量的法术。可以让一根法杖一次射出更多的投射物，或者人一个带有触发/定时的投射物施放更多的投射物。如x重法术，x重散射法术和阵型。</li>
</ul>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/422bd174/multicasts@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/422bd174/multicasts@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/422bd174/multicasts@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>以下法术不会深入讨论：</p>
<ul>
<li><strong>被动</strong>（passive）：如能量盾、火把等，安装在法杖内无须施法即可在法杖处生效的法术。即使如此，它们依然会被以类似投射修正的方式在法杖内被触发。因此，可将它们视为对法杖起作用的投射修正看待。</li>
<li><strong>实用</strong>（utility）：如全知之眼，类似静态投射物，但仅仅在施法的一瞬间提供实用功能。</li>
<li><strong>材料</strong>（material）：如点金（Touch of Gold）、酸液之海、水等，类似静态投射物，但仅仅在施法的一瞬间在世界内直接生成/转化物质。</li>
</ul>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/75577d29/passive-utility-material@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/75577d29/passive-utility-material@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/75577d29/passive-utility-material@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>关于魔杖 - 法杖的施放延迟、充能时间不会讨论。 - 始终施放的效果是：每次施法时最先施放始终施放的法术，并且不消耗魔力和施放数</p>
<p>另外，本文不会过多解释各种法术的效果和使用时的注意事项、搭配技巧。</p>
<h2 id="分析方法的改进">分析方法的改进</h2>
<p>要分析法术的不同编排所产生的效果，首先需要将法杖内的法术分割成有意义、相互关联的部分，从而化整为零，方便理解。</p>
<p>《&lt;Noita&gt;法术编程指南》提出了将法术拆分成层次明显的树状图，并根据一定原则加以分析的思路。</p>
<blockquote>
<p><strong>投射修正法术三原则</strong></p>
<ul>
<li><p>投射修正法术不修正投射物(包括静态投射物) 以外的其他法术,例如投射修正法术自身、物质法术、被动法术等。</p></li>
<li><p>如果投射修正法术是某法术的父法术,那么二者之间有其他触发法术时不产生修正;如果投射修正法术是某法术的子法术,那将不产生修正。</p></li>
<li><p>投射修正法术上述情况之外的任何法术。</p></li>
</ul>
</blockquote>
<blockquote>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/d51250bb/spell-tree@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/d51250bb/spell-tree@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



</blockquote>
<p>图中的火焰轨迹应当同时修正能量球和带有触发的火花弹，然而在图中它与火花弹处于两条不同的分支，并且处于能量球的上方，容易让人误以为能量球是火焰轨迹的子法术，火花弹与火焰轨迹不相干，不接受修正。另外，这个法术树可以被搭建成多种完全等效的结构：火焰轨迹在带有触发的火花弹处，而不在能量球一侧；或者干脆将火焰轨迹置于阵型-分叉的上方。</p>
<p>为了减少误导性，简化分析过程，这里提出了一种围绕触发/定时法术展开的，贴合横向编排思路的分段分析方式。</p>
<h3 id="施法数的变化">施法数的变化</h3>
<p>观察如下序列在编辑后的<strong>第一次发射效果</strong>，可以看到只射出了有“燃烧轨迹”和“伤害立场”的火花弹和能量球体，没有“蛇形”的效果，没有发射魔法箭。</p>
<p><img src="noita-casting-mechanics/basic.png" style="zoom: 80%;" /></p>
<p>如果按照从左到右的思维去理解，可以认为法杖在“二重散射法术”这里消耗了法杖自带的 1 施放数，并且增加了多重施放的 2 施放数。随后从左到右涉及到燃烧轨迹、火花弹、伤害力场、能量球体。到能量球体处，施放数量被两个投射物法术消耗殆尽，于是后续的蛇形和魔法箭没有涉及到此次施法。</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/a415673f/casts-change@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/a415673f/casts-change@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/a415673f/casts-change@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>以上是施法数的变化规律。可以看出，<strong>投射修正不消耗施法数，其它法术都会消耗 1 施法数，多重施放会在消耗 1 施法数的基础上再增加若干施放数</strong>。</p>
<h3 id="触发与定时法术">触发与定时法术</h3>
<p>带有触发/定时的投射物法术时，触发/定时法术会携带一部分法术。这些<strong>触发/定时法术会独立计算施放数</strong>。</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>在上面的例子中，“带有触发的火花弹”单独对施放数进行计算，从而能够在远处施放伤害力场和能量球体。这个行为使得<strong>外部的施放数在进行计算时跳过了伤害力场和能量球体</strong>，直接对魔法箭进行计算。</p>
<p>另外，燃烧轨迹只对火花弹和魔法箭有效；伤害力场只对能量球体有效。这时候我们需要对投射修正的作用范围进行考虑。</p>
<h3 id="投射修正的范围">投射修正的范围</h3>
<p>当同时考虑多个投射修正、多重施放和带有触发/定时的法术时，情况会稍显复杂。为了探明这一点，我们需要对下面这个序列进行分析：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/8c8dd99a/complex@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/8c8dd99a/complex@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/8c8dd99a/complex@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>如果直接进行观察，很可能会误以为燃烧轨迹只对能量球体和火花弹有效。然而在分析后会发现，魔法箭、能量球体和火花弹都会享受燃烧轨迹和伤害力场的投射修正效果。可以说，<strong>多重施放只会造成施放数的增减，并不会产生如同定时/触发法术那样的嵌套关系</strong>。</p>
<p>并且，由于沉重一击只对带有定时的火花弹有效；燃烧轨迹和伤害力场只对魔法箭、能量球体和火花弹有效。再结合之前的几个例子，可以推断出<strong>投射修正对且仅对嵌套关系中同一层的所有法术生效</strong>。在 <em>触发与定时法术</em> 段落中的例子里，由于魔法箭和带有触发的火花弹同属于施放数计算的最外层，都会享受到处于同一层的燃烧轨迹。</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/54bb0bbe/basic-trigger@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h3 id="快速分析法">快速分析法</h3>
<p>根据之前提到的几个要点，这里归纳总结出一个快速分析法术嵌套关系、投射修正作用范围的方法：</p>
<ol start="2" type="1">
<li>投射修正不消耗施法数，其它法术都消耗 1 施法数，多重施放会在消耗 1 施法数的基础上再增加若干施放数。</li>
<li>定时/触发法术会造成嵌套关系。不同嵌套层的施放数分别计算。</li>
<li>多重施放增加的施放数作用与它所处的嵌套层。</li>
<li>内层的施放数计算完毕后，外层的施放数应该跳过内层部分计算。</li>
<li>投射修正对且仅对所处的嵌套层内的所有投射物起效。</li>
</ol>
<p>根据快速分析法，在《&lt;Noita&gt;法术编程指南》中提到的法术序列，可以在快速计算完施放数后，拆分成如下三部分：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/1f2cd109/separation@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/1f2cd109/separation@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/1f2cd109/separation@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>对分段进行整理，法术序列最终变成了这样的嵌套关系，一目了然：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/857e1c03/separation-2@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/857e1c03/separation-2@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/857e1c03/separation-2@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h2 id="大家都是投射修正">大家都是投射修正！</h2>
<h3 id="多重施放可以当投射修正">多重施放可以当投射修正</h3>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/fbf5926b/all-formations@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/fbf5926b/all-formations@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/fbf5926b/all-formations@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>既然多重施放并不造成嵌套关系，那么阵型法术并不能将后方的法术单独囊括起来，组成一定的形状。</p>
<p>因此，阵型类法术实际上<strong>以类似投射修正的方式在一定角度内均匀顺时针分布所处嵌套层中所有的投射物</strong>。例如，阵型-分叉能够作为一个投射修正，被修正的投射物在 ±45° 的范围内顺时针均匀施放：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/6ccf97e1/formation@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/6ccf97e1/formation@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/6ccf97e1/formation@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>以此类推，阵型-前后、阵型-五边形、阵型六边形是在 ±180°，即一整圈的范围内均匀分布投射物，阵型-上下的范围则是 ±180°。阵型-三叉的范围比阵型-分叉的范围稍小一点，约为 ±30°。</p>
<p>当有多个阵型法术同时存在时，最左边的法术决定分布范围：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/86678190/formation-priority1@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/86678190/formation-priority1@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/86678190/formation-priority1@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>





<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/d544e42a/formation-priority2@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/d544e42a/formation-priority2@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/d544e42a/formation-priority2@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h3 id="投射物也可以当投射修正">投射物也可以当投射修正</h3>
<p>事实证明，投射修正的分类并没有那么明确——部分投射物也能提供类似的效果。</p>
<p>例如玩家们喜闻乐见的火花弹，就提供了 +5% 暴击和 -1 度散射的修正效果。而这些修正效果，是对同一嵌套层内所有法术起效的。因此，当我们用丧心病狂的 20 个火花弹填满一个法杖，并让它们一次性发射出来的时候，每一发火花弹都有着 20 * 5% = 100% 的暴击加成，并且总共有 20 * (-1°) = -20° 的散射修正。每一发都精准而致命：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/ccafef7b/spark-crit@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/ccafef7b/spark-crit@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/ccafef7b/spark-crit@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h2 id="法术池的透支">法术池的透支</h2>
<p>《&lt;Noita&gt;法术编程指南》一文中也提到了“法术池”这个概念：在切换法杖和编辑法术时，法杖会刷新它的“法术池”。有序法杖的法术池中全部法术按照玩家设置的顺序排列；而乱序法杖的法术池中的法术是随机打乱的。游戏施法时并不直接从法杖中读取法术，而是从法术池读取。</p>
<blockquote>
<p>可以发现，如果一次施法用尽了法术池，则魔杖会立即生成新的法术池继续施法，同时魔杖开始充能。但是如果一次施法第二次用尽了法术池，施法将强制终止……</p>
<p>——《&lt;Noita&gt;法术编程指南》</p>
</blockquote>
<p>在法杖中放入两只带有定时的光剑。当游戏处理到第二个光剑时会发现：光剑还可以继续嵌套，而法术池已经耗尽。如果编程指南中的这段话属实，那么游戏会生成新的法术池，再次以相同的顺序供应两个光剑，用尽第二个法术池，强制终止施法。最终效果会是长度为四倍的光剑。然而 ，实际情况下射出的却是长度为二倍的光剑：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/96eeba25/lightdrill@2x.png"media="(min-width: 40em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/96eeba25/lightdrill@1x.png"media="(max-width: 39.99em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/96eeba25/lightdrill@1x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h3 id="有限的透支">有限的透支</h3>
<p>通过在以下法杖最前端填充 1~4 个火花弹并进行实验，会发现：带有触发的火花弹进行透支法术池时，总是会恰好发射出前端的所有火花弹；并不会透支到带有触发的火花弹本身。由此可以得出，<strong>每次施放的总法术数量不得超过法术池的法术数量</strong>。</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/63ae9ce7/overuse-test@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/63ae9ce7/overuse-test@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h3 id="法术池何时刷新">法术池何时刷新？</h3>
<p>如果在一只乱序法杖中放入魔法弹和带有定时的火花弹，按照编程指南的理论，如果第一个法术池是｛魔法弹，带有定时的火花弹｝，在射出单发魔法弹后，下一次射出带有定时的火花弹时会进行透支。如果在透支前刷新了法术池，由于法杖时乱序的，将有概率刷新出｛带有定时的火花弹，魔法弹｝这样的法术池。结果是会出现两个嵌套的带有定时的火花弹。然而事实上并不会出现这样的射击效果。</p>
<p>因此这里可以推导出关于法术池的第二条规律：<strong>当法术池透支出现时，游戏并不会立刻刷新法术池，而是从头再次使用原来的法术池。在计算完施放的所有法术后，再刷新法术池。</strong></p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/5649f4ab/shuffle@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/5649f4ab/shuffle@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/5649f4ab/shuffle@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h3 id="用投射修正射出子弹">用投射修正射出子弹！</h3>
<p>以下是一个简单却有实用性的例子：</p>
<p>第一次点击鼠标，法杖会施放出带有加速修正的霰弹，法术池剩余一个降低散射。</p>
<p>第二次点击鼠标，由于降低散射是投射修正，不减少施放数，游戏透支法杖，从头获取加速修正和霰弹。第二次的法术组合是｛降低散射，加速，霰弹｝。之后，法杖重新充能。</p>
<p>这样编排法杖的好处量两个：如果充能时间大于施放延迟，适当将投射修正置后可以利用法术池透支机制，实现每次充能可以设计两次的效果。另外，这样编排可以让霰弹第一发保持散布，第二发降低散射，集中火力，并且同时具备加速的修正效果，可以同时打击体积小、数量多和高生命、数量少的怪物。</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/8646be69/pool-simple@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/8646be69/pool-simple@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<h2 id="综合性例子">综合性例子</h2>
<p>这里举一个综合性较强的例子，完整阐述一下这篇文章提到的机制：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/40d4715e/final-example@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/09/12/noita-casting-mechanics/40d4715e/final-example@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/40d4715e/final-example@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>首先注意到法杖的施放数是 2，因此第一次施法会毫无悬念地发射出一发霰弹和一发火花弹（没有加速修正）。</p>
<p>第二次施法从加速修正开始。三重施放与阵型-背后使定时火花弹的施放数量达到 1 + ( -1 + 3 ) + ( -1 + 2 ) = 4，但是定时火花弹的右侧只有三个普通火花弹，于是需要从头透支法术池。目前施放了 8 个法术，法术池有10个法术，因此可透支上法术池最开始的一颗火花弹，于是定时火花弹攒齐了四个投射物法术。</p>
<p>这时候不要忘了法杖的施法数是 2。由于目前施放了 9 个法术，可以继续“透支”法术池。再加上霰弹，法杖的两个施法数也被满足了。</p>
<p>将第二次施放的法术序列按照嵌套关系分段后，效果如下图所示：</p>


<figure>
    <picture>
                <source srcset="/2020/09/12/noita-casting-mechanics/01c177ff/final-example-analysis@2x.webp" type="image/webp" />
                <source srcset="/2020/09/12/noita-casting-mechanics/01c177ff/final-example-analysis@2x.png" type="image/png" />
            <img src="/2020/09/12/noita-casting-mechanics/01c177ff/final-example-analysis@2x.png" alt="Noita 施法机制分析" />
    </picture>
</figure>



<p>最后统计一下所有的投射修正：法杖直接发射的定时火花弹与霰弹都是有加速修正和火花弹的 +5% 暴击修正的；定时火花弹触发的四个火花弹都有沉重一击修正和四个火花弹提供的 4 * 5% = 20% 的暴击修正。另外，阵型-背后使得这四个火花弹会在 ±180° 内均匀散布。</p>
<p>施放效果：</p>


<figure>
    <video autoplay="true" loop="true" muted="true">
            <source src="/2020/09/12/noita-casting-mechanics/be5f6984/final@2x.mp4" type="video/mp4">
    </video>
</figure>



<h2 id="鸣谢">鸣谢</h2>
<p>Noita 贴吧交流1群的 <a href="https://space.bilibili.com/7238810">谷戻り</a> 创作的 <a href="https://www.bilibili.com/read/cv3761812">《如何在&lt;Noita&gt;中打造爆款法术》</a>（《&lt;Noita&gt;法术编程指南》）。没有这篇文章也就没有我今天想到的这些理论。 和他的交流也令我很受启发。</p>
<p>Bilibili 的 <a href="https://space.bilibili.com/51719">196⑨</a> 的一系列 Noita 直播和游戏录像。火花弹类似投射修正的效果是最早从他的视频里了解到的。直播和录播都做的很有意思。</p>
]]></content>
      <tags>
        <tag>noita</tag>
      </tags>
  </entry>
  <entry>
    <title>关于 Minecraft 社区规范</title>
    <url>/2020/04/18/on-minecraft-community-custom/</url>
    <content><![CDATA[<p>目前的 Minecraft 社区中，一直存在着关于红石、建筑、指令各领域用户作品归属、使用、再创作等问题的争论。这些争议短则一天，长则一周甚至一月。这些争议很少能够被较为圆满地解决，而由这些争议所引发的社区中的进步就更是凤毛麟角。 <span id="more"></span></p>
<p>了解一些英文的读者可以看出，这篇文章的标题是 <em>On Minecraft Community Custom</em>，致敬了大作家蒙田的文章 <em>On Custom</em>。作为一次东施效颦，在这篇文章里我会尝试着以怀疑态度对一些 MC 社区中的观点进行反驳。此文仅代表我在写作此文时的态度——我的观点必然会随着时间或多或少地变化。另外，我也期待与各位读者进行相关话题的探讨。</p>
<p>为了讨论对 MC 玩家作品的使用和借鉴规范，我们回到问题的根本处。之所以需要此类探讨，是因为现存的法律体系难以给出一个令人满意的答案。将视野拉远，互联网的版权问题一直存在着争议：迪士尼层出不穷的版权官司，漫画本地化人员的冷遇，“搬运工”涉及到的种种争议。互联网上作品传播、保存、评论的简单快捷注定使得非互联网领域的版权规范在这里显得古板而笨拙。于是各个网络社区的用户都尝试着在表达创作的同时自行约定规范。经过较长一段时间的积淀后，这些零散的规范逐渐变得深入人心，由此便形成了各种社区规范习俗。MMD[1]会要求制作者注明“借物表”，即列出所使用的模型的作者；不去“本家”（即原作）刷翻唱也称成为音乐相关作品的礼仪规范。</p>
<p>然而，并不是所有用户社区都可以在这样的一个过程中形成一套自己的规范，Minecraft 社区就是一个例子。可以做出如下分析：由于入门 Minecraft 游戏并没有太大的难度，玩家并不会刻意地加入专门讨论这个游戏的社区。他们可以只是用这个游戏打发业余时间，与朋友联络。而另一些事物，例如 音MAD[2]，MMD 等，都对用户有着较高的入门要求。因此用户更倾向于加入一个专一的社区来更高效地提升水平。由于 Minecraft 用户完全可以游离于专门的社区之外，很难确保他们对于社区的规范有所了解。另外，Minecraft 服务器使得玩家更倾向于分散为更小的群体，各自为政。这些小群体内部往往有着比外部社区更高的交流。这些小群体之间并非没有交流，但是往往较难暴露出观点的一些差异。</p>
<p>这些关于作品所有权、使用方法的意见差异，往往会导致群体之间的争论，并且在这些争论中被暴露出来。不过由于缺乏有组织的、理性的思考，这些争论往往并不会产生什么真正有利社区的结果——休战只是为了双方止损，而观念的差异却没有被解决。持有不同意见的个人、群体之间难以建立有效的对话。观点的交流往往被妥协所取代。</p>
<p>在这些争论中，一种常见的观点是对现存版权法律的“拿来主义”。持有这种观念的人通常会使用现存法律条文中的规定来画出网络上侵权与非侵权的界线，并据此认为，应有的裁定已经完成，剩下的只是依照现有条文进行处罚。然而，在经过考虑以后，人们应该会发现这种思维只是图一时之方便的偷懒之举。这种观点错误地判断了原因与结果：因现有法律条文难以较好地适配网络社区，而需要对此乱象进行更细致的讨论；并非因现存的种种乱象，需要引用现存的法律条文来进行规范。如果现存的法律条文能较好地对网络社区进行规范，各种争执便不会产生。而目前出现的争论，正是现有条文无法维持社区秩序的印证。</p>
<p>于是，问题从来没有从根本上解决，因为这种生搬硬套往往难以让人信服。正如福熙对于第一次世界大战的评论[3]：</p>
<center>
<i>This is not peace. It is an armistice for 20 years.</i>
</center>
<center>
<i>这不是和平。这是二十年的休战。</i>
</center>
<p>这种“拿来主义”是一种因恐惧争论进一步激化而不愿深入探讨问题的消极作风。不仅不能提供一种有效的解决手段，反而会使这个社区的成员产生一种“有法可依”的错觉。一旦类似争议再次爆发，用户便会出现一种奇妙的心理状态。他们对于被怀疑侵权者产生了一种犹如敌视罪犯一般的道德谴责，同时又对假定的秩序无法被有效遵守产生一种沮丧、悲观态度。于是常常会出现对被怀疑者的激烈声讨，与对社区整体的不信任。为了不使文章离题，这里不对常见的有罪推定、非黑即白等进一步激化矛盾的误区进行赘述，不过作为题外话，小心地求证，并大胆假设正方反方意见应当位列行为准则之中。</p>
<p>基于个人对目前 MC 社区的微不足道的观察，一种有效地改良方式应当是这样的：首先应当积极地推动不同小群体、不同小领域之间的对话。不仅要在争论的时候进行探讨，更要在平时进行探讨。在一时的争论中，对话双方可能会因为利益、公众影响等原因有所顾忌、有所保留；而在平时，双方一般会有较少的顾虑，也更容易心平气和地进行探讨。另外，不能完全摒弃现存法律的条文，而是有所选择性的利用。现存的条文通常是基于一定的假设和原则而制定的。当我们将这些条文搬到网络环境中时，需要考虑到他们所基于的假设是否在 Minecraft 社区中存在，是否在网络社区中产生了变化。这里的逻辑类似于知乎上的一段关于马克思主义的论述[4]：</p>
<center>
<i>……历史上并非先有了一套“不拥有生产资料”，“代表先进生产力”，“领导阶级”的论断之后，才有人去研究资本主义社会的弊病，经济剥削的本质，革命力量的所在。真正的逻辑是倒过来的，有了对社会现实的大量研究，对社会革命的强烈动机，为此结合实践创建了一整套理论体系，最后才有人去抽象出几个论断，方便人理解。</i>
</center>
<p>例如，创作者可以通过 Creative Commons 等协议注明自己保留、转让、放弃的权利。而具体到如何界定抄袭和侵权，可以由作者明确划出规范，也可以商量决定。海外 Minecraft 社区关于这一点上采取的措施可能可以起到不错的示范作用。</p>
<p>以上便是我对 Minecraft 社区中用户版权的一些思考。希望能为社区的良性发展起到贡献。</p>
<p>[1] 即 MikuMikuDance https://zh.moegirl.org/MikuMikuDance [2] 为日文音系MAD／音声MAD的缩略语，是一种使用素材中的乐器对所选BGM进行演奏的视频形式 https://zh.moegirl.org/%E9%9F%B3MAD# [3] Ruth Henig, Versailles and After, 1919-33 (Routledge, 1995), p. 52. [4] 作者：白头豕 链接：https://www.zhihu.com/question/36851145/answer/108617648 来源：知乎</p>
]]></content>
      <tags>
        <tag>minecraft</tag>
      </tags>
  </entry>
  <entry>
    <title>附带 Mixin 的 Rift 开发环境配置方法</title>
    <url>/2020/01/04/rift-with-mixin-setup/</url>
    <content><![CDATA[<ul>
<li>2020/2/20 更新：懒人用开发环境 https://github.com/LucunJi/Rift-MDK-with-Mixin</li>
</ul>
<p>在 1.13.2 的 Minecraft 版本下，许多的模组并不依赖 Forge 或者 Fabric，而是 Rift。然而目前 1.13.2 现存的 MDK（Mod Develop Kit，模组开发包） 并不包含 Mixin。但是 Rift 提供的监听接口较少，很多功能都需要开发者自己利用 Mixin 来对原版代码（准确的说是字节码）进行修改。这里分享一下如何配置一个包含 Mixin 的 Rift 开发环境，帮有类似需求的人节约时间。</p>
<span id="more"></span>
<h2 id="基础环境配置">基础环境配置</h2>
<p>首先到 https://github.com/DimensionalDevelopment/Rift-MDK/tree/1.13.2 下载不包含 Rift 的 MDK 到本地。这时候文件结构看起来应该是这样的： <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D:\RIFT-MDK-1.13.2</span><br><span class="line">│  .gitattributes</span><br><span class="line">│  .gitignore</span><br><span class="line">│  build.gradle</span><br><span class="line">│  gradlew</span><br><span class="line">│  gradlew.bat</span><br><span class="line">│  README.md</span><br><span class="line">│</span><br><span class="line">├─gradle</span><br><span class="line">│  └─wrapper</span><br><span class="line">│          gradle-wrapper.jar</span><br><span class="line">│          gradle-wrapper.properties</span><br><span class="line">│</span><br><span class="line">└─src</span><br><span class="line">    └─main</span><br><span class="line">        ├─java</span><br><span class="line">        │  └─example</span><br><span class="line">        │          ExampleListener.java</span><br><span class="line">        │</span><br><span class="line">        └─resources</span><br><span class="line">                pack.mcmeta</span><br><span class="line">                riftmod.json</span><br></pre></td></tr></table></figure></p>
<p>这里使用 Intellij IDEA 为例子，选择 <code>build.gradle</code> 进行导入。导入完毕之后直接打开右侧 Gradle 面板，双击 <code>setupDecompWorkspace</code> 进行基本环境的配置。由于需要反编译并反混淆，可能会花上几分钟。等到显示 <code>BUILD SUCCESSFUL</code>，环境就搭建完毕了。</p>
<p>在这一步可能会遇到提示 <code>Cannot find hunk target</code>。这时候运行 <code>cleanCache</code> 清空缓存，然后重新运行 <code>setupDecompWorkspace</code> 就好。</p>


<figure>
    <picture>
                <source srcset="/2020/01/04/rift-with-mixin-setup/09a882ae/idea_gradlew@2x.png" type="image/png" />
            <img src="/2020/01/04/rift-with-mixin-setup/09a882ae/idea_gradlew@2x.png" alt="附带 Mixin 的 Rift 开发环境配置方法" />
    </picture>
</figure>



<p>接下来尝试启动 Minecraft。这里不能直接运行 <code>runClient</code>，应该运行 External Librarries（外部库）里的 <code>start/net.minecraftforge.gradle/GradleStart</code>，在 Program arguments 中填入 <code>--tweakClass org.dimdev.riftloader.launch.RiftLoaderClientTweaker</code>，并将 Use classpath of module 设置成 <code>Rift-MDK-1.13.2.main</code>。之后点击 Run，就可以运行 Minecraft 了。如果只运行服务端，那么可以把上面的 Program arguments 中的 Client 改成 Server。</p>


<figure>
    <picture>
                <source srcset="/2020/01/04/rift-with-mixin-setup/e2c2ac81/idea_runclient@2x.png" type="image/png" />
            <img src="/2020/01/04/rift-with-mixin-setup/e2c2ac81/idea_runclient@2x.png" alt="附带 Mixin 的 Rift 开发环境配置方法" />
    </picture>
</figure>





<figure>
    <picture>
                <source srcset="/2020/01/04/rift-with-mixin-setup/6e7a1715/idea_run_arguments@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/01/04/rift-with-mixin-setup/6e7a1715/idea_run_arguments@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/01/04/rift-with-mixin-setup/6e7a1715/idea_run_arguments@2x.png" alt="附带 Mixin 的 Rift 开发环境配置方法" />
    </picture>
</figure>



<hr />
<h2 id="配置-mixin1">配置 Mixin<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h2>
<h3 id="修改-gradle-配置文件">修改 Gradle 配置文件</h3>
<p>首先打开根目录下的 <code>build.gradle</code>，在末尾（或者按你的喜好排版）添加 Mixin 的插件、配置信息、仓库地址和依赖项： <figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;org.spongepowered.mixin&#x27;</span></span><br><span class="line"></span><br><span class="line">mixin &#123;</span><br><span class="line">	defaultObfuscationEnv notch</span><br><span class="line">	add <span class="keyword">sourceSets</span>.main, <span class="string">&#x27;mixins.example.refmap.json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">	<span class="keyword">repositories</span> &#123;</span><br><span class="line">		maven &#123; url <span class="string">&#x27;http://repo.spongepowered.org/maven&#x27;</span> &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">dependencies</span> &#123;</span><br><span class="line">		<span class="keyword">classpath</span> <span class="string">&#x27;org.spongepowered:mixingradle:0.6-SNAPSHOT&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 此时点击 Gradle 窗口左上角的循环标志（Reimport All Gradle Projects），应该会重新配置开发环境，出现 <code>CONFIGURE SUCCESSFUL</code> 说明配置成功。</p>
<h3 id="mixin-配置文件">Mixin 配置文件</h3>
<p>在 <code>src/main/java/resources</code> 文件夹下创建 <code>mixins.example.json</code>，内容如下： <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;required&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;minVersion&quot;</span>: <span class="string">&quot;0.7.11&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;compatibilityLevel&quot;</span>: <span class="string">&quot;JAVA_8&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;@env(DEFAULT)&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;package&quot;</span>: <span class="string">&quot;example.mixin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;refmap&quot;</span>: <span class="string">&quot;mixins.example.refmap.json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mixins&quot;</span>: [</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;client&quot;</span>: [</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;server&quot;</span>: [</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="初始化-mixin">初始化 Mixin</h3>
<p>Mixin 需要在 Minecraft 的类被加载前被启动。先在 <code>src/main/java/example</code> 包内创建类 <code>ModInitializationListener</code> 实现接口 <code>InitializationListener</code>。并且在实现的方法 <code>onInitialization</code> 中初始化 Mixin 并且加载配置文件 。全部代码如下： <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.dimdev.riftloader.listener.InitializationListener;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.launch.MixinBootstrap;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.mixin.Mixins;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModInitializationListener</span> <span class="keyword">implements</span> <span class="title">InitializationListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInitialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MixinBootstrap.init();</span><br><span class="line">        Mixins.addConfiguration(<span class="string">&quot;mixins.example.json&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 同时修改 <code>riftmod.json</code>，告知 Rift 加载器新增的事件监听器。修改后内容如下： <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;example&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Example&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;authors&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;listeners&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;example.ExampleListener&quot;</span>,</span><br><span class="line">        <span class="string">&quot;example.ModInitializationListener&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>至此，Mixin 就配置完毕了。</p>
<h2 id="试运行">试运行</h2>
<p>首先创建包 <code>example.mixin</code>，并新建类 <code>MixinLoadingGui</code>，输入如下代码： <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> example.mixin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.minecraft.client.Minecraft;</span><br><span class="line"><span class="keyword">import</span> net.minecraft.client.audio.SimpleSound;</span><br><span class="line"><span class="keyword">import</span> net.minecraft.client.gui.GuiScreenLoading;</span><br><span class="line"><span class="keyword">import</span> net.minecraft.init.SoundEvents;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.mixin.Mixin;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.mixin.injection.At;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.mixin.injection.Inject;</span><br><span class="line"><span class="keyword">import</span> org.spongepowered.asm.mixin.injection.callback.CallbackInfo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mixin(GuiScreenLoading.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MixinLoadingGui</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject(method = &quot;onGuiClosed&quot;, at = @At(&quot;RETURN&quot;))</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onRender</span><span class="params">(CallbackInfo ci)</span> </span>&#123;</span><br><span class="line">        Minecraft.getInstance().getSoundHandler().play(SimpleSound.music(SoundEvents.ENTITY_GENERIC_EXPLODE));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 并且在 <code>mixins.example.json</code> 的 <code>client</code> 列表中添加这个类的类名（不用包名，因为已经指定好了），添加完后是这样的： <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;required&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;minVersion&quot;</span>: <span class="string">&quot;0.7.11&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;compatibilityLevel&quot;</span>: <span class="string">&quot;JAVA_8&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;@env(DEFAULT)&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;package&quot;</span>: <span class="string">&quot;example.mixin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;refmap&quot;</span>: <span class="string">&quot;mixins.example.refmap.json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mixins&quot;</span>: [</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;client&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;MixinLoadingGui&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;server&quot;</span>: [</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 接着启动游戏。如果一切没有问题，在游戏加载完毕后会听到一声爆炸</p>
<p><font size=10>“轰！”</font></p>
<h2 id="拓展阅读">拓展阅读</h2>
<p>Mixin 官方文档：https://github.com/SpongePowered/Mixin/wiki</p>
<p>官方文档中文翻译：https://mouse0w0.github.io/2018/11/07/Introduction-to-Mixins-Overwriting-Methods/</p>
<p>国内的教程 CoreModTutor：https://xfl03.gitbook.io/coremodtutor/5/5.1</p>
<h2 id="参考资料">参考资料</h2>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Rift-ModList 作者：shedaniel https://github.com/shedaniel/Rift-ModList<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
  </entry>
  <entry>
    <title>TekTopia 教程：开始打造你的桃花源（前期）</title>
    <url>/2020/08/19/tektopia-tutorial-1/</url>
    <content><![CDATA[<p>一个刷铁塔大佬会做哪些事？</p>
<p>玩音游；烹饪；写 mod</p>
<p>答：以上全部<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>


<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/b5a60f6f/title@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/b5a60f6f/title@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/b5a60f6f/title@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>



<span id="more"></span>
<p>也许是天天和原版的村庄机制打交道从而获得了灵感，又或者是受到了村民机制更新的启发，总之，Tango Tek 在 2019 年推出了自己的村庄 mod：TekTopia。由于这个模组的名字是 Tango Tek 的昵称加乌托邦（Utopia）的复合词，他的中文译名就成了：桃花源记/特克托皮亚。</p>
<p>与其说这个模组是 1.14 的村庄改版的另一种可能性，不如说它完全改变了原版村庄的设计思路。它不像原版那样结构松散又有很高的可玩性和魔改余地，也不像千年村庄（Millénaire）模组那样做成了类似 RPG 的样子，而是采用了一种类似经营游戏的概念：你需要监测村民的粮食、健康以及心情，并且进行交易，发展村庄。</p>
<h1 id="模组搭配">模组搭配</h1>
<p>TekTopia 这个模组并没有对其它模组做出任何兼容，并且这个模组里只有有村民自产<font color=green><strong>绿色名字</strong></font>物品才能参与绿宝石交易。所以其它模组的选择要从这几个方面考虑：</p>
<ul>
<li>加快跑图速度，减少跑图时间。如各种点对点传送和快速移动装置；</li>
<li>方便搬运村民。例如大师球、套索、召唤师灵摆甚至最无脑的水桶（Get In The Bucket Mod）；</li>
<li>方便建造建筑以及让建筑变得美观，例如建筑小帮手、建筑之杖和凿子；</li>
<li>加载区块。</li>
</ul>
<p>另外以下类型的模组虽然能加速游戏进度，但是可能对游戏体验造成破坏：</p>
<ul>
<li><del>加速火把</del></li>
<li>高效产出铁、钻石甚至铁镐、钻石镐，为村民提供高效的工具；</li>
<li>高效产出原版的食物；</li>
<li>高效产出绿宝石；</li>
<li><del>直接把村民塞进各种刷怪装置然后接上电无限刷村民</del></li>
</ul>
<p>除此之外，可以安装 <a href="https://www.curseforge.com/minecraft/mc-mods/tektopia-harvestcraft-compat">Tektopia Harvestcraft Compact</a> 来提供对 HarvestCraft 的兼容。并且在 <a href="https://www.mcbbs.net/thread-980572-1-1.html">mcbbs 的介绍帖子</a>里下载到使用中文姓氏版本的翻译文件。</p>
<p>另外，类似潘马斯模组的菜园这样的不完整方块可能会干扰村民的寻路系统。</p>
<h1 id="进入村庄">进入村庄</h1>
<p>首先你需要找到或者创建一个村庄。游戏生成的村庄已经有一定的人口基数和特殊职业，但是发展势必需要拆除并重建部分建筑。重新创建一个村庄不需要重新规划，并且对环境选择的自由度比较高，但是初始人口很少。</p>
<p>一个合适的地理位置需要一大片比较平坦的地理环境，并且周围没有森林。同时，你应当收集了甜菜、小麦、萝卜、土豆四种作物，以及云杉、橡树、白化、丛林（丛林不做硬性要求）这四种树。</p>
<h2 id="自然生成的村庄">自然生成的村庄</h2>
<p>自然生成的村庄最好有一只吟游诗人。牧师类似吟游诗人，但由于作息时间和农民不同步以及技能不是群体的，只能是吟游诗人的下位替代。德鲁伊不是必须但是后期会很用得着。卫兵和无业游民（也就是绿衣服的“傻子”）完全用不着。铁匠职业前期会干扰交易选项，完全不需要，可以用道具收进背包，移出村庄或者杀掉。</p>
<h2 id="从零创建村庄">从零创建村庄</h2>
<p>首先合成一个村庄大厅的标志（以下简称为“门牌”），然后把它贴在一个封闭且有门的建筑物的门边上，然后稍作等待。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/6f5433d4/townhall-craft@2x.png" type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/6f5433d4/townhall-craft@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/e87e3e26/townhall-sign@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/e87e3e26/townhall-sign@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/e87e3e26/townhall-sign@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<p>然后大厅里就会出现两个村民，并且赠送一个奖励箱。奖励箱包含两个门牌和两个职业标志。</p>
<h1 id="前期发展">前期发展</h1>
<h2 id="村庄大厅">村庄大厅</h2>
<p>刚才提到的村庄大厅是整个村子的地理中心。村庄的范围就是以它为中心的，边长两百多格的一个正方形。当走近村庄边缘的时候会出现蓝色的无遮挡作用的屏障提示。</p>
<p>村庄大厅里有两个人，分别可以用绿宝石交易到门牌和职业标志。随着交易次数的增多，交易的价格也会上升。</p>
<p>在没有做好应对死灵法师这种比较强大的怪物时，对着大厅门牌右键将它在展示框里旋转一下，就可以防止死灵法师刷出。等到准备充分以后可以摆正门牌，死灵法师会恢复刷新。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/947f7169/townhall-sign-rotate@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/947f7169/townhall-sign-rotate@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/947f7169/townhall-sign-rotate@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h2 id="仓库">仓库</h2>
<p>仓库是一个有着箱子门牌的封闭建筑，内部放有箱子和工作台。自然生成的箱子有绿宝石、命名牌之类的奖励。你应该增添一些箱子、工作台和熔炉。村民会在工具损坏并且箱子里没有存货的时候用箱子里的木头在合成台自己合成工具。</p>
<p>物品在村民之间流动的唯一方式就是通过仓库：一个村民把产品存进去，另一个再按需拿取。因此，它应当尽量贴近村庄中心放置，缩短村民路上行走花费的时间。</p>
<p>你也可以在仓库里放入你的物资，例如工具、食物和煤炭等。虽然这些物资不是村民自产的，他们也会按需拿取。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/b2ce8dd0/storage@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/b2ce8dd0/storage@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/b2ce8dd0/storage@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h2 id="招募人员">招募人员</h2>
<p>获得村民的方法有三种，对着在村庄四个角落生成并移动到村庄中心的流浪者右键使用职业标志；从其它村庄把村民搬运过来；快乐值较高的村民会自动繁殖（比较繁琐）。前期一般只会使用前两个，并且主动搬运村民不消耗职业标志，更加经济。</p>
<p>招募人员时优先考虑智慧等级。职业等级在低于智慧的时候提升很快，超过智慧等级后提升很缓慢。前期没有图书馆时智慧没法提升。因此一个高智慧但是没有职业等级的村民会明显优于另一个高职业等级，低智慧的村民。</p>
<h2 id="住房">住房</h2>
<p>住房是村民恢复快乐值的重要场所。有三种门牌：双人间、四人间、六人间。为了减少占地面积提高效率，尽量造大房间，但是也没有必要在已有小房间门牌的情况下强行购买大房间门牌。在别的村庄要记得收集六人间的门牌这种免费的资源。房子应该建得集中来提高效率。你甚至可以建设多层房屋进一步节约用地。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/0e42645c/double-floor@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/0e42645c/double-floor@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/0e42645c/double-floor@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<p>房间内根据门牌放下对应数量的床。每张床边上附带一个椅子以提高快乐值回复效率。另外房间内平均每个村民要有12格的地面空间。</p>
<h2 id="防止房屋过于拥挤">防止房屋过于拥挤！</h2>
<p>各种住房、仓库、学校、酒馆等封闭建筑需要避免拥挤。建筑内的每个村民要保证 12 格的地面空间。工作台、熔炉、床、椅子、书架、铁砧、附魔台等特殊方块不占据地面空间。如果建筑内的人均占地面积小于十二格，村民会减少快乐值。人均面基越小，快乐值减少越快。</p>
<p>例如：一个6人间应该是 12*6=72 的大小。仓库不是专用空间，人口流动性较大，前期可以按照 4~6 个人来计算（游戏生成的仓库面积前期够用了），后期再进行扩建。学校、酒馆、图书馆等中后期建筑是聚集性场所，需要特别大的面积。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/1a1b9851/bedroom-inner@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/1a1b9851/bedroom-inner@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/1a1b9851/bedroom-inner@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h2 id="农民">农民</h2>
<p>农民推荐从其它村庄直接搬过来，但是记得要安排住房。</p>
<p><strong>农民是整个村庄里最核心、最重要的人员。</strong> 村庄的发展程度可以单凭农民的数量断定。农民生产的作物要用来养活整个村子的人并且参与交易。前期以拥有 10 只农民为佳，当然农民永远也不嫌多。</p>
<h2 id="农田">农田</h2>
<p>农田需要一个有水的，足够亮的（自然光或人工光源均可）区域。之后村民会自动开垦，但是比玩家手动开垦慢得多。应该用非泥土材料把农田圈出来，防止村民一直扩展农田。除非农田上已经有作物播种，村民不会自动去种植作物。村民种下作物的种类是根据周围种植的作物进行判断的，只要不同种作物的耕地隔开，一块田的作物种类就永远不会变。</p>
<p><strong>农田应当大而集中</strong> 较好的方案是大量建设中央一格水的 9x9 农田。每种作物至少占据一块 9x9 的农田，最好占据两块。自然生成的小块农田都可以通过填上水源并移除作物的方法予以拆除。农民会优先选择更大、离中心更近的农田进行耕种。农民白天主要待在农田劳作，因此农田不用离中心太近。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/2037a11e/farmland@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/2037a11e/farmland@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/2037a11e/farmland@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h2 id="伐木工">伐木工</h2>
<p>伐木工用斧子砍伐村庄范围内的树木。他会在砍倒树木后收集木头、树苗并补种（如果有同类树苗的话）。由于模组算法限制，他们不会砍伐 2*2 的大型树木以及金合欢树。最下面一格木头不接触泥土的话，伐木工不会砍伐。</p>
<p>由于伐木工每砍下一棵树木都要返回仓库存放，树场应该尽量靠经仓库设计。每种树都要大量种植。树苗间隔一格基本可以同时保证种植密度和树苗产出。记得清理村庄附近的树，防止伐木工就为了砍一棵树走半天路。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/073dde5c/lumberjack@2x.png"media="(min-width: 40em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/073dde5c/lumberjack@1x.png"media="(max-width: 39.99em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/073dde5c/lumberjack@1x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h2 id="吟游诗人">吟游诗人</h2>
<p>吟游诗人可以在村庄各处演奏，并且恢复自己的与周围村民的快乐值。村民的快乐值过低会减少工作效率，所以前期拥有一只吟游诗人会有极大的帮助。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/3b5c73b7/bard@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/3b5c73b7/bard@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/3b5c73b7/bard@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<p><strong>吟游诗人并不需要酒馆！</strong> 前期并不需要去建造酒馆，酒馆严格意义上并不是吟游诗人的工作场所。</p>
<h2 id="商人交易">商人交易</h2>
<p>在早上，商人会和流浪者一样从村庄的四个角落刷出。如果商人无法刷出或刷出后无法找到前往村庄中心的路，游戏会在聊天栏作出提示。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/d35c1c11/merchant@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/d35c1c11/merchant@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/d35c1c11/merchant@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<p>如果商人和流浪者一直不刷出或者刷出后不走动，地形也足够平坦，那可能是区块加载的问题，建议提高视距甚至放区块加载器。</p>
<p>商人会根据村庄内村民的类型随机提供一些能换取绿宝石交易。在前期自然就是四种作物和四种木头的交易。他会记住最近的 30 次交易。同一种物品过多地卖给商人会导致收购价下跌，甚至交易消失。这时需要出售其它物品来刷新最近的交易记录。这是这个模组发展的另一个要点：<strong>在保证大批量生产的同时增加产物多样性</strong>。</p>
<p>同一种商品一次可以交易五六次，因此较好的策略是将同一物品攒够多次交易的量后一口气卖出，防止价格下跌。</p>
<p>另一种技巧则是前往其它村落进行交易。由于商人的交易是根据村庄而定的，所以前往其它村落进行倾销也是个不错的选择。</p>
<h1 id="前期的发展">前期的发展</h1>
<p>根据上文建设好建筑物并招募了一定量的村民以后，可以开始发展了。要记得保持农民的数量，同时慢慢攒出好几组村民自产的物资进行交易。</p>
<p>可以选择离地面至少128格的高空挂机，这样可以防止刷怪又不用大范围插火把。</p>
<p>在有了绿宝石后，如果没有吟游诗人优先补充一只，然后逐步增加农民和伐木工的量。</p>
<p>在这期间，农民和伐木工以外的其它职业都不要考虑。</p>
<p>等到有 10 个伐木工和 20 个农民的时候，就从前期基本过渡的了中期。 

<figure>
    <picture>
                <source srcset="/2020/08/19/tektopia-tutorial-1/ca3b61c6/halfway@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/19/tektopia-tutorial-1/ca3b61c6/halfway@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/19/tektopia-tutorial-1/ca3b61c6/halfway@2x.png" alt="TekTopia 教程：开始打造你的桃花源（前期）" />
    </picture>
</figure>


</p>
<h1 id="主要参考">主要参考</h1>
<p>本文主要参考了<a href="https://sites.google.com/view/tektopia">官方维基</a>和 <a href="https://www.mcmod.cn/post/1373.html">mcmod 上的教程</a>，不再在文章仔细列出引用。</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>玩音游：<a href="https://space.bilibili.com/10209699">红云</a>；烹饪：<a href="https://space.bilibili.com/56877433">小墨</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
      <tags>
        <tag>minecraft</tag>
        <tag>mod</tag>
        <tag>TekTopia</tag>
      </tags>
  </entry>
  <entry>
    <title>TekTopia 教程：当上土皇帝（中期 + 后期）</title>
    <url>/2020/08/22/tektopia-tutorial-2/</url>
    <content><![CDATA[<p>在获得了20只农民和10只伐木工的时候，没有什么能阻挡你的发展了。</p>


<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/b5a60f6f/title@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/b5a60f6f/title@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/b5a60f6f/title@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>



<span id="more"></span>
<p>在完成了<a href="https://lucunji.github.io/2020/08/19/tektopia-tutorial-1/">上一篇教程</a>之后，你已经有了庞大的食物和木材供应。这时候只要不作大死（比如让一只5级红袍亡灵法师大开杀戒）是怎么也玩不崩的。因此，这一阶段的自由玩耍空间比较大。</p>
<h1 id="这游戏好难">这游戏好难……</h1>
<p>时不时听到别人说这个模组的难度设定不合理，玩起来十分难受。这里有必要说明几点.</p>
<p>首先，这个模组把发展村庄变成了经营类游戏，但是第一人称的玩家又不具有一般经营类游戏的上帝视角。在对村民进行微操的时候，玩家没法把鼠标移过去一点完事，而是必须找到村民并跑到面前操作。建筑物必须由玩家手动搭建，物资必须一个箱子一个箱子地慢慢检察，交易的时候也要自己携带物资……</p>
<p>如果有玩家想加快这些环节的速度，完全可以加入更多的模组，例如用建筑小帮手辅助建筑，以及用应用能源之类的模组把仓库里的所有箱子并入网络统一管理。</p>
<p>其次，由于这个模组的作者 Tango Tek 之前经常制作刷铁塔这种丧心病狂的装置，在制作模组的时候自然要想方设法地防止玩家用自己变态的生产力让村庄一步登天。只有村民自产的绿色名字物品才能参与交易。<strong>如果玩家强行塞入一大堆白色名字的物品，村民用这些物品制作出来的东西也会是白色的。</strong></p>
<p>所以这个模组游玩的一个原则是不直接干预村民的生产。玩家可以给村民补充大量的工具（桶除外），但尽量不要塞入农作物和矿物，否则就会看到满箱的白名物品，用不完也卖不掉。</p>
<p>最后，如果对村庄的物品产出效率不满意，但又无力增员时，可以简单地采用挂机方法：在离地至少128格处建立一个平台进行挂机，这样可以避免夜晚怪物在村庄里刷出。</p>
<p>对了，请开启 <code>/gamerule doWeatherCycle</code> 或者使用其它防雷措施 <strong>防止建筑（特别是门牌展示框）因为雷击而损坏</strong>。</p>
<h1 id="挖掘与饲养">挖掘与饲养</h1>
<p>在拥有了相当数量的农民和伐木工之后，摆在面前的是两个发展方向：矿工-德鲁伊-铁匠 构成的矿业，和 牧场主-屠夫-厨师 构成的畜牧业。矿业需要大量村民参与，做出的工具既可以提升其它村民的工作效率，也可以卖给商人；畜牧业需要的人手较少，产物可以制作食物和书本，自用或进行交易，但是大量的动物每天都要消耗食物。</p>
<p>由于发展的自由度较高，我这里并不偏重任意一条路线，而是介绍一些比较重要的地方。接下来的文章基本上不会再提到农业和林业，这两个职业在原有的基础上按需增员，无非就是面多了加水，水多了加面。</p>
<h1 id="先造了再说">先造了再说！</h1>
<p>在中期总是有那么一些万金油的职业和建筑的，而厨房和图书馆就是其中最重要的两个。</p>
<h2 id="厨房">厨房</h2>
<p>厨房和厨师可以在刚进入中期的时候就引入，目的在于增加可以批量交易的选项——交易只有批量化才会有足够的效率。由于土豆可以批量放入熔炉烧制，烤土豆成为了一个不错的大宗交易。4~6只厨师可以保证供应100人的村庄所需的食物，并且还剩下一大批烤土豆。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/8eefa449/chief@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/8eefa449/chief@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/8eefa449/chief@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<h2 id="图书馆">图书馆</h2>
<p>图书馆则旨在提升村民的智慧等级。村民的技能等级的升级受到智慧影响，因此提升智慧可以让村民更快地熟悉手头上的工作。图书馆在高峰期可能会有全村总人数的四分之一左右，因此需要较大的面积。一般一个图书馆的空间要足够容纳全村三分之一的人口。因为同时看书的村民数量取决于书架的数量，图书馆内部需要放置书架——书架堆叠放置也能起到作用。你可以连着书架把附魔台搬到图书馆里。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/a519e20c/library@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/a519e20c/library@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/a519e20c/library@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<h2 id="学校">学校</h2>
<p>说到图书馆，就不能不提到学校。在大部分人口通过图书馆获得较高的智慧值之后，从别的村庄拉人或者招募流浪汉获取到的人口基础智慧值就低得多了。这个时候将村民从小培育就是一个不错的增员选择。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/b3e10d86/school@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/b3e10d86/school@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/b3e10d86/school@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>在建造出图书馆之后，可以先招募一名教师，但不急着建造学校。老师会在不教书的时候成天泡在图书馆里阅读提升智慧。等到决定培育儿童时再建起学校，这样教师就能乘势利用极高的智慧值快速提高教书技能等级。</p>
<p>另外，向教师提供一本书可以更快地进行教育（书不消耗）。</p>
<h3 id="村民繁殖">村民繁殖</h3>
<p>村民在快乐值较高时睡觉会有几率掉落一个爱心形状的物品（伴随有音效和爱心粒子效果），概率随快乐值而提高。将爱心对着任意一张床使用，就可以消耗爱心召唤出一个小村民。通过在房间内设置虚空箱子之类吸引物品的其它模组的装置可以方便地收集爱心。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/5a0c3611/heart@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/5a0c3611/heart@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/5a0c3611/heart@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<h2 id="牧师">牧师</h2>
<p>牧师可以给予其它村民祝福，将自己的牧师职业等级累加到对方的职业等级上，提高对方的职业等级。受到祝福的村民也会缓慢恢复快乐值。祝福每分钟施加一次，每次持续5分钟。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/bbc2ce43/cleric@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/bbc2ce43/cleric@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/bbc2ce43/cleric@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>牧师也可以为自己和其他村民回复生命（同时也能回复对方与自己的快乐值）。它会优先给卫兵回复。</p>
<p>如果没有卫兵的话，牧师并非必须的职业。而且小规模的战斗中（清除一两只僵尸），有良好护甲的卫兵完全可以依靠食物自行恢复生命。</p>
<h2 id="商铺">商铺</h2>
<p>有点余钱的话可以建造一个商铺。商铺仅仅起到一个限制商人活动范围的效果，免得你在需要交易的时候满大街找他。商铺并不要求建筑物，你可以在地上竖根柱子，然后摆上门牌。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/5ffbdffd/stall@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/5ffbdffd/stall@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/5ffbdffd/stall@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<h1 id="矿业发展">矿业发展</h1>
<p>通过在底下挖出一个高二宽一的洞，并在洞外侧墙壁上放上门牌，就能建立一个矿井。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/279209b8/mineshaft@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/279209b8/mineshaft@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/279209b8/mineshaft@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>矿工会向前开拓矿井，而德鲁伊会填补矿井并刷新矿物。一旦矿井超出村庄范围，矿井会失效（门牌失去附魔光泽），并且德鲁伊不会对失效的矿井进行填补。因此根据矿工的数量招募一批德鲁伊也是十分必要的。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/a5eb2665/druid@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/a5eb2665/druid@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/a5eb2665/druid@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>矿工、矿井和德鲁伊的合适的数量比例是：矿工是德鲁伊的两倍量，并且矿井是矿工的三分之四倍——德鲁伊只会填补没有矿工的矿井，略多的矿井可以轮换利用，防止过度开采。</p>
<p>12只矿工可以为整个村庄供应制作工具所需的铁，并且还能有剩余量给你中饱私囊。这时招募两三个铁匠，全村的工具就可以得到较好的提升了。在发展畜牧业之前，铁匠的“制作：剪刀”和“制作：桶”都可以先取消。</p>
<h1 id="畜牧业">畜牧业</h1>
<p>由于厨师制作面包的速度缓慢，仓库里经常能看到大批的小麦。除了换取绿宝石以外这些小麦还可以用来推动畜牧业的发展。</p>
<p>即使没有建造屠宰场，畜牧业也是可以提供交易用的羊毛和鸡蛋的。另外，鸡蛋、牛奶可以用于制作蛋糕（甘蔗种下后农民也会自动收获）。</p>
<p>事实上屠宰场的作用并不大——皮革护甲过于廉价，只会浪费商人每次随机到的交易。附魔师也可以不依赖屠宰场，只用甘蔗造纸并且不给装备附魔——附魔的装备无法参与交易。</p>
<h2 id="动物机制">动物机制</h2>
<p>用栅栏围出一块地，并且在栅栏门边上贴上门牌，就可以做成牛圈/羊圈/鸡圈/猪圈了。除了鸡的体型是 1 以外，别的牲畜的体型都是 3 。每块用栅栏围出的区域所能承载的生物量即是区域的面积除以生物体型。农场主职业的村民每天都会喂养繁殖动物并搜集产物。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/6d72e5e1/cow-pen@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/6d72e5e1/cow-pen@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/6d72e5e1/cow-pen@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>在动物数量大于区域承载数量后，农场主依然会喂养动物，但是动物不会繁殖。在动物数量大于区域承载数量的 75% 并且村庄有屠宰场时，农场主会将动物牵引至屠宰场等待宰杀。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/5da1b86a/butcher@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/5da1b86a/butcher@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/5da1b86a/butcher@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>村庄动物是指 <strong>由村民喂食绿色食物而繁殖出来的动物</strong> ，玩家亲自喂食或者使用非绿色食物是得不到村庄动物的。<strong>在玩家进入栅栏内时，村庄动物会发光</strong> 以帮助玩家分辨。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/31dbf6a9/animal-glow@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/31dbf6a9/animal-glow@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/31dbf6a9/animal-glow@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p><strong>只有村庄动物身上才能产出绿色物品。</strong> 因此在动物繁殖出足够数量后应该将非村庄动物杀死，防止仓库混入白色原材料。基于同样的原因，在清除非村庄生物之前最好不要让村民收集物资，并且不让村民从野外找回动物（“寻找迷路的动物”选项）。</p>
<h1 id="啤酒馆与武装斗争">啤酒馆与武装斗争</h1>
<p>最后是两个看起来没有太大作用的建筑：酒馆和兵营。</p>
<p>酒馆可以配合吟游诗人，为村民回复快乐值。然而只要住房有着充足的面积和休息的椅子，即使只提供单一简陋的食物，村民也能维持一定的快乐值避免疲劳。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/6c095839/bar@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/6c095839/bar@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/6c095839/bar@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<p>建造兵营当然比不过将村庄附近128格内全部插满火把——如果不插火把的话，一小群卫兵是难以防住来势汹汹的僵尸的，更别提死灵法师了。 当然，如果你想让兵营发挥出它的功能，或者想欣赏一出卫兵与死灵法师之间的好戏，20~30只卫兵才能较好地在较大的压力（例如一只5级死灵法师）下守卫好一个村子。给士兵配备护甲和武器、一定数量的随行牧师，还有将他们升级到卫兵队长（卫兵队长只能由卫兵升级而来，不可以直接从其他村民转职），在村庄外围设置岗哨（岗哨类似商铺，无须建筑物）都可以提升他们的战斗力。 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/e5434dc5/guardian@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/e5434dc5/guardian@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/e5434dc5/guardian@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
<h1 id="最后">最后</h1>
<p>最后，希望大家能从这个模组里获得快乐。在此放上我的生存存档截图： 

<figure>
    <picture>
                <source srcset="/2020/08/22/tektopia-tutorial-2/84a67008/overview@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2020/08/22/tektopia-tutorial-2/84a67008/overview@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2020/08/22/tektopia-tutorial-2/84a67008/overview@2x.png" alt="TekTopia 教程：当上土皇帝（中期 + 后期）" />
    </picture>
</figure>


</p>
]]></content>
      <tags>
        <tag>minecraft</tag>
        <tag>mod</tag>
        <tag>TekTopia</tag>
      </tags>
  </entry>
  <entry>
    <title>线性颜色转移</title>
    <url>/2021/03/04/brief-on-linear-color-transfer/</url>
    <content><![CDATA[<p>前阵子做了一个关于线性颜色转移（Linear Color Transfer）的期末研究，准备闲下来把相关的东西发到在博客上面，分享的同时顺便帮自己巩固一下知识点。相关的代码可以在<a href="https://github.com/LucunJi/Linear-Color-Transfer-Methods">这里</a>看到。当时写的 paper 为了充字数写得比较繁琐，也有一些不严谨的问题，因此就不放上来了。这篇博文相当于根据当初 paper 的思路重新梳理一遍。如有錯漏之处烦请斧正。</p>
<span id="more"></span>
<h2 id="简介">简介</h2>
<style>
    td {
        text-align: center;
    }
    .post-body>figure>picture>* {
        max-width: 70%;
    }
</style>
<p>首先说明一下线性颜色转移，即 Linear Color Transfer 是什么。</p>
<p>所谓“颜色转移”，就是将一幅图片里的色调、明暗、对比、调色板（palette）等颜色特征，通过一种映射转移到第二幅图片上，从而使第二幅图片拥有与第一幅图片相似的颜色特征。颜色转换的应用场合有色彩修正，黑白图片的染色，调色盘预览等。</p>
<p>上文所说的第一幅图片，即拥有想要的颜色特征的图片，被称作<strong>目标图片</strong>（target image）。有着想要的内容的图片，被称作<strong>源图片</strong>（original image/source image）。最终的输出成功是<strong>转换后图片</strong>（transferred image）。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg" alt="转换后图片（Reinhard）" />
    </picture>
        <figcaption>转换后图片（Reinhard）</figcaption>
</figure>



</td>
</tr>
</table>
<p>如果这种颜色转移是<strong>线性</strong>的，那么说明这种颜色转换等价于一个在色彩空间中的线性映射 <span class="math inline">\(\mathbf{u} \rightarrow \mathbf{Tu}\)</span>。</p>
<h2 id="求解思路1">求解思路<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h2>
<p>如果将颜色特征当作一个多元随机分布，每个像素都是一个三维向量，例如<span class="math inline">\([r, g, b]\)</span>。 设向量 <span class="math inline">\(\mathbf{u}\in\mathbb{R}^3\)</span> 为源图片的随机变量，向量 <span class="math inline">\(\mathbf{v}\in\mathbb{R}^3\)</span> 为转换后的随机变量， 那么可以将颜色转移问题看作一个变量变换： <span class="math display">\[
t(\mathbf{u}) = \mathbf{v}
\]</span> 并列出关于随机分布函数的等式：</p>
<p><span class="math display">\[
\begin{gather}
&amp;P(\mathbf{U} \le \mathbf{u}) = P(t(\mathbf{U}) \le t(\mathbf{u})) = P(\mathbf{V} \le t(\mathbf{u})) = P(\mathbf{V} \le \mathbf{v})\\
\nonumber\Downarrow\\
&amp;F_u(\mathbf{u}) = F_v(t(\mathbf{u})) = F_v(\mathbf{v})
\end{gather}
\]</span> 然后微分，得出密度函数的关系：</p>
<p><span class="math display">\[
\begin{equation}
f_u(\mathbf{u}) = f_v(t(\mathbf{u}))|\det J_t(\mathbf{u})|
\end{equation}
\]</span> 进一步将问题简化到线性变换 <span class="math inline">\(t(\mathbf{u}) = \mathbf{Tu+t_0}\)</span>，雅可比矩阵会与 <span class="math inline">\(3\times3\)</span> 的转换矩阵 <span class="math inline">\(\mathbf{T}\)</span> 相等，其行列式的值会变为常数。<span class="math inline">\(\mathbf{t_0}\in\mathbb{R^3}\)</span> 是一个表示色彩平移量的向量。</p>
<p><span class="math display">\[
\begin{gather}
&amp;|\det J_t(\mathbf{u})| = |\det \mathbf{T}| = c\\
\nonumber\Downarrow\\
&amp;f_u(\mathbf{u}) \varpropto f_v(t(\mathbf{u}))
\label{eq:proportional_1}
\end{gather}
\]</span></p>
<p>为了能近似地求出转换矩阵 <span class="math inline">\(\mathbf{T}\)</span>，假设变量 <span class="math inline">\(\mathbf{U},\mathbf{V}\)</span> 都遵循多元高斯分布。由此可得以下两个新的正比例关系。<span class="math inline">\(\mathbf{\Sigma}\)</span> 为下标对应的变量的协方差矩阵，<span class="math inline">\(\mu\)</span> 为对应的平均值。<span class="math inline">\(exp()\)</span> 是自然底数 <span class="math inline">\(e\)</span> 的幂。 <span class="math display">\[
\begin{gather}
f_u(\mathbf{u}) \varpropto \exp(-\frac{1}{2} (\mathbf{u} - \mu_u)^T \mathbf{\Sigma}^{-1}_u (\mathbf{u} - \mu_u))\label{eq:proportional_2}\\
f_v(\mathbf{v}) \varpropto \exp(-\frac{1}{2} (\mathbf{v} - \mu_v)^T \mathbf{\Sigma}^{-1}_v (\mathbf{v} - \mu_v))
\label{eq:proportional_3}
\end{gather}
\]</span></p>
<p>整理以上的式子<span class="math inline">\((\ref{eq:proportional_1}),(\ref{eq:proportional_2}), (\ref{eq:proportional_3})\)</span>，可解出线性变换函数 <span class="math inline">\(t()\)</span> 和它的转换矩阵 <span class="math inline">\(\mathbf{T}\)</span>：</p>
<p><span class="math display">\[
\begin{gather}
&amp;(\mathbf{u} - \mu_u)^T \mathbf{\Sigma}^{-1}_u (\mathbf{u} - \mu_u) = (t(\mathbf{u}) - \mu_v)^T \mathbf{\Sigma}^{-1}_v (t(\mathbf{u}) - \mu_v)\\
\nonumber\Downarrow\\
&amp;\color{green}\begin{cases}
    t(\mathbf{u}) = \mathbf{T}(\mathbf{u} - \mu_u) + \mu_v\\
    \mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v
\end{cases}
\label{eq:key_equations}
\end{gather}
\]</span></p>
<p>利用分配率不难看出，<span class="math inline">\(\mathbf{T}(\mathbf{u} - \mu_u) + \mu_v = \mathbf{T}\mathbf{u} - \mathbf{T}\mu_u + \mu_v\)</span>，因此上面推导出的关系式完全符合之前假设的方程形式 <span class="math inline">\(t(\mathbf{u}) = \mathbf{Tu+t_0}\)</span>，并且 <span class="math inline">\(\mathbf{t_0} = - \mathbf{T}\mu_u + \mu_v\)</span></p>
<p>严格意义上，<span class="math inline">\(+\mathbf{t_0}\)</span> 进行的平移变换使得 <span class="math inline">\(\mathbf{Tu} + \mathbf{t_0}\)</span> 并不是线性变换。但是如果将三维的颜色向量转换到齐次坐标系 <span class="math inline">\([x, y, z]^T \rightarrow [x, y, z, 1]^T\)</span> 那么就可以将平移变换看作线性变换了： <span class="math display">\[
\begin{gather}
\begin{bmatrix}
    1 &amp; 0 &amp; 0 &amp; t_{01}\\
    0 &amp; 1 &amp; 0 &amp; t_{02}\\
    0 &amp; 0 &amp; 1 &amp; t_{03}\\
    0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\begin{bmatrix}
    x\\ y\\ z\\ 1
\end{bmatrix} = \begin{bmatrix}
    x + t_{01}\\ y + t_{02}\\ z + t_{03}\\ 1
\end{bmatrix} \Longleftarrow \text{等价于} \Longrightarrow \begin{bmatrix}
    x\\ y\\ z
\end{bmatrix} + \begin{bmatrix}
    t_{01}\\ t_{02}\\ t_{03}
\end{bmatrix} = \begin{bmatrix}
    x + t_{01}\\ y + t_{02}\\ z + t_{03}
\end{bmatrix}
\end{gather}
\]</span></p>
<p>在实际操作中，我们不知道转换后图片的协方差和平均值。这里就要用到目标图片了。目标图片相当于提供了一个色彩分布的“范本”。通过计算目标图片的协方差和平均值，可以获取到转换后图片参数的近似值。</p>
<p>至此，我们推导出了关键的关系式 <span class="math inline">\((\ref{eq:key_equations})\)</span>，并同时涉及到了目标图片、源图片和转换后图片。接下来，本文会介绍几种方法来计算出关系式中的矩阵 <span class="math inline">\(\mathbf{T}\)</span>，即对 <span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 一式进行求解。为了方便讨论并尽量减少混淆，下文会分别用下标<span class="math inline">\(tgt, src, trans\)</span>来代表目标图片、源图片和转换后图片。</p>
<h2 id="reinhard-方法2">Reinhard 方法<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></h2>
<p>Reinhard 在他的论文中提出的颜色转移方法简易，色彩转换比较柔和，一般更适用于自然风景的图片。</p>
<p>上个式子中的协方差的矩阵给求解带来了较大的问题。但如果假设三个通道互相独立，那么协方差矩阵会变成一个对角矩阵，问题能被进一步简化成三个独立的高斯变量转换问题。</p>
<p>单变量高斯分布，或者说正态分布的标准化计算为 <span class="math inline">\(z = \frac{x-\mu}{\sigma}\)</span>。那么先用一组平均值和标准差，<span class="math inline">\(\mu, \sigma\)</span>，将源图片单一通道的色彩分布进行正态化，再用另一组 <span class="math inline">\(\mu, \sigma\)</span> 参数进行反向操作，就能进行变换。下面的等式中， <span class="math inline">\(c\)</span> 表示任意一个独立的颜色通道，即 channel 的缩写；<span class="math inline">\(n\)</span> 是被操作的像素在图片中的序号。 <span class="math display">\[
\begin{equation}
\mathbf{c}_{trans}[n] = \frac{\sigma^c_{tgt}}{\sigma^c_{src}}(\mathbf{c}_{src}[n] - \mu^c_{src}) + \mu^c_{tgt}
\end{equation}
\]</span></p>
<p>如果用之前的关系式 <span class="math inline">\((\ref{eq:key_equations})\)</span> 来书写，那么转换矩阵 <span class="math inline">\(\mathbf{T}\)</span> 就等于：</p>
<p><span class="math display">\[
\begin{equation}
\mathbf{T} = \begin{bmatrix}
    \sqrt{\frac{Var(\mathbf{c}_{tgt, 1})}{Var(\mathbf{c}_{src, 1})}} &amp;0 &amp;0\\
    0 &amp;\sqrt{\frac{Var(\mathbf{c}_{tgt, 2})}{Var(\mathbf{c}_{src, 2})}} &amp;0\\
    0 &amp;0 &amp;\sqrt{\frac{Var(\mathbf{c}_{tgt, 3})}{Var(\mathbf{c}_{src,3})}}\\
\end{bmatrix}
\end{equation}
\]</span></p>
<p>RGB 色彩空间中，红绿蓝三个通道相关性较大，上文所说的简化会导致较差的颜色转移效果。但是如果先把颜色转换到三个通道相关性较小的色彩空间中，效果会好很多。Reinhard 在他的论文中使用了他以前提出的 lαβ 色彩空间。<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>这个色彩空间是根据人眼锥细胞对自然风景反应的统计数据得出的，因此使用在自然风景图片上更容易得到较好的效果。</p>
<p>可以先从 RGB 色彩空间变换到常见的 LMS 色彩空间，再变换到 lαβ 色彩空间。由于这里取了对数，色彩空间变换本身是非线性的。具体如下：</p>
<p><span class="math display">\[
\begin{equation}
\begin{bmatrix}
    l\\
    \alpha\\
    \beta
\end{bmatrix} = \begin{bmatrix}
    \frac{1}{\sqrt{3}} &amp; 0 &amp; 0 \\
    0 &amp; \frac{1}{\sqrt{6}} &amp; 0 \\
    0 &amp; 0 &amp; \frac{1}{\sqrt{2}}
\end{bmatrix} \begin{bmatrix}
    1 &amp; 1 &amp; 1 \\
    1 &amp; 1 &amp; -2\\
    1 &amp; -1 &amp; 0
\end{bmatrix} \begin{bmatrix}
    \log L\\
    \log M\\
    \log S
\end{bmatrix}
\end{equation}
\]</span></p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6dbd611d/sundown-behind-bredelem@1x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a6d5fb52/wide-sky-over-green-fields-in-harz-region@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
</tr>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/1439d81f/indep_rgb@2x.jpg" alt="转换后图片（Reinhard，RGB 空间中）" />
    </picture>
        <figcaption>转换后图片（Reinhard，RGB 空间中）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/41ee6d18/indep_lab@2x.jpg" alt="转换后图片（Reinhard，lαβ 空间中）" />
    </picture>
        <figcaption>转换后图片（Reinhard，lαβ 空间中）</figcaption>
</figure>



</td>
</tr>
</table>
<h2 id="奇异值分解法4和其它一些矩阵分解">奇异值分解法<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>和其它一些矩阵分解</h2>
<p>Reinhard 的近似方法虽然计算简单，但是会导致色彩转换力度偏低，并且对非自然场景的照片效果较差。<span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 的精确解通常会用到矩阵分解。这里主要介绍奇异值分解法，即 SVD(Singular Value Decomposition)。其它一些类似的解法会一笔带过。</p>
<p>SVD 类似更加常见的特征值分解，但是对非方阵也能使用。对矩阵 <span class="math inline">\(\mathbf{A}\)</span> 使用 SVD 能够将其分解为三个处理起来更加简单的矩阵： <span class="math display">\[
\begin{equation}
\mathbf{A} = \mathbf{U}\mathbf{\Lambda}\mathbf{V}^T
\end{equation}
\]</span> 如果 <span class="math inline">\(\mathbf{A}\)</span> 是一个 <span class="math inline">\(m \times n\)</span> 的矩阵，那么 <span class="math inline">\(\mathbf{U}, \mathbf{\Lambda}, \mathbf{V}^T\)</span> 三者的大小分别是 <span class="math inline">\(m \times m, m \times n, n \times n\)</span>。<span class="math inline">\(\mathbf{\Lambda}\)</span> 是一个对角矩阵，对角线上的元素是矩阵 <span class="math inline">\(\mathbf{A}\)</span> 的奇异值（类似特征值）。由于协方差矩阵 <span class="math inline">\(\mathbf{\Sigma}\)</span> 是一个 <span class="math inline">\(3 \times 3\)</span> 且对称的正半定方阵，<span class="math inline">\(\mathbf{V} = \mathbf{U}\)</span>，于是有以下特殊情况：</p>
<p><span class="math display">\[
\begin{equation}
\mathbf{\Sigma} = \mathbf{U\Lambda U}^T
\label{eq:svd_special}
\end{equation}
\]</span> 对特征值分解的一个较好的理解方法是将其与二维空间中的椭圆做对比。当对一个单位圆上的点进行变换操作 <span class="math inline">\(\mathbf{v} \rightarrow \mathbf{Av} = \mathbf{U}\mathbf{\Lambda}\mathbf{V}^T\mathbf{v}\)</span> 时（<span class="math inline">\(\mathbf{A}\)</span> 当然是 <span class="math inline">\(2 \times 2\)</span>矩阵），相当于先用 <span class="math inline">\(\mathbf{V}^T\)</span> 对整个椭圆进行一次旋转，再用对角矩阵 <span class="math inline">\(\mathbf{\Lambda}\)</span> 在 <span class="math inline">\(x, y\)</span> 轴上进行缩放，最后用 <span class="math inline">\(\mathbf{U}\)</span> 再进行一次旋转。观察最终得出的椭圆，会发现它的两个半轴的长度分别为 <span class="math inline">\(\mathbf{\Lambda}\)</span> 中对角线上的两个奇异值。</p>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/69833ddd/svd-wiki@2x.png" alt="奇异值分解图示。图片来自 Wikipedia，作者 Georg-Johann。以 CC BY-SA 3.0 证书发布。图中所用的符号和文中略有不同。" />
    </picture>
        <figcaption>奇异值分解图示。图片来自 Wikipedia，作者 Georg-Johann。以 CC BY-SA 3.0 证书发布。图中所用的符号和文中略有不同。</figcaption>
</figure>



<p>以上的观察在理解 SVD 转换多元高斯分布时非常有帮助。当对一个高斯分布的协方差矩阵进行分解后，<span class="math inline">\(\mathbf{\Lambda}\)</span> 矩阵对角线上的每个特征值都是该分布的拟合椭球体的半轴长度之平方。那么 <span class="math inline">\(\mathbf{U\Lambda U}^T = \mathbf{U\Lambda U}^T\mathbf{I}\)</span> 可以看作对一个标准的多元正态分布进行一次旋转，一次缩放，再进行一次旋转。那么如果要进行变量变换，可以先将源图片的数据转换回标准的多元高斯分布，然后再将这一标准分布转换到与目标图片的分布一致。</p>
<p>下面的式子来自上海交大的论文《Color Transfer in Correlated Color Space》<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>其中介绍的就是这里描述的 SVD 分解法和对高斯分布拟合椭球体进行变换的思路。<span class="math inline">\(\mathbf{I}[n] \in \mathbb{R}^4\)</span> 表示的是图片 <span class="math inline">\(\mathbf{I}\)</span> 中的第 <span class="math inline">\(n\)</span> 个像素。变换都在齐次坐标系中进行。 <span class="math display">\[
\begin{equation}
    \mathbf{I}_{trans}[n] = (\mathbf{T}_{tgt}\mathbf{R}_{tgt}\mathbf{S}_{tgt}\mathbf{S}_{src}\mathbf{R}_{src}\mathbf{T}_{src})\mathbf{I}_{src}[n]
    \label{equ:svd_operation}
\end{equation}
\]</span> 其中， <span class="math inline">\(\mathbf{S}_{src}\mathbf{R}_{src}\mathbf{T}_{src}\)</span> 负责将原图片的色彩分布反向变换回去，<span class="math inline">\(\mathbf{T}_{tgt}\mathbf{R}_{tgt}\mathbf{S}_{tgt}\)</span> 负责将色彩分布变换到目标图片的分布。可以将 <span class="math inline">\(\mathbf{S, R, T}\)</span> 看作是缩放、旋转、平移矩阵。这些矩阵都为 <span class="math inline">\(4 \times 4\)</span> 的方阵，定义如下： <span class="math display">\[
\begin{gather}
    \mathbf{T}_{tgt} = \begin{bmatrix}
        1 &amp; 0 &amp; 0 &amp; \mu_{tgt}^r\\
        0 &amp; 1 &amp; 0 &amp; \mu_{tgt}^g\\
        0 &amp; 0 &amp; 1 &amp; \mu_{tgt}^b\\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{bmatrix}, \mathbf{T}_{src} = \begin{bmatrix}
        1 &amp; 0 &amp; 0 &amp; -\mu_{src}^r\\
        0 &amp; 1 &amp; 0 &amp; -\mu_{src}^g\\
        0 &amp; 0 &amp; 1 &amp; -\mu_{src}^b\\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{bmatrix}\\
    \mathbf{R}_{tgt} = \mathbf{U}_{tgt}, \mathbf{R}_{src} = \mathbf{U}^{-1}_{src}\\
    \mathbf{S}_{tgt} = \begin{bmatrix}
        \mathbf{\Lambda}^{1/2}_{tgt} &amp; | &amp; \mathbf{0}\\
        \hline
        \mathbf{0}       &amp; | &amp; 1
    \end{bmatrix}, \mathbf{S}_{src} = \begin{bmatrix}
        \mathbf{\Lambda}^{-1/2}_{src} &amp; | &amp; \mathbf{0}\\
        \hline
        \mathbf{0}       &amp; | &amp; 1
    \end{bmatrix}
\end{gather}
\]</span> 

<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@1x.png"media="(max-width: 39.99em)"  type="image/png" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@2x.png"media="(min-width: 40em)"  type="image/png" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f91d486b/ellipsoid_approx@2x.png" alt="经过变换，图中红色的像素点拥有了与绿色像素点类似的拟合椭球体" />
    </picture>
        <figcaption>经过变换，图中红色的像素点拥有了与绿色像素点类似的拟合椭球体</figcaption>
</figure>


 这些操作也可以用 <span class="math inline">\((\ref{eq:key_equations})\)</span> 的格式来表示： <span class="math display">\[
\begin{gather}
    t(\mathbf{u}) = \mathbf{T}(\mathbf{u} - \mu_{src}) + \mu_{tgt}\\
    \mathbf{T} = \mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}
    \label{eq:svd_t}
\end{gather}
\]</span> 代入等式 <span class="math inline">\((\ref{eq:svd_t})\)</span> 和 <span class="math inline">\((\ref{eq:svd_special})\)</span> ，可以证明上面的等式是 <span class="math inline">\(\mathbf{T}\)</span> 在 <span class="math inline">\(\mathbf{T}\mathbf{\Sigma}_u\mathbf{T}^T = \mathbf{\Sigma}_v\)</span> 中的精确解： <span class="math display">\[
\begin{gather}
    \begin{split}
      &amp;\mathbf{T}\mathbf{\Sigma}_{src}\mathbf{T}^T\\
      = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})(\mathbf{U}_{src}\mathbf{\Lambda}_{src}\mathbf{U}_{src}^T) (\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})^T\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1})(\mathbf{U}_{src}\mathbf{\Lambda}_{src}\mathbf{U}_{src}^T) ((\mathbf{U}_{src}^{-1})^T(\mathbf{\Lambda}_{src}^{-1/2})^T(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{\Lambda}_{src}(\mathbf{\Lambda}_{src}^{-1/2})^T(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;(\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}(\mathbf{\Lambda}_{tgt}^{1/2})^T\mathbf{U}_{tgt}^T)\\
    = &amp;\mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}\mathbf{U}_{tgt}^T = \mathbf{\Sigma}_{tgt}
    \end{split}
\end{gather}
\]</span></p>
<p>值得注意的是，变换 <span class="math inline">\((\ref{eq:svd_t})\)</span> 在<em>把源图片的高斯分布标准化</em> 和 <em>把标准化的高斯分布转换到目标图片的高斯分布</em> 这两步中分别只进行了一次旋转。更完整的转换应该是 <span class="math display">\[
\begin{equation}
\mathbf{T} = \mathbf{U}_{tgt}\mathbf{\Lambda}_{tgt}^{1/2}\mathbf{U}_{tgt}^T(\mathbf{U}_{src}^T)^{-1}\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}
\label{eq:svd_t_full}
\end{equation}
\]</span> 不过考虑到进行 <span class="math inline">\(\mathbf{\Lambda}_{src}^{-1/2}\mathbf{U}_{src}^{-1}\)</span> 变换后，源图片的高斯分布的拟合椭球体已经是一个正球体了，可以当作标准化已经结束。由于额外的旋转，完整的转换 <span class="math inline">\((\ref{eq:svd_t})\)</span> 和不完整的转换 <span class="math inline">\((\ref{eq:svd_t_full})\)</span> 产生的效果不同，这里不多赘述，有兴趣的可以自行尝试比对。总的来说，更精确的变换使得 SVD 能够进行差异更大的变换。从下图中不难看出，在将彩色照片转换成黑白照片的应用场景中， SVD 有着比 Reinhard 方法更强的变换能力。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/3ba3190e/trafo-galerie-in-prague@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/8e583c9b/stained-glass-window-in-st.-vitus-cathedral@1x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/e5c510b4/cathedral_indep@2x.jpg" alt="转换后图片（Reinhard）" />
    </picture>
        <figcaption>转换后图片（Reinhard）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/a5b21c67/cathedral_svd@2x.jpg" alt="转换后图片（SVD）" />
    </picture>
        <figcaption>转换后图片（SVD）</figcaption>
</figure>



</td>
</tr>
</table>
<h3 id="其它的矩阵分解法">其它的矩阵分解法</h3>
<p>除 SVD 以外，还有很多其它的矩阵分解法可以用于解决颜色转移问题。这里额外介绍两种在 F. Pitiee 的论文<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>中与他提出的新方法一并介绍的，效果较为一般的方法。</p>
<p><strong>乔累斯基分解法</strong>（Cholesky Decomposition）可以将协方差矩阵分解为两个三角矩阵。我们可以通过三角矩阵构建出变换矩阵。 <span class="math display">\[
\begin{gather}
\mathbf{\Sigma} = \mathbf{LL}^T\\
\mathbf{T} = \mathbf{L}_{tgt}\mathbf{L}_{src}^{-1}
\end{gather}
\]</span> 易证： <span class="math display">\[
\begin{gather}
\mathbf{T}\mathbf{\Sigma}_{src}\mathbf{T}^T = (\mathbf{L}_{tgt}\mathbf{L}_{src}^{-1})(\mathbf{L}_{src}\mathbf{L}_{src}^T)(\mathbf{L}_{tgt}\mathbf{L}_{src}^{-1})^T = \mathbf{L}_{tgt}\mathbf{L}_{src}^{-1}\mathbf{L}_{src}\mathbf{L}_{src}^T(\mathbf{L}_{src}^{-1})^T\mathbf{L}_{tgt}^T = \mathbf{L}_{tgt}\mathbf{L}_{tgt}^T = \mathbf{\Sigma}_{tgt}
\end{gather}
\]</span> <strong>平方根分解法</strong>是通过先将对称的协方差矩阵进行特征值分解，来算出每个协方差矩阵的平方，由此构建出变换矩阵。 <span class="math display">\[
\begin{gather}
&amp;\mathbf{\Sigma} = \mathbf{Q\Lambda Q}^{-1}\\
\nonumber\Downarrow\\
&amp;\mathbf{\Sigma}^{1/2} = \mathbf{Q\Lambda}^{1/2}\mathbf{Q}^{-1}\label{eq:sqrt}\\
&amp;\mathbf{T} = \mathbf{\Sigma}^{1/2}_{tgt}\mathbf{\Sigma}^{-1/2}_{src}
\end{gather}
\]</span> 同样易证出 <span class="math inline">\(\mathbf{T}\)</span> 的正确性，这里就略去证明过程。需要注意的是，由于协方差矩阵的对称性，<span class="math inline">\(\mathbf{Q}^{-1} = \mathbf{Q}^T\)</span>。</p>
<h2 id="蒙日-康托罗维奇解法1">蒙日-康托罗维奇解法<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></h2>
<p>之前的几种解法比较“瞎”——它们容易导致色差过大的转换结果。而且在进行特征值分解、奇异值分解时，特征值、奇异值的不同顺序，或者颜色通道的不同顺序可能会导致完全不同的结果。为了解决这些问题，F. Pitiee 在他的论文中提出，康托罗维奇为苏联经济规划提出的最优化问题解法也可以被用在色彩转移上。</p>
<p>蒙日-康托罗维奇转移问题（Monge-Kantorovitch transportation problem）被描述为在进行变换 <span class="math inline">\(t:\mathbb{R}^n \rightarrow \mathbb{R}^n\)</span> 的同时尽可能减少总共的转移花费。单次花费以一个函数 <span class="math inline">\(c()\)</span> 定义。 <span class="math display">\[
\begin{gather}
c(\mathbf{u}, t(\mathbf{u})) \text{（单次）}\\
c(t) = \sum_{\text{all } u} c(\mathbf{u}, t(\mathbf{u})) \text{（总共）}
\end{gather}
\]</span> 如果将花费函数定义为向量差的模长平方，并且对随机分布进行积分求出期望值，那么可以将这个问题的解应用在颜色转移上。 <span class="math display">\[
\begin{gather}
c(\mathbf{u}, t(\mathbf{u})) = ||\mathbf{u} - t(\mathbf{u})||^2 \text{（单次）}\\
c(t) = E[c(\mathbf{U})] = \int_{\text{all } u} ||\mathbf{u} - t(\mathbf{u})||^2 f_u(\mathbf{u}) du \text{（总共）}
\end{gather}
\]</span> 据此能解出变换矩阵。其中的求平方根操作与平方根分解法中的算法 <span class="math inline">\((\ref{eq:sqrt})\)</span> 一致。 <span class="math display">\[
\begin{equation}
\mathbf{T} = \mathbf{\Sigma}_{src}^{-1/2}(\mathbf{\Sigma}_{src}^{1/2}\mathbf{\Sigma}_{tgt}\mathbf{\Sigma}_{src}^{1/2})^{1/2}\mathbf{\Sigma}_{src}^{-1/2}
\end{equation}
\]</span></p>
<p>我没有去了解求解过程，因此就不给出具体过程和证明了。在 F. Pitiee 的论文中介绍了这个解的两个特征：</p>
<ol type="1">
<li>蒙-康解法总是给出一个唯一解，因此没有涉及奇异值分解、特征值分解时遇到的不稳定问题</li>
<li>通过计算总花费最优化，实现了转换的单调性：例如怪异最亮的区域在转换后依然是最亮的区域</li>
</ol>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/26e3cc77/scotland_plain@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/26e3cc77/scotland_plain@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/cf1397b6/svd_rgb@2x.jpg" alt="SVD，RGB 空间中" />
    </picture>
        <figcaption>SVD，RGB 空间中</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/5a726a1d/mk_rgb@2x.jpg" alt="蒙-康，RGB 空间中" />
    </picture>
        <figcaption>蒙-康，RGB 空间中</figcaption>
</figure>



</td>
</tr>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/16c452c4/scotland_house@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f1cc08cf/svd_bgr@2x.jpg" alt="SVD，BGR 空间中" />
    </picture>
        <figcaption>SVD，BGR 空间中</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.webp" type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.jpg" type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/6c8b57b4/mk_bgr@2x.jpg" alt="蒙-康，BGR 空间中" />
    </picture>
        <figcaption>蒙-康，BGR 空间中</figcaption>
</figure>



</td>
</tr>
<tr>
</table>
<p>这两个特征保证了颜色转换的稳定性。但是也带来了一个问题：在进行变化较大的转换时，蒙-康解法可能会显得更为保守。例如将白花转换成红花时，SVD 能较好地完成任务。但是蒙-康解法则会导致粉色大部分被转移到源图片右上角的红花上，图片整体更加怪异。</p>
<table>
<tr>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/d2e69174/pink-rose-flower@2x.jpg" alt="目标图片" />
    </picture>
        <figcaption>目标图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/7d1f2441/deep-white-rose-blossom@2x.jpg" alt="源图片" />
    </picture>
        <figcaption>源图片</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/f56b11b0/flower_svd@2x.jpg" alt="转换后图片（SVD）" />
    </picture>
        <figcaption>转换后图片（SVD）</figcaption>
</figure>



</td>
<td>


<figure>
    <picture>
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@1x.webp"media="(max-width: 39.99em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.webp"media="(min-width: 40em)"  type="image/webp" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@1x.jpg"media="(max-width: 39.99em)"  type="image/jpg" />
                <source srcset="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.jpg"media="(min-width: 40em)"  type="image/jpg" />
            <img src="/2021/03/04/brief-on-linear-color-transfer/9a91ac1b/flower_mk@2x.jpg" alt="转换后图片（蒙-康）" />
    </picture>
        <figcaption>转换后图片（蒙-康）</figcaption>
</figure>



</td>
</tr>
</table>
<h2 id="结语">结语</h2>
<p>以上介绍了三种比较简单的颜色转移方法的推导和理解。它们分别着重考虑了色彩空间的优化、概率分布的操作和最优化问题的求解，在实际应用上各有优劣。除此之外，还有很多非线性的转换法，例如根据图片梯度和分区优化的方法，以及使用机器学习、语义识别的颜色转移。这些方法更为复杂，功能更加强大。</p>
<p>这篇文章写好的时候，已经离当初的 paper 间隔了一个学期。撰写博文的时候常常会因为弄不懂原 paper 中自己当初亲自写下的公式，或是对自己当初的论述有所怀疑而去查阅其它论文和网络资料。本文中的第二个等式，随机变量转换，本来是只有第二行的。然而在连续两忘记推导过程后只好把第一行的推导过程老老实实写了下来。全篇写完，发现不仅帮自己复习了数学知识，还查出了原 paper 中的一些错误。“验证学习效果的最好方法是教给别人”，这句话诚不欺我。只是可惜原本准备将文章写得简明扼要，最后完整论述下来还是写出了几千字。现在想来，也许把一整篇博文分成三份撰写发布会更好一些。</p>
<p>文中用到的图片主要来自于 F. Pitiee 在<a href="https://github.com/frcs/colour-transfer">他的颜色转移代码仓库</a>里发布的测试用图片，以及 <a href="https://cc0.photo/">https://cc0.photo/</a> 提供的 CC-0 无版权图片。感谢他们的贡献。</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>E. Reinhard, M. Ashikhmin, B. Gooch, and P. Shirley. Color transfer between images. IEEE Comput. Graph. Appl., 21(5):34–41, Sept. 2001.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>D. L. Ruderman, T. W. Cronin, and C.-C. Chiao. Statistics of cone responses to natural images: implications for visual coding. J. Opt. Soc. Am. A, 15(8):2036–2045, Aug 1998.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>X. Xiao and L. Ma. Color transfer in correlated color space. In Proceedings of the 2006 ACM International Conference on Virtual Reality Continuum and Its Applications, VRCIA’06, page 305–309, New York, NY, USA, 2006. Association for Computing Machinery.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>X. Xiao and L. Ma. Color transfer in correlated color space. In Proceedings of the 2006 ACM International Conference on Virtual Reality Continuum and Its Applications, VRCIA’06, page 305–309, New York, NY, USA, 2006. Association for Computing Machinery.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>F. Pitiee and A. Kokaram. The linear monge-kantorovitch linear colour mapping for example-based colour transfer. In Visual Media poduction, 2007. CVMP 2007. 4th European Conference on, pages 1–9, Nov 2007.<a href="#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
      <tags>
        <tag>CV(computer vision)</tag>
        <tag>math</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo 魔改指南</title>
    <url>/2018/12/13/hexo-hacking-guide/</url>
    <content><![CDATA[<p>这里说几个魔改 Hexo 博客的方法，顺便水一贴。遇到问题欢迎评论区留言。 <span id="more"></span></p>
<h1 id="最新版next主题下载">最新版NexT主题下载</h1>
<p><a href="https://theme-next.org/docs/getting-started/">最新版本</a> 的 NexT 使用了一个不同于过往版本的 <a href="https://github.com/theme-next/hexo-theme-next">GitHub repo.</a>。新版本的 NexT 在许多方面有着比旧版更方便的配置。安装时注意甄别。</p>
<h1 id="字体设置">字体设置</h1>
<h2 id="字体版权">字体版权</h2>
<p><b>注意版权问题！！</b></p>
<ul>
<li>有的字体商用需要购买版权，有的字体免费商用；</li>
<li>有的字体免费商用但是<b>禁止嵌入软件、网页中</b>；</li>
<li>有的字体禁止二次发布；</li>
<li>有的字体禁止修改名称和（或）修改内容后和（或）收取费用二次发布；</li>
<li>…………</li>
</ul>
<p>以上每一条都可能单独成立。所以使用字体时记得看清楚发布源网页的信息、证书以及压缩包里附带的 readme（用户须知/使用声明） 文件。<b> 看说明书很重要！</b>（由于外文字体一般都只有英文声明，所以学好英文是很重要的） <del>一般来说大公司都会等韭菜长大了再割</del></p>
<p>P.S.：我不太清楚重命名成英文会不会侵犯“禁止修改名称”这一条，所以就直接使用比较容易出编码问题的中文文件名了。</p>
<h2 id="字体设置-1">字体设置</h2>
<p>声明和设置字体可以在 <code>&lt;主题文件夹&gt;/source/css/_custom/custom.styl</code> 这里设置 声明字体：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: /*字体系列名*/;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;../fonts/&lt;字体文件名&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">/*你可以指定多个 url ，中间用逗号隔开。前一个字体使用失败时会自动尝试使用下一个。*/</span></span><br><span class="line">    <span class="comment">/*就像这样：</span></span><br><span class="line"><span class="comment">    src: url(&#x27;file1.ttf&#x27;), url(&#x27;file2.svg&#x27;);*/</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>使用字体：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.site-title</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;&lt;字体系列名&gt;&#x27;</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字体文件就丢在 <code>&lt;主题文件夹&gt;/source/css/fonts/</code> 在这个文件夹</p>
<h2 id="字体的压缩">字体的压缩</h2>
<p>如果不禁止修改内容，那么直接把字体文件上传是很蠢的行为。如果是五十几 KB 的英文字体还好，一个中文字体能够有几 MB 的大小。这是极其浪费流量资源和加载时间的——实际用到的字形可能只是九牛一毛。 在这里极度推荐使用 <a href="http://font-spider.org/">字蛛（font-spider）</a> 来对字体进行压缩。它的原理就是遍历相关的文件，记录每个字体文件的使用情况，然后创建只保留用到的字形的新字体文件。 安装过程我就不说了，请参照官网。下面讲几个坑点：</p>
<ul>
<li>你应该对它输入 <code>&lt;博客文件夹&gt;/public/index.html</code></li>
<li>记得打开 <code>--debug</code>， 否则出 Bug 以后它是不会报出来的</li>
<li>它对于 url 指定的路径的区分很蠢
<ul>
<li>相对路径记得用 <code>./</code>（本层目录）和 <code>../</code>（上层目录）</li>
<li>base64 以及网络上的资源用 <code>--map "&lt;url 地址&gt;,&lt;本地地址&gt;"</code> 来映射到本地的字体文件</li>
<li>也可以在不需要处理的情况下把 <code>@font-face&#123;&#125;</code> 内容用 <code>/*&lt;内容&gt;*/</code> 给注释掉
<ul>
<li>或者用 <code>--ignore "文件路径"</code> 来指定需要忽略掉的文件</li>
</ul></li>
</ul></li>
</ul>
<p>反正我一个 4MB 的中英文字体文件给压成了 4KB，只保留 LucunJi 这些字符，效果很显著。</p>
<h1 id="自定义页面">自定义页面</h1>
<h2 id="标签并入归档">标签并入归档</h2>
<p>标签、分类和归档单独分几个页面会导致类似的功能分散，特别是当自己的标签不多的时候。 具体操作是把 <code>page.swig</code> 里面的东西搬进 <code>archive.swig</code>。 把这些内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-block tag&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tag-cloud&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tag-cloud-title&quot;</span>&gt;</span></span><br><span class="line">        &#123;% set visibleTags = 0 %&#125;</span><br><span class="line">        &#123;% for tag in site.tags %&#125;</span><br><span class="line">          &#123;% if tag.length %&#125;</span><br><span class="line">            &#123;% set visibleTags += 1 %&#125;</span><br><span class="line">          &#123;% endif %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        &#123;&#123; _p(&#x27;counter.tag_cloud&#x27;, visibleTags) &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tag-cloud-tags&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; tagcloud(&#123;min_font: 12, max_font: 30, amount: 300, color: true, start_color: &#x27;#ccc&#x27;, end_color: &#x27;#111&#x27;&#125;) &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>加入到这一行的后面。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% block content %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="本地化">本地化</h2>
<p>Hexo 博客可以进行本地化来方便不同语言的用户。 通过对作者代码的仿写，可以对自己新增的内容进行本地化。 语言文件都在 <code>./themes/&lt;主题&gt;/languages/</code> 这里，拿 <code>zh-CN.yml</code> 举例： 主题的 <code>_config.yml</code> 中的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">archive</span></span><br></pre></td></tr></table></figure>
<p>里面， <code>archives:</code> 对应了 <code>zh-CN.yml</code> 的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">归档</span></span><br></pre></td></tr></table></figure>
<hr />
<p>每个页面的标题，在 <code>./themes/next/layout/pages.swig</code> 被给出，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#125;&#123;% elif page.type &#x3D;&#x3D;&#x3D; &quot;tags&quot; and not page.title %&#125;&#123;#</span><br><span class="line">    #&#125;&#123;&#123; __(&#39;title.tag&#39;) + page_title_suffix &#125;&#125;&#123;#</span><br></pre></td></tr></table></figure>
<p>这里的 <code>__('title.tag')</code> 就对应了语言文件里的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">title:</span></span><br><span class="line">  <span class="attr">tag:</span> <span class="string">标签</span></span><br></pre></td></tr></table></figure>
<h1 id="自定义样式表">自定义样式表</h1>
<p>通过自定义 CSS 样式表，可以实现许多小功能来美化页面。</p>
<h2 id="增加娱乐效果">增加娱乐效果</h2>
<h3 id="鼠标悬停气泡">鼠标悬停气泡</h3>
<p><a title="气泡内容">效果</a> 代码:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">title</span>=<span class="string">&quot;气泡内容&quot;</span>&gt;</span>效果<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是的，追加href属性还能弄个超链接 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>一般人看不出来的 <font title="气泡内容">效果</font> 代码:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">title</span>=<span class="string">&quot;气泡内容&quot;</span>&gt;</span>效果<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>你可以给几乎所有标签加入 <code>title</code> 属性，甚至包括图片： <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABcCAIAAAAeQie5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAIbSURBVHhe7dHRbuMwDETR/v9Pp4v0LuAipMewSUoF5jxaE5GafL3slAsSXJDgggQXJLggwQUJLkhwQYILElyQ4IKE9QV9HfBpJ4t3opgDDraxbCH6SBDawJpVqOEU0dWm9+D1l/GzdeY24MW3cMUKQ7N5aITEG58iJMa1D+Z9CUIHHCQIDeodybMiJBKEIiSmdM3jNQlCp4gmCPWrn8QLEoQu42cJQp2KZ7B4hMQtXBEh0aZsAPsmCD3ARQlCDf7Y6lyaIFTq6aWsFiHRgAEREnUe3chSERJtGBMhUeT+dazzgeMRjPzAcYXigjgbxODfOKtQVhBfF2GJ//hawQUJLkhwQYILElyQ4IIEFyS4IMEFCS5IcEGCCxJckOCCBBckuCDBBQkuSHBBggsSXJDgggQXJLggwQUJLkgoK+gfDsYx/oCDCpUF/eB4BCM/cFzh0V2sEyHRhjEREkWeXsdSERINGBAhUafgRlZLECrCpQlCpcouZccEoQe4KEGowdw/TOIWroiQaFM/gMUThC7jZwlCnbpm8IIIiQv4QYREv8ZJPCVBKEEoQWhE+zDelCB0wEGC0KChkbwvQuKNTxES4+YG89BbuGKF6dm8+DJ+ts6aDXj9KaKrLduDGhKENrB4Ffo44GAb6xeimDc+7WTHnbbiggQXJLggwQUJLkhwQYILElyQ4IIEFyS4IMEFCS5IcEGCCxJc0KnX6xsAxkPY/z4C3AAAAABJRU5ErkJggg==" title="我觉得你应该知道怎么做了"></p>
<h3 id="刮刮乐">刮刮乐</h3>
<p>示例：<font class="hidden-black" title="刮开来试试OwO">刮刮乐</font> 因为每次都在 HTML 标签里面写 style太麻烦了，干脆写成 class 塞进 css 文件：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.hidden-black</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:black;</span><br><span class="line">    <span class="attribute">background-color</span>:black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>markdown 里面写这个</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">class</span>=<span class="string">&quot;hidden-black&quot;</span> <span class="attr">title</span>=<span class="string">&quot;刮开来试试OwO&quot;</span>&gt;</span>刮刮乐<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="内嵌视频自动缩放">内嵌视频自动缩放</h3>
<p>批梨批梨之类傻批视频网站的内嵌代码是可以直接丢进 markdown 文件里面的，然而却不能自动缩放。 解决办法来自<b> <a href="http://www.xiaoyunhua.com/2344.html">肖运华个人网站</a> </b>，非常感谢。 <code>&lt;iframe&gt;</code> 标签外边套一层 <code>&lt;div class="video"&gt;</code> 或者 <code>&lt;p class="video"&gt;</code> ，然后在之前说过的 <code>custom.styl</code> 里面加入如下样式代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.video</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">56.25%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.video</span> <span class="selector-tag">iframe</span>,</span><br><span class="line"><span class="selector-class">.video</span> <span class="selector-tag">object</span>,</span><br><span class="line"><span class="selector-class">.video</span> embed &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存，刷新，完事 记得 <code>&lt;!-- more --&gt;</code> 标签前面加上压缩过的视频封面而不是内嵌视频本体，否则还在预览部分流量就没了。 当然你在一页上丢太多视频可能会卡爆，并且吞噬大量的流量。</p>
<h3 id="美化代码高亮">美化代码高亮</h3>
<p>（添加于 2021-04-27）</p>
<p>暗色主题的代码高亮在亮色主题的博客上会显得比较突兀。 这里同样可以靠修改 <code>custom.styl</code> 来美化：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">3px</span> <span class="number">3px</span> <span class="number">15px</span> <span class="number">#000000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我这里的办法是加上阴影。只要让页面看起来更舒服，其它方法也是可行的。</p>
<h1 id="增加-qq-好友分享">增加 QQ 好友分享</h1>
<p>我分享系统用的是 needsharebutton2，配置起来很简单，官方文件应该就有，这里不再赘述。 要点在于加入“发送给QQ好友和群组”功能。如果用分享到QQ空间功能来替代这个的话会很麻烦的，更何况 TIM 用户一般很少看空间。 基本操作就是抄一下已有的代码，不过QQ好友分享必须要附带图片、标题 打开 <code>&lt;博客目录&gt;\themes\next\source\lib\needsharebutton\needsharebutton.css</code> ， 在</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.icon-qqzone</span>:before &#123; content: <span class="string">&#x27;\f1d6&#x27;</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>的下方添加</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.icon-qq</span>:before &#123; content: <span class="string">&#x27;\f1d6&#x27;</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>并且把</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.need-share-button_qqzone</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffce00</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.need-share-button_qqzone</span><span class="selector-class">.need-share-button_link-box</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffce00</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>复制一份，改成这样：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.need-share-button_qq</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00deff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.need-share-button_qq</span><span class="selector-class">.need-share-button_link-box</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#41d0ff</span>;<span class="comment">/*天蓝色背景色，方便区分*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样 css 文件就配置好了，然后打开 <code>&lt;博客目录&gt;\themes\next\source\lib\needsharebutton\needsharebutton.js</code> 找到这一块代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;qqzone&quot;</span>: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> myoptions = getOptions(el);</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&quot;http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title=&quot;</span> +</span><br><span class="line">          <span class="built_in">encodeURIComponent</span>(myoptions.title) +</span><br><span class="line">          <span class="string">&quot;&amp;url=&quot;</span> + <span class="built_in">encodeURIComponent</span>(myoptions.url) +</span><br><span class="line">          <span class="string">&quot;&amp;pics=&quot;</span> + <span class="built_in">encodeURIComponent</span>(myoptions.image) +</span><br><span class="line">          <span class="string">&quot;&amp;desc=&quot;</span> + <span class="built_in">encodeURIComponent</span>(myoptions.description);</span><br><span class="line">        root.popup(url);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>
<p>在下面加入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;qq&quot;</span>: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> myoptions = getOptions(el);</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&quot;https://connect.qq.com/widget/shareqq/index.html?url=&quot;</span> +</span><br><span class="line">        <span class="built_in">encodeURIComponent</span>(myoptions.url) +</span><br><span class="line">        <span class="string">&quot;&amp;title=&quot;</span> + <span class="built_in">encodeURIComponent</span>(myoptions.title) + </span><br><span class="line">        <span class="string">&quot;&amp;summary=&quot;</span> + <span class="built_in">encodeURIComponent</span>(myoptions.description) +</span><br><span class="line">        <span class="string">&quot;&amp;pics=&quot;</span> + <span class="string">&quot;&lt;你自己的博客头像之类的图片&gt;&quot;</span>; </span><br><span class="line">        <span class="comment">//没有图片就不能分享了，所以强制指定一个图片比较稳</span></span><br><span class="line">        root.popup(url)</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>
<p>然后找到这一行：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">networks: <span class="string">&quot;Weibo,Wechat,Douban,QQZone,Twitter,Pinterest,Facebook,GooglePlus,Reddit,Linkedin,Tumblr,Evernote&quot;</span></span><br></pre></td></tr></table></figure>
<p>改成这个（加入 QQ 选项）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">networks: <span class="string">&quot;Weibo,Wechat,Douban,QQZone,QQ,Twitter,Pinterest,Facebook,GooglePlus,Reddit,Linkedin,Tumblr,Evernote&quot;</span></span><br></pre></td></tr></table></figure>
<p>最后修改此处,注意注释的地方:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">root.getDescription = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> content;</span><br><span class="line">      <span class="comment">// check querySelector existance for old browsers</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">document</span>.querySelector) &#123;</span><br><span class="line">        content = <span class="built_in">document</span>.querySelector(<span class="string">&quot;meta[property=\&quot;og:description\&quot;]&quot;</span>) ||</span><br><span class="line">                  <span class="built_in">document</span>.querySelector(<span class="string">&quot;meta[name=\&quot;twitter:description\&quot;]&quot;</span>) ||</span><br><span class="line">                  <span class="built_in">document</span>.querySelector(<span class="string">&quot;meta[name=\&quot;description\&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (content) &#123;</span><br><span class="line">          <span class="keyword">return</span> content.getAttribute(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;<span class="comment">/*在双引号的里面添点东西,例如“我的博客”*/</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        content = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;meta&quot;</span>).namedItem(<span class="string">&quot;description&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (content) &#123;</span><br><span class="line">          <span class="keyword">return</span> content.getAttribute(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;LucunJi&#x27;s blog&quot;</span>;<span class="comment">/*同上一处注释*/</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>这样就魔改完毕了，在主题的 _config.yml 文件里添加上 qq：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">networks:</span> <span class="string">Weibo,Wechat,Douban,QQZone,QQ,Twitter,Facebook</span></span><br></pre></td></tr></table></figure>
<p>最终效果如下：<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcAAAACHCAIAAAAObR5EAAATgklEQVR4AezUtxECQRBE0Sty3LUvkMkPmRG1NUwCaA3v+d3mn/ImAAgogIACCCiAgAIIKAACCiCgAAIKIKAAAgqAgAIIKICAApwgoAACCoCAAggogIDCbreLiN57u1VtI6J+8q8goKjnPM+r1WqMkbeqbT3Uj4byRwGFiKj25SPUT0Qk/ElAofc+xshHqJ96S/iTgEJr7Y1v94PFdBMABBTgHwIKY39o7z6Ao7jyPI4/J2ADVZuXYxNcglqnzUvdJvAFhHOAPVl7QcaRsF45EZwDi+xCLvCZK3w+HXIGyqQjJ5l0FsGyAiDJSELSgNBIGo1mNDOantDq//1nntRKWJoZWnS39PvUq6lGYZpK33rd702rPSQArIIAbHEPVPUcfSMrY1ZMxtyc/PrE3g0Ai0iAgJ5+9/5ZPc3OPakgoICAAgI6uNPvzJ7Vx6oiBBSwCg8wGG9V0Wm/sBwAshTADLT55K4PcnNXr9lV2kREnspdr/Gdz/4ylh72YAYKuIQHBFRXu2FBRo9I/muGfpi1Ys07L2V0/WvBOxUBLCIBAgoIqK5p15Oz+uF0bjnZTFIkEAj4AhGVekJAAQEFBPRk7qy+XvjIQ4NBQAEBBQS0fsuj/Seg85auLWpSqZPKc9AIAtoHIKCAgFKgNFff7dkvo/m7sJEeEFCAAZIXqM5/5+UF8/74wqodJz1qoOajVQv+dZaEjfSAgAIkmbxYRl/LmoWN9ICAAqSSvJO5GakEFAABBQQ0cvK/M7GRHhBQgJSSF6jZkvxGegAEFBDQS7uR3uOh5cvpuedir/v3U3Ex9VdREfuB2loCBBQAfxOpG5dRiL5jzBiaOlUOPu784rhx/M+BxkMP8bvx6J9jQEABhuNf5eTZZVpaLH9CDNXgN8/KivUUEFCA4fx34Y8ciZVuyhR9Ksrt4xnlIIPnnj2novLX+4/Jk2nNGkoKIKAAhYWFmZmZ3L6LmYfy7/I78Pvwu9EQURSuoX7Nzj29qLfiFvO1fGYmv1WvCSlPe5MCCCigoTxz5KvvWani3+V3GMJ6ejw8eezOHP/TQDz3/NGPuie2eXk0TCCgAOB0dgeOJ6FDJDu7e1UqPV022uYQUADQ5558T3NIVVTwzVD9rqi8S2BbCCgALF9+ieqp3x7NzOy+nOez2xICCgCcM7nIk5ZGlxLfFf3KVzozevvtuJxHQO0HQN9Lb8K+99ra7lsHEybgch4BtRUATtiYMfrCkTmys/XLeZttFEVAtRELIBiUK+9cLq2hQTNRQQHPQGVGtdWrNbCGgQLK3+adyaqqRuMiIwqAz6dNny6bpebkRMwWrarSfvCDzv/Pe+9FzAPROG4jF1LPqOhTT/62oihtbW1ut9s1wgAoXevgfOCyhtaiIvV73yMhtNGjPTt3uswDXEVuIxeSOykbKvp8Ko6/19zcXF1dXVpaWjiSADgWL5b19EydWmglp9avV8eOJSHa//ZvC80DXEVuIxeSOyk/fyz6TD+5r/wTZVdfbdPxTvWP7DvEwr+06aAiYd8xrYR43LXPGR49hoSomvSj6ccU/oqlxksvr5Fxf2b5Jv2LYn2Lfcev7n7DpoMLyZ2Uk9DLRQ9ExF9tb28XIwxA1p/njAqHIqPHPLt8E78Ki/koLf3sxMl8MHX3OmEq4EJyJ4mIjy8XvXFT+UapGEkAvtbS+IuCXXyw4Q9ZjeMnCEvaP/2f+fXX+zdz6IV5gAvJnZTHfWegYuQBuDvvFTn93JDxJ2FVH0+7nV/5//nDk0eF2UCfgY50ANN2r+XX3bdmtn5jnLCq6kk/Coz9Ch9cX3hAgBUgoAA/KjzAl/D6NbKVlfxsKr/+av//CrBIQD29eb1en88nRgwA2SO+9SnzZGWf/N10fv3r0yVf9nuFSYALyZ30xPXaxhSJRHizKG93GjnbmLCNCduYyq6bQkJsmfUQbwyy+Lh7R62+mQnbmMwaXEjuJNdSbmMawQAisQmdEKL6b68XlsfTZB7x26AHhckA90ABTgi5K6jiuinCDsrj/89vN9QJkwECCvCpYLy6zWvcwg7OxGfK36/7TJgMEFCA3YId/1WasIlzEyfHAlprbkABAQVoEKJOsEJe3bYJnizrn54SpgEEFOBkz/2V9tD69XHyYFQkJMwFCCggoPrSti3oDzoZZ+Y6EiCgAHX6urZt6K039ZEigIACnNbXtSU7TUK/5m4U5gAEFMDNQ1/Xlux0G/RL5n6aExBQwPSTnZ0wWdiQyR+HBwQUcANUjBJnU5mBAiCggD1M1wmbiowaI8wECCggoNcKm/JY4NnPgMfZDTgcDxxwr63x7XD49/FrVWt2/rlL9Tg7PM7uXC4pTuqgTh0KKflUf4Mxb75NkIiPV4Xxz52roHe91BClsEZSWKVKLy2rNOb9neMnkBCvvJiHx9mZ/jg7kwNaec/sM9YM6LnsKqVe1ai/cORwWeNNCOhQBnQieZ30eYIrqeyiT/F8V0APGh3QGqpU6cI0Ouo04BQkBALaNda/ustx8mxr7SDDVXjo0+ezhlVA85QQdfLVB95eUGmZgG5sOezXaEA+t3e+9QK6rpxSUJVrtYC2lNPA/I9d7ClujddzQuzY2LlnUZQGotG+GpsFdOJB350HWy0Z0B1bz6qUOE/961nDJ6BzWg4d9W/Z1nbsTDRETD22rNIKAXVu8mqUgLC37QHMQA0PKPecNBqMkxwXcYqjgsbGA3qPwQFd5adBhYOUYURA+aH0xrRslz/j489JZ1GoPEKdouqGorYbT4byG5Q7rRHQmbtclCT38X12DOg/1eVsCJyqV32u4Htzur8+Y4Hrw23unNmVMxZ4aziiIeXtfzI7oPMd+gxCq69pvGljy7EwdYnsOOy4qTDoI0mrKHMgoEYHtM1JifDNS/0U2V3X7xsNDWgFVWqUiO1G/FWPR3L3GzPBrFVJVXP7N/TjULlKfakd2z9rn3fMEgF9vSxMA4i0F+468LCccmZVNVDc+QqbBbTyibygi7qp5S36d1eXa/LUlRscM+JX9PV768wNaM9cdtRU9Q6oGlq7p0dAWbD9eQTU0IBmUIQSEtme+lmmxes5iY8NDWgzJaiyOfWz/PumChlQLqkhAZ3XpMky5lf6J/b7en+KL3TjeusHtL3gjZ4/XFFrx4A6VpdEVeqlvcR19UzHig+8u/a2bdngeuKfzsQy6gu8cnVLBRGd8Zga0MOBFkqE5gtGavzRlmBox7HGBzZaKqBbCzyp3/00O6BlOdRBiSlPcSlpr6BR8YA+bnBAF3kpQX5/6mfhiacM6F37nMZcwldGu+OoRDd85r9hV+zruW10AcGwrKfVA9pc87C8zP+fqvgSU3vYdgF1vFeuUj+hkKr26mnTfXsjRMrbVzce85keUDm7HIjW0hw47I76en8xHA7vO9F4k3UCWv7JID/2WHWbFQPaVESJ82akcoonBYl4Q/caHNBDEUqURutSPQuvHcmA8rExl/C7/Lk+jXpTopqi0QV4gsIOAdVDufUs6ewU0MqcoyoNSk5I5zR9mOeccbWnhsh3tNHKM1C1whFsUYdsaR4BJb+HEhdYksopro0HdBofGxzQOkrCoTMpnuXNh7NJCN4KalRAMxo6lIjM5eA8TQGbBfS8HQM6Y1nAp0fHFzq2zbX0T3Uz5Ldmn1vxgf+US6M4V4nr6ZmdzX0xr+VFsxeRmg4H6fO0ONtrVBqYz9lyEwKa4jizklRKQjAn6VNs7Fo+yjY4oKvaKExJOHo2xRPx368nEftb9kYFVBSGnZSoosoWiwc0fN6x51DVns0H5M9kb66K/bO41U6X8Of3uzrjWbnNOUNumF/m3rLN+94yzmjX4tK2UIgk9dQHDqtspH+gKkIXpCrH3Jq+mvTORserzg6Kq3c4b+qeunaUFiOgKYyyxyhKSVLIOTG5szwYr+dYQUeNDOgiN4UpSWFalNK5qib9iITYeWumUQHlcWOtqlACtOjKXVYPqL+s4AI/vN1loxnoAr+LmFazwSH3e37qIl3I1fZKV0O7VuGZ8rb8omX3gYabgxW9ruX9FWGSwv7gvuZouPsnW7GIlOyYSEGFUhB6P7kT/Swe0Fv52LiAniU3paLMmfS5bjns0XfRGxhQ8VF7blPUqdLAPM3tYr0tAzrzkM9GAd0QIubyPx2v5NtdlVTrgxU+YjUbKnv8pBTdv8BCH+V0rnV39Ls2D9ZQYrw+zECTHGW5lCIn1SWzf16uvz9vZEBX+SlFwaTP9dLLa/Q9TMYFlIfvfT8NQo3myOkn7oFekoDK9fT42rpjW/2Mqx276jWVWPdmz6cPRkkKBV+31mfh9/jrUw6o22OFfaBL84N6RvsXti1/q5X2gToLKGUtCZ/l1a4boNuMDOihMKUoSq8lea78tHT9BqiRAeWxK/B+m0afS8s/0XppPsqJgP5TS0Usocp7sRWhuu31Ggf0nme8NSHZytCHs+VHOT38la6N9JxUKwX0AUeU1GhplWt+ftPKz3w7+FFMJ1p2+Glw8uNJ5gdUXsjLUPYLa0zzOgsFVH74PVCUZICU+G3QhM+SEa/neD42MqBFUSKNyhRKgkp+fg3To0lev4dHjyEheCHe6IDKhvpzmjsU6k8rr/Vd2s/CYxXexamsb1s6k0PpPuXrXpHfsiR2/f77JW2Orno69sqFJisFdH5BU3q/L8rPIA0s7PXNt8onkeSzRYIFj/W9ctdnppYJaFUOeZ6iohtISbhDaj6VLSElmc8jTdJvgBp6Ce+mTedo2nnyU6Lq3LTMQ2UtyZ1o5RPL9S30hgX0gH/JmdD75yJFvo4L72SKqO8Xew04EQKaZEMXxLqpklpz1PvmknPz5px7dHbl7+fU8x6mT+tVtXNBSdmyxPzH2SUT1qpIeIB6BgOvbrTURzk/qdInoV3/JE/1Uut+lPNMLnVQAjxUn+T6+8Gu6/fnDQ5od0l9lIhw6KLW34/9Kk3/ikETz7bHaiLlIa3flnl1e7X/xwP/rvkPE0kuoO5PbfQwEbl76VBJqNGnhUintfsip456VszR02mfgPJIP+arCWt0AeG1sp7mBFTOLlPTvM4aAZ1InvKEAsp47nmGfyXFG6DGB7SGyiIU1mhwGlW2Jv1ApnnvHNEfwqR/cSieXJdx3J/Ew+tMf5zdeXWwgJr3ODs8kX6AjObHn1QfH2uLGx8r5Kp2lJ7Aw0QuaqwkjZKg5Cbx5jP1G6BDEtBlPkpKUX1y788bP0kI9zfGTT+mDB5QPFD5+HH5A28e73qgcn7Bw4nUEwE1bTjStzkQ0IubgboKSFVIpykUKaLzGXR+JflrqEPp8fUCqp2Y9Cc4pxsdUH1U0qFQrxlouIPqfPSag95tpbqek1ON6rz0QJLvz+kkIfhjSHyMgJowEFATBwJq/pBPUP5jCgE1f9y/rlhevy/8z50IqKUCerkY9gDcQvhFzARhR7/av5lfA2O/UvKzqcJKYAQEFOC06DRR2NHPC3bz6/FfpUVGjxGAgAJcUi2C2XQGOq6h7ocnjvJBwdTbhDkAAQUYK+xo+pa3+JXnnv837XYBCCjApea2dUDf5tePpqebcf0OCChARMSMErbDF+98Cc8He279d2EaQEABviFsJz3vFX5t/cY4U9ffAQEFCNtv+vnr+AamNfcsFGYCBBTALewl689z5PRz68yHhDkAAQX4C2E7N+xa+9enS/hgxVOrzF4+AgQUoEHYxZf93rk5j/BB+XVTkti9BAgoAJaP5i575GstjXL6KSwBEFDAFnq3PS7e0+Kb599+6LnqST8SZgIEFGC8ba7ieeIp1444nWvuWSRMBggowNe7dtHX2mDlnW+A8qrRkpfXWGntCBBQwCTUKayMd33y4IO3H3zu7MTJAuwV0Msuu0yYAQABHRUO3fcfi/mA07nhD1kCrE3W8vK+Qb388quuukoADMuANgjLuuv9Fd+v/YwPch/OxsW7lXEhuZMXnoFeeeWVX/rSlwTAsNxL32DdT23++3+9IJ+ajI2fFseF5E52Xq9TDx0dHYqiNDc3V1dXl5aWFgIMF7XPPUdC8Ci0nhNbtoTHjych1LFj+bgQrIqryG3kQnInuZZEJKgHTdNUVeXvtbW1ud1uF8Bw4dm5UwbUu3mzy0pai4rU731P/t98b77pAgvjKnIbuZDcSa5l34DKhnJZ+dvRuAjA8ODz0ZgxJETHM89ELEPNzaWvfEXWk48jYGHROG4jF1LWkwm6EA1g2KG0NBKCJk/WrKChQf5/eHDZtdWrNZsA6kEQwAiRl9cZrIoKMld2tj7xpClT5P/HjkAQwAihKJ3Zysois+zcyVNgfeIZK6k9AAIKwOmU5dq0iS4xp5Nuv52E6BxpabaaeAICCsAVk5NQmdH09EtUsf37u887bpwJ+QYEFMCYlnHC9Jkgd624mIaU3IIqBx8rCtkYIKAAHE1uGU9CZUP52OkckgmvvtTO1T5yhAABBRgmdu7sbKgc6elGzkb5Ol2/bOeMejwECCjAsFJRwd3sm9HaWroY/OuZmVhqHwkEAYDHw5nrdW+U54xr1iR3v1JR+FfkNTv2eCKgACMMF3D58l4Z5fnj1Km0aFHsJun+/Tw6J6f8ysdycHl5vsmtFKLnL/JvYb0IAR2RABmV291TGFzSvDykEwEFGPG3R3l2mZ7Ok9CBiskzVjlLXbUKF+wjzf8DInm6HfOFnpAAAAAASUVORK5CYII=" alt="image" /></p>
<h1 id="leancloud">LeanCloud</h1>
<h2 id="安全漏洞">安全漏洞</h2>
<p>如果你用 LeanCloud 统计阅读数，记得看看<a href="https://blog.csdn.net/weixin_39345384/article/details/80787998">这里</a>。 另外，最后的 <code>deploy</code> 应该写成这样:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="comment">#你的 repository</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">leancloud_counter_security_sync</span></span><br></pre></td></tr></table></figure>
<p>不在 <code>type</code> 前面加短划线会报错。</p>
<h2 id="绕开实名验证">绕开实名验证</h2>
<p>（添加于 2021-04-27）</p>
<p>LeanCloud 国内服务目前已经全部要求实名验证。没有实名验证的功能会受到限制。我的博客已经没法在无验证的情况下使用字数统计了。</p>
<p>目前的解决方案是：</p>
<ol type="1">
<li>实名验证</li>
<li>如果不想实名验证，可以在左上角选择国际服务（International）。</li>
</ol>
<p>需要注意：国际服务和国内服务的账号<strong>不通用</strong>，需要重新配置并迁移数据。如果想要删除、修改国内帐号，查看并修改，也需要实名验证。</p>
]]></content>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>【译】为什么人们热爱战争</title>
    <url>/2020/09/21/why-men-love-war-translation/</url>
    <content><![CDATA[<p><font color=gray size =2>原文：<em>Why Men Love War</em><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></font> <font color=gray size=2>翻译：<a href="https://www.deepl.com/translator">DeepL</a>翻译 + 禄存天玑后期润色</font> <font color=gray size=2>译者注：仅对原文进行翻译搬运，旨在拓宽大众视野，不代表译者立场。<br>能找到的原文有不少错误，且译者能力有限，不通顺之处还望多多包涵和提建议。若想要了解作者的精确含义，烦请查阅原文。</font></p>
<p>我上一次见到希尔斯是在越南的稻田里。他那时十九岁，是我的技艺高超又桀骜不驯的电报员。我们几个月形影不离。接着有一天他回家了，又过了十五年，我们才在去年冬天在华盛顿的越战老兵纪念馆意外相遇。几个月后，我去佛蒙特州拜访了希尔斯和他的妻子苏珊，他们在那里经营着一家民宿。第一天早上，我们天不亮就起床，试图拯救五只刚出生的兔子。希尔斯在棚子里用兔毛和稻草搭了个窝，并放了盏灯来抵御严寒。</p>
<span id="more"></span>
<p>“人们无法理解的是，”希尔斯说，他轻轻地抱起每一只小兔子，把它们放在窝里，“越南是多么有趣。我喜欢它。我喜欢它，但我不能告诉任何人。”</p>
<p>希尔斯热爱战争。当在暴风雪中从佛蒙特州开车回来，孩子们在车后座上睡着的时候，我不得不承认这些年来我也很喜欢战争，而且比我想象的还要喜欢。我也讨厌战争。问我，问任何一个参加过战争的男人，问他的经历，我们可能会说我们不想谈论它——暗示我们非常讨厌它，它是如此可怕，我们宁愿让它被埋葬。而人们为什么讨厌战争，这并不神秘。战争是丑陋的、可怕的、邪恶的，人们憎恨这一切是合理的。但我相信，大多数参加过战争的男人，如果他们诚实的话，就不得不承认，在自己内心的某个地方，他们也喜欢战争，喜欢战争，就像之前或之后发生在他们身上的任何事情一样。而你该如何向你的妻子，你的孩子，你的父母，或者你的朋友解释？</p>
<p>这就是为什么六七十岁的男人们坐在他们的书房和美国各地的娱乐室里，知道他们的生活中没有任何东西能与他们跳伞进入圣洛<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>，或在冲绳冲锋陷阵的日子相当。这就是为什么老兵们的团聚总是充满了酒后的尴尬，被迫的友谊在悲伤和眼泪中结束：你们又在一起了，这些人是你的兄弟，但这不一样，永远不能一样。这就是为什么当我们从越南回来的时候，我们四处游荡，无精打采，对任何事情、任何人都不感兴趣。有些东西已经永远地离开了我们的生活，我们回来后的行为是无法解释的，除非把这当作一个失去了爱人——也许是至爱——的男人的行为。无法告诉任何人。</p>
<p>部分原因在于我们无法描述我们的感受，因为语言让我们失望：平民的形容词和名词、动词和副词，似乎是为另一个世界而生的。没有将战争与日常生活联系起来的隐喻。但我怀疑，我们也是出于羞耻而哑口无言。我们的成长中没有任何东西承认热爱战争的可能性。它充其量是一种必要的罪恶，是一种爱国的责任，可以被解除，然后被抛诸脑后。热爱战争就是嘲弄我们为之奋斗的价值观。这是麻木不仁的，反动的，野蛮的。</p>
<p>但对人类和国家来说，压制人们热爱战争的原因，可能比承认它们更危险。在《现代启示录》中，罗伯特·杜瓦尔（Robert Duvall）饰演的旅长，打量着特别恐怖的战斗场面，非常悲壮地说：“你知道，总有一天这场战争会结束。”他显然是要做一个精神病患者，用扑克牌装饰敌人的尸体，在瓦格纳的乐曲中骑马上战场。我们嘲笑他——嘿！没有人是那样的人！但去年，在格林纳达<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>，美国男孩们播放着瓦格纳冲向战场，新一代的人在模仿越战的电影，就像我们模仿二战的电影一样，什么也没学到，什么也没记住。</p>
<p>阿尔弗雷德·卡辛（Alfred Kazin）写道：”战争是二十世纪人类永恒的状况。“他只说对了一部分。战争是人类永恒的状况，句号。从特洛伊的海伦到詹金斯的耳朵，人们为了一切去打仗。在第一次世界大战中，两百万法国人和英国人死在泥泞的战壕里，就因为一个学生射杀了一个大公。事实上，原因并不重要。每场战争都有理由，每种理由都能引发战争。</p>
<p>几个世纪以来，人们都希望随着历史会带来进步，进步会带来和平。但是，进步只是给了人类让战争变得更加可怕的手段。在蛮荒时代，任何战争都无法与本世纪战争的残酷性相提并论。在欧洲美丽有序的文明景观中，每个人都有文化，每个村庄的咖啡馆里都会播放古典音乐。战争并不都是畸形的，它是家庭的一部分，是我们试图——徒劳地——将其锁在地下室的疯叔叔。</p>
<p>想想我自己的例子。我不是一个暴力的人。从小学开始我就没有打过架。除了是一个相当快乐的食肉动物外，我并不嗜血，也不喜欢杀动物，鱼，甚至昆虫。我的日子是在适度的满足中度过的，充满了工作和日常生活的细节。我现在也是一个父亲，一个帮助创造生命的男性是战争的天敌。我看到了战争对孩子们的影响，让他们成为杀手或受害者，剥夺了他们的父母、家园和纯真——偷走了他们的童年，在他们的身体、思想和精神上留下了烙印。</p>
<p>我在越南度过了大部分的战斗之旅，在丛林和稻田中艰难跋涉，没有发生任何意外，但我已经看到了足够的战争，知道我再也不想打仗了，我会尽我所能让我的儿子远离战斗。那么，为什么在最奇怪的时候——当我在开会或办事的时候，或者在美丽的夏日傍晚，当光线渐渐暗淡，孩子们在我身边玩耍的时候——我的思绪会回到十五年前，回到一场我不相信也不想打的战争？我为什么会怀念它？</p>
<p>我怀念它，因为我爱它，以奇怪而麻烦的方式爱它。当我说到热爱战争的时候，我并不是指曾经让几代人迷恋上沃尔特·斯科特（Walter Scott）的那种浪漫的战争观念。他那所剩无几的浪漫在凡尔登和帕斯尚代尔被碾成了泥土：荣誉和荣耀在机枪下无法生存。而让伊朗少年拿着棍棒对抗伊拉克坦克的，也不是殉道者的那种盲目的幸福感。我指的也不是那种可以控制整个国家的歇斯底里，就像福克兰群岛战争期间，英国媒体煽动了潜藏在英国冷酷外表下的欲望一样。那是代偿性的战争，是没有风险的参与快感，是观众对鲜血的渴望。那种欲望很容易被煽动，甚至入侵格林纳达这样的小岛也能做到。就像所有的欲望一样，只要它持续下去，它就会支配其他一切；一个国家的其他问题就会被消蚀掉，这种现象自文明开始以来就被国王、独裁者和总统所利用。</p>
<p>我不是指战争是一种瘾，那种战争狂们的持续的瘾头：把耳朵邮寄回家给他们的女朋友的疯子，除非在 F-4 上启动后燃器否则无法勃起的空军。最后，我不是在说我这个年龄的一些男人如今的感受，那种没有上过战场的，但现在却有一种对错失的怀旧的渴望，一种经典的男性体验，就像一些没有孩子的女人担心他们错过了一些关于做女人的基本东西，一些曾经能获得却不曾重视的东西。</p>
<p>我说的是，即使知道并讨厌战争，为什么有思想、有爱心的男人可以热爱战争。和任何爱情一样，对战争的热爱也是建立在一个复杂的、常常是矛盾的原因之上的。其中有些是相当不痛不痒的讨论，有些则是几乎太深，令人心神不宁。我先说说比较值得尊敬的理由。</p>
<p>对战争的热爱，部分源于它是一种非常强烈的体验；它的诱惑是人类基本的激情，即见证、观看事物的激情，《圣经》称之为眼欲，越南的海军陆战队员称之为视奸。战争使时间停止，将经历强化成一种可怕的狂喜。他是《希腊古瓮颂》中“永远温暖，静静享受 / 永远气喘吁吁，永远年轻。”所捕捉到的那一瞬间激情的黑暗反面。战争提供了无穷无尽的奇异体验，足够让“我真他妈的不敢相信！的感觉持续一生。足够让人终生难忘。</p>
<p>大多数人害怕自由，战争消除了这种恐惧。就像一个干爹，它用它的秩序和纪律提供了安全感，也提供了一种不可抗拒的反抗冲动，一种不断飞越杜鹃窝的渴望。午夜征用就是一个光荣的例子。我记得一次精心策划和缜密执行的突袭， 目标是我们的主要敌人——美军，而非北越人——以获得轻质毛毯和步枪的清洁液。这在我后来的任务中又执行了一次，作为我地位改变的标志，来为我们的办公室获得一台冰箱和一台空调。为了躲避越南警察，我们把床单绑在一起，从妓院的顶楼跳下去。有一次，一个如今在我们的外交使团中受人尊敬的朋友，把自己藏在一张卷起来的东方地毯里，而我们其他人坐卡车离开<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>，让他赤身裸体地回到六英里外的基地。战争，因为它偷走了我们的青春，鼓励我们去玩男孩子的游戏。</p>
<p>战争用一个阴森而安心的清晰取代了日常生活中困难的灰色区域。在战争中，你通常知道谁是你的敌人，谁是你的朋友，并得到了对付这两者的手段。（顺便说一句，这也是越南的一大问题：很难区分朋友和敌人——它太像日常生活了）</p>
<p>战争是从日常生活进入一个特殊世界的一种逃避。在这个世界里，支撑我们在日常生活中的责任纽带——家庭、社区、工作的纽带——都消失了。在战争中，所有的赌注都被取消了。它是最后一个定居点之外的边疆，它是拉斯维加斯。和平时期做得好的人，在战争中不一定做得好，而那些不合群、失败的人，可能会发现自己被烈火触动了。圣路易斯街头卖柴的 U.S.格兰特，在四年后指挥联邦军队，就是最好的例子。我认识很多海军陆战队员，他们虽然是伟大的战士，但适应平民生活的能力却微乎其微。</p>
<p>我记得科比，一个瘦小的孩子，肩膀上纹着 JUST YOU AND ME LORD。柯比曾两次延长在越南的服役时间。他早已结束了对任何已知组织的依恋，独自一人住在最危险的地区。他日夜游荡，只穿着磨破的裤子，腰带里塞着一把点45自动手枪，瘦弱的肩膀和手臂像蒙塔尼亚人一样黝黑。</p>
<p>有一天我们外出巡逻时，发现他躺在一间小屋的地板上，由一个穿着黑色睡衣的女孩照顾。他的手臂上有一道枪伤。</p>
<p>他向我要了支烟，然后盯着我，决定是否值得把他的故事讲给我听。“光天化日之下，我在这里偷了一个芒果，天哪，那里有三个越南人民军军官，穿着漂亮的褐色制服。他们把地图摊在桌子上仔细地看，当作在自己的家一样。他们看着我。我也看着他们。然后，他们举起了他们的9毫米，我也举起了我的点45。”</p>
<p>“是吗？”我回答，“那么发生了什么事？”</p>
<p>“我干掉了他们，”他说，然后抽了口烟。在吃芒果的路上杀了三个人，这只是又一天的工作。</p>
<p>“你准备怎么离开战争？”我问他。（他没离开。几个月后，一个十岁的越共女孩用一个遥控引爆的诱杀装置炸死了他。）</p>
<p>战争是一场残酷的、致命的游戏，但却是最好的一场游戏。而人们喜欢游戏。你可以从战争中回来，身心俱损，或者根本就不回来。但如果你完整地回来，你就会带着关于大多数人永远没有触及的那片灵魂的知识。我所学的东西都没有越南的小部队战术那么复杂，那么有创造性。我所从事的任何运动都没有让我对自己的身体和情感极限有如此深刻的认识。</p>
<p>我到越南不久后的一个晚上，我的一个排的观察哨听到了敌人的动静。我立刻失去了我嘴里所有的唾液。我不能说话，我的嘴唇发不出任何声音。我的大脑就像被拔掉了插头一样被一片空白了——我只觉得全身发出沉闷的嗡嗡声，一股低压的电流就像电线上的电一样在我身上流动。一分钟后，我至少可以叫一声，我照做了，希尔斯向班长们下达了命令，叫来了炮兵和空中支援，并把探头扔了回去。我被吓坏了。我感到羞愧，我希望它能再来一次。</p>
<p>当其他一切都消失的时候，战争中持久的情感是同志情谊。一个战友是一个你可以信任的人，因为你把你的生命托付给他。“这，”菲利普·卡普托（Philip Caputo）在《战争传闻》（<em>A Rumor of War</em>）中写道，“不同于婚姻，是一种无法被一句话、无聊或离婚、或除死亡以外的任何事情所打破的纽带。“尽管战争有着极右翼的形象，但战争是我们大多数人唯一的乌托邦式体验。个人的财产和优势算不了什么：群体是你与朋友共有的一切。这不是一个特别有选择性的过程，而是一种不需要理由的爱，超越种族、个性和教育——所有这些在和平时会产生差异的东西。它，简单地说，就是兄弟情。</p>
<p>这种爱之所以如此强烈，是因为它没有限制，甚至没有死亡。约翰·惠勒（John P. Wheeler III）在《触目惊心》（<em>Touched with Fire</em>）中引用了国会对赫克托·圣地亚哥·科隆（Héctor Santiago-Colón）的荣誉勋章的嘉奖：“由于周围敌人的火力和手榴弹的爆炸，一个北越士兵在没有被发现的情况下，爬到他们的阵地上。突然，这名敌军士兵向 Sp4c，圣地亚哥·科隆的散兵坑里，投掷了一枚手榴弹。意识到没时间将手榴弹扔出他的 Sp4c 阵地，圣地亚哥·科隆捡回手榴弹，将手榴弹塞在肚子上，转身离开战友，并吸收了爆炸的全部冲击力。”这是典型的英雄主义，战友之间的相互依赖的终极证明。当圣地亚哥·科隆本可以轻松地跳到安全地带的那一瞬间，他的内心是怎么想的？一定是：我的战友比我最宝贵的财产——我自己的生命——更重要。</p>
<p>孤立是战争中最大的恐惧。军事历史学家 S.L.A.马歇尔（S.L.A. Marshall）深入研究了二战和朝鲜战争期间的战斗事件，发现最多的时候，只有25%的人在火力下真正进行射击。其余的人蜷缩在掩体后面，惊恐和无助——完全宕机。无一例外，这些人都曾感到孤独，而在战斗中感到孤独，就等于停下动作：这是孤寂之死的可怕前奏。只有那些觉得自己和其他男人联系在一起，是某种东西的一部分的人才能保住脑袋。仿佛同志情谊是某种集体的生命力，是面对死亡并保持清醒的力量。但当这些人从战争中回家时，那种对孤独的恐惧伴随着他们中的许多人，是落在肥沃土壤上的一粒小小的芥子。</p>
<p>当我从越南回来时，我试着跟我的伙伴们保持联系。我们写信，计划见面，但总有些事情发生，我们似乎从来没有聚在一起。几年来，除了交换了圣诞卡，我们什么都没做。那个支撑着我们紧张的同志关系的特殊世界已经消失了。每天的生活——我们的工作、家庭、朋友——将我们收了回来，我们长大了。</p>
<p>但有一些东西不是这样。比如说，在越南，我和希尔斯的关系比之前或之后遇到的任何人都要密切。我们通过无线电联系在一起，我们的生活依靠着它，也依靠着对方。我们一起吃饭、睡觉、欢笑，我们一起害怕。当我刚到越南时，我想让希尔斯向我敬礼，但他根本不愿意，最多在我们经过时说一句“你好，中尉，过得怎么样。”每当他不敬礼一次，我就告诉他，他就得装一百个沙袋。<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>到有了几千个沙袋的时候，希尔斯把我拉到一边说：“听着，中尉，我很乐意向你敬礼，真的。但如果我在后方养成了习惯，当我们在丛林中时，我可能会向你敬礼。就告诉了那些等着我们敬礼的越南猴子谁是中尉。<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>你就会是第一个被炸死的人。”我们就忘记了沙袋和敬礼。几个月后，当希尔斯离开排里回家时，他转过身来，向站在我们的山顶阵地上的我敬了一个我见过的最有力的礼。我向他打了个响指，那是我十五年来最后一次见到他。当我们在越战纪念馆意外相遇时，这个响指就像一个信号，时间已经过去了足够长的时间——我们已经长大到可以和曾经的自己说再见，也可以和曾经的自己成为朋友。</p>
<p>对我们和成千上万的老兵来说，纪念碑是一个特殊的地方。战争就是剧场，而越南的战争没有第三幕。那是没有演出的一幕；角色们在那里迷失了，无从下手，也没有了台词可说。所以当我们来到华盛顿的越战纪念馆时，我们凝视着墙上的名字，伸手摸了摸他们，泪如泉涌，说了声再见，写下了自己的结局。我们现在年纪大了，有的人当了爷爷，有的人很成功，但纪念碑依然触动了我们的某些部分，它们孤独地残存在炮火下。当我们来到那个等待的地方，见到了伙伴们的回忆，并给他们应有的回应，把他们从埋葬的地方拉出来，把我们的爱安葬，我们终于回家了。</p>
<p>基于所有这些原因，男人都喜欢战争。但这些都是简单的原因，我们可以谈论的第一层原因，而不会有被反对的风险，不会陷入太深的真相或自我。但男人爱战争还有其他更麻烦的原因。对战争的热爱源于我们内心深处性与破坏、美与恐怖、爱与死亡之间的结合。战争可能是大多数男人触摸我们灵魂中神话领域的唯一方式。对男人来说，在某种可怕的层面上，它最接近于分娩对女人的意义：进入生与死的力量。这就像掀开宇宙的一角，看看下面是什么。看到战争，就是看到了事物的黑暗核心，那是生与死之间的无人区，甚至是更深远的地方。</p>
<p>而这也解释了一个关于人类讲述的战争故事的核心事实。每一个好的战争故事，至少在它的一些关键要素中，都是虚假的。越是好的战争故事，越不可能是真的。罗伯特·格雷夫斯（Robert Graves）写道，他从第一次世界大战中获得的主要馈赠是“难以说出真相”。我从来没有听过一个格子军给记者讲过一个不是谎言的战争故事，就像我讲的一些关于战争的故事都是谎言一样。在某种程度上，并不是说谎言不真实。它们有一种寓意，甚至是一种神话般的真实，而不是一种文字上的真实。它们伸出手来，提醒说者和听者他们在这个世界上的位置。它们是烟斗过后，在冒烟的帐篷里围着火堆讲述的原始故事。它们在底层都是一样的。</p>
<p>越战中一些最好的战争故事在迈克尔·海尔（Michael Heir）的《派遣》（<em>Dispatches</em>）中被引用最多的一个故事是这样的：“但他给我讲的故事是多么的尖锐和有共鸣，就像我听过的任何战争故事一样。我花了一年时间才明白：‘巡逻队上山去了。一个人回来了。他还没来得及说清楚发生了什么就死了。’</p>
<p>“我等待着剩下的故事，但它似乎不是那种故事。当我问他发生了什么事时，他只是一副为我感到惋惜的样子，如果他愿意浪费时间给像我这么笨的人讲故事，那就完蛋了。"</p>
<p>这是一个伟大的故事，一个战斗的俳句，所有的负面空间和黑暗都嗡嗡作响，预示着什么。它看起来很有韵味，是越南特有的。但听着，现在，听这个：</p>
<p>“我们都去了葛底斯堡，六三年的夏天，我们中的一些人从那里回来：除了细节之外，这就是全部。”这是一位联邦军人<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>对葛底斯堡的描述，他曾是美国联邦军队的上尉。语言是不同的，但它是同一个故事。而且我想，只要有人去打仗，这个故事就一直在讲。它的目的不是为了启迪，而是为了排除；它的信息是暴动的，它的内容是把听众放在他的位置上。我受苦，我在那里。你不在。只有这些事实才是重要的。其他的一切都无法言说。就像在越南最惨烈的悲剧发生后所说的那样：“不意味着什么”就是说“它意味着一切。”语言过载了。</p>
<p>战争故事居住在神话的领域，因为每个战争故事都是关于死亡的。而人类热爱战争的最令人不安的原因之一是对破坏的热爱，对杀戮的快感。在他那本关于二战的极好的书《战士》（<em>The Warriors</em>）中，J. 格伦·格雷（J. Glenn Gray）写道：“成千上万的年轻人从来没有怀疑过自己身上存在着这样的冲动，他们在军事生活中学会了破坏的疯狂的兴奋。”这就是海明威的意思，他写道：“承认你喜欢杀人，因为所有的士兵都喜欢杀人，不管他们是否撒谎。”</p>
<p>我和我的排在越南焚烧猴窝（注意语言是如何为美国开脱的——我们没有烧房子，也没有开枪打人：我们烧的是“猴窝”，打的是“猴子”）<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>，杀狗杀猪杀鸡，破坏，因为正如我的朋友希尔斯所说：“我们当时觉得很好玩。”发射过火箭筒或 M-60 机枪的人都知道，手指上的那种力量，扳机的柔软、诱人的触感，是有道理的。它就像一把魔剑，一把格斗家的亚瑟王之剑：你所要做的就是移动那根手指，让人难以察觉，就像一个想法像影子一样在脑海中闪过，甚至连一个完整的大脑突触都没有，我就会在一阵声音、能量和火光中噗通一声，点燃一辆卡车或一座房子，甚至人都消失了。所有的东西都飞了起来，归于尘土。</p>
<p>这种快感和我们小时候玩的游戏是有联系的，那些无休止的牛仔、印第安人和战争的游戏，那些游戏以“砰砰你死了”结束，每一个“死了”的人都站起来，开始另一个游戏。这就是作为幻想的战争，这也是战争电影和书籍中触动我们的情感，在那里，死亡是没有后果的事情，而不会随着我们致命脆弱的身体里的血流到泥土上，以可怕的结局结束。男孩子们并不是唯一容易产生这种幻想的人，它也攥住了那些从未参加过战争的老人。他们主持我们的葬礼时，也会流下和电影中士兵死亡时一样的眼泪——幻想的眼泪，廉价的眼泪。战争中对毁灭和杀戮的热爱，源于那种把战争当做游戏的幻想，但它因为在可怕的风险中被放纵而更具诱惑力。这是幸存者们玩的游戏，在他们近距离地看到死亡后，心里明白了死亡是多么的普通，多么的平凡，多么的无法逃避。</p>
<p>我不知道我在越南有没有杀过人，但我已经尽力了。我在夜里对着枪口闪光开火，在伏击时扔手榴弹，在我认为有敌人的地方下令炮击和轰炸。每当另一个排的伤亡人数较多时，我都很失望：这就像在足球比赛中穿上了衣服，但却没有机会上场比赛。在一次伏击之后，我的部下带回了一个北越士兵的尸体。后来，我发现这个死者靠在一些 C-配给箱上；他戴着墨镜，腿上放着一本《花花公子》杂志，嘴里欢快地叼着一根烟，头上还顶着一坨形状完美的大粪。</p>
<p>我假装很愤怒，因为亵渎尸体被视为非美国式的、反动的行为而受到谴责。但我感觉到的不是愤怒。我一直保持着军官的面孔但内心却在…大笑。我笑了——我现在相信了——部分原因是潜意识里对这种性、排泄物和“死亡”的淫秽联系的欣赏；部分原因是欣喜地意识到，他——不管他是谁——已经死了，而我——与众不同的我——活着。他是我的兄弟，但我不认识他。生与死之间的界线很细，当你周围有很多人都不在的时候，你还活着，这就是快乐，真正的快乐。而不幸的是，从在死亡面前活着的快乐，到造成死亡的快乐，并不是那么大的一步。</p>
<p>我认识的一个中校，一个真正的知识分子，被安排负责民政事务，我们帮助越南人种植水稻的工作，以及其他改善他们生活的工作。他是一个敏感的人，他写日记，似乎更适合赢得人心，而不是作战指挥。但他确实能作战指挥。我记得在他的火力基地被北越军的工兵部队袭击后的那个晚上，我飞出去探望他。我的大部分作战部队都已经出动了，所以这位上校召集了一批杂牌文员和炊事员，把那些工兵赶走了，他们追过瓦片稻田，借着信号弹的光亮，杀死了几十名这些精锐的敌军。那天早上，当他们在打量他们所做的一切，并把死去的北越军——所有的北越军都赤身裸体，浑身沾满了油脂和泥土，以便他们能够穿透铁丝网——像许多垃圾一样装在机械骡子上时，那位上校的脸上露出了一种欣慰的表情，除了在灵修教堂里，我还没有见过这种表情。这是一个如痴如醉的人的表情。</p>
<p>而我——我做了什么，面对这禽兽般的场景？我也笑了。和他一样充满了幸福感。那是我又一次站在人性的边缘，看着坑里的东西，并喜欢我在那看到的东西。我已经向一种审美投降了，这种审美脱离了让我们感受到他人的痛苦的同理心的重要品质。而我在那里看到了一种可怕的美。战争不是简单的丑陋的精神，虽然它肯定是魔鬼的工作。但作为给魔鬼的回报，它也是一种伟大而诱人的美。</p>
<p>艺术和战争在历史上就像艺术和宗教一样紧密相连。中世纪和文艺复兴时期的艺术家们给了我们大教堂，但他们也给了我们战争、剑、火枪以及大炮的盔甲雕塑，这些艺术献给战神，就像雕刻的祭坛献给爱神一样虔诚。战争是一种最高级的公共仪式，巴黎荣军院中装饰精美的大炮和大都会艺术博物馆中描绘着众神的战车都雄辩地证明了这一点。人们爱他们的武器，不仅仅是为了帮助他们生存，而是有更深层的原因。他们爱他们的步枪和刀子，就像中世纪的武士爱他们的盔甲和剑一样：它们是美的工具。</p>
<p>战争是美丽的。夜晚的交火，M-60机枪的机械优雅，都有某种意义。它们是它们应该是的一切，是它们外形的完美范例。当你在夜里开火的时候，红色如游蛇遁入漆黑，就像你用淡淡的笔在画画一样。然后小光点开始回旋，AK-47的绿色曳光弹开始与红色交织在一起，形成绚丽的图案。由于它们的高速，它们似乎是诡异地永恒的，就像被刻在夜色中一样。然后，也许是那些被称为“幽灵”的炮艇来了。他们用不可思议的枪支开火，就像巨大的水龙从天空中冲下来，就像上帝在真正生气的时候会做的事情。然后信号弹爆炸，投射出诡异的阴影，用小降落伞飘落，在微风中摇摆，任何移动的人，在它们的光芒下，似乎都是从地狱逃出来的鬼魂。</p>
<p>白天没有这么壮观的景象，但也有它的魅力。很多人都喜欢凝固汽油弹，喜欢它无声的力量，喜欢它能让林木线或房屋自燃般爆炸的方式。但我一直认为凝固汽油弹被高估了，除非你喜欢看轮胎燃烧。我更喜欢白磷，它爆炸时有一种强烈的优雅，将目标包裹在浓烈而飞扬的白烟中，抛出发光的红色彗星，拖着明亮的白色羽翼，我更喜欢它——而不是更讨厌——因为它的功能：破坏，杀戮。战争的诱惑在于它提供了如此强烈的美——脱离了我所有的文明价值，但仍然是美的。</p>
<p>大多数上过战场的男人，和大多数在战场上呆过的女人，都会记得，在他们的一生中，从来没有如此高涨的性欲。简而言之，战争是一种刺激。战争给男人披上了一件外衣，掩盖了他们各自天性的局限和不足。它赋予他们所有的光环，一种集体的力量，一种近乎动物的力量。他们不仅仅是比利、约翰尼或鲍比，他们是士兵！但这一切都要付出代价：战争中痛苦的孤独，一个士兵被切断了他作为一个个体的一切定义——他是真正的无根之人。</p>
<p>军装也是如此，并且当空虚感在深夜袭来的时候，所有这些高度的性欲并不能给他带来多大的安慰。</p>
<p>有很多男人因为这种状况而做出了伟大的决定。我认识一个在越南的海军陆战队员，他是一个非常罕见的人，一个常春藤联盟的毕业生。他也有一个常春藤联盟的妻子，但他却设法爱上了一个几乎不会说英语的越南酒吧女孩。她并不特别吸引人，只是一个努力养家糊口的农家女，他把所有的时间都花在了她身上，他爱上了她——笨拙地非正式地爱上了她，但完全爱上了她。在越南的十二个月结束时，他回国了，和他美丽、聪明、有社会地位的妻子离婚，然后回到越南，向那个酒吧女孩求婚，她接受了。这是一场跨越语言、文化、种族、阶级的巨大鸿沟的婚姻，只有在战争中才能成就。我不确定它是否持续，但如果尽管有很大的困难，我也不会惊讶。</p>
<p>当然，这样的故事有成百上千个。偶然接触的故事，一个男人和一个女人紧紧相拥，在性爱中找到了一些逃避战争可怕现实的方法。战争带给性爱的强度，“让我们现在去爱，因为可能没有明天”，是建立在死亡的基础上的。不管我们在战场上的武器是什么，爱情终究是我们对抗死亡的唯一武器。性是生命的武器，像游击队一样派出的精子，穿透卵子的防线，才是真正重要的胜利。战争把你推入寂寞之井，死亡在你耳边呼吸。性是一个抓钩，把你拉出来，结束你的孤独，让你重新与生命融为一体。</p>
<p>并不是说这样的念头在任何地方都是有意识的。我记得上战场时，包里塞了一本《战争与和平》和《帕尔马修道院》。它们很快就被《零的故事》（<em>The Story of 0</em>）取代了。战争让人食欲大增。我无法形容对糖果、对味道的渴望。我想吃玛氏巧克力棒想到胜过我生命中的一切。并且这种饥饿感在推动它的力量面前相形见绌。对女人来说也是如此，任何女人：我们甚至不会在和平中看一眼的女人飘进了我们的幻想中并停留在了那里。太多时候，我们把幻想变成了现实，总是会失望，饥饿感又变会更强。最丑陋的妓女专门从事群体性的事务，在几个男人甚至整个小队之间传递，几乎是在共融，并且比起性更多是一种分享。我甚至可以在性爱中比杀戮中更多看到那只野兽用后脚蹲着流口水，可以看到它嘲笑我的弱点，知道我因为弱点而痛恨自己却又得不到满足，一再重复。</p>
<p>结束战斗之旅后，我回到师部工作，每周有一个晚上义务教越南成年人英语。我的一个学生是一个美丽的女孩，她的父母在1968年的春节攻势中在顺化被杀。她爱上了一个在岘港领事馆工作的美国平民。他离开去了下一个工作地，并答应会派人来接她。她再也没有他的消息。她有一种诱人的忧伤。我发现自己下课后就能见到她，然后我就偷偷摸摸地进入汽车库，征用一辆二吨半卡车<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>，晚上开进岘港去看她。她和她的爷爷奶奶以及兄弟姐妹住在领事馆附近的一栋小房子里。它有一个房间，用窗帘隔开。当我到达时，家里的其他人都会躲在窗帘后面。在他们低沉的声音和烹调油及腐烂鱼的气味中，我们会互相交谈，向对方摸索着前进，我的需求大于她的需求。</p>
<p>我拼命地想要她。但她的温柔和脆弱，她那破碎的美丽之花，挫败了我的色欲。我没有把她看作是一个越南人，我把她看作是所有的越南人。她是战争中受苦的灵魂，而我是伤了它的士兵，但会去修复它。我的孤独感把我拉进了那股强大的潮流中。那股潮流吞噬了我的朋友，他娶了那个酒吧女孩。我可以看到它的发生，但我似乎无力阻止它。我给她写了长诗，打听了留在岘港的事情，为我们两个人构建了一个幻想的未来。我不会像另一个美国人那样背叛她，像所有的美国人那样，像所有的男人背叛在战争中帮助他们的女人那样。我不是那样的人。但后来我接到命令，让我提前两周回家。我开车去岘港去找她谈话，并制定明确的计划。到了半路，我又折返回来。</p>
<p>在机场，我把诗扔进了垃圾桶。当飞机的轮子从越南的土地上升起的时候，我像其他人一样欢呼。当我把脸贴在窗户上，看着越南缩成一片遥远的绿色模糊，最后消失时，我感到悲伤和内疚——为她，为我那些死伤的战友，为一切。但这种感觉被我巨大的解脱感所压倒。我活了下来。而我要回家了。我又可以做回我自己了，我是这么想的。</p>
<p>但大约15年后，她和战争仍然在我的脑海里，所有这些记忆，每一个都有它的秘密通道和切口，数以百计的迷宫，都会回到一个不安全但至关重要的真理。这就是我们为何而爱与恨，为什么我们可以带来生命，也可以扼杀生命，<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>为什么我们每个人都是一个战场，善与恶总是在为我们的灵魂而战。</p>
<p>战争的力量，就像爱的力量一样，来自人的内心。一个产生死亡，另一个产生生命。但是，没有死亡的生命没有意义；在最深层次上，没有战争的爱也没有意义。如果没有战争，我们就不知道爱是从什么深处升起的，也不知道它一定有什么力量来克服这样的邪恶，救赎我们。人爱战争不是偶然的，因为爱和战争是人的核心。我们不仅要相爱，而且要死亡。我们必须相爱，也必须死亡。战争和死亡一样，始终与我们同在，是一个永恒的伴侣，一个秘密的分享者。为了拒绝它的诱惑，为了战胜死亡，我们对和平的爱，对生命本身的爱，必须比我们想象的更大，甚至比我们能想象的更大。</p>
<p>希尔斯和我在佛蒙特州的一座山上滑雪，毫不费力地飞过一个披着白色外衣的世界，美丽、纯真、和平。在滑雪缆车上，我们一直在谈论一个不同的世界，炎热、绿色、散发着腐烂和死亡的气息，走出泥泞的每一步都要费尽全力。我们停下脚步，回头看了看，空气纯净而冰冷，我们的呼吸都是一阵阵的水汽。我们的孩子们正跟着我们下山，弯着腰，生命的小球在危险的边缘奔跑。</p>
<p>海尔斯转过身来，微笑着对我说："从南国到这里很远吧？"</p>
<p>是的。</p>
<p>也不是。</p>
<hr />
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>William Broyles, "Jr. Why Men Love War". Nov. 1, 1984. https://www.esquire.com/news-politics/news/a28718/why-men-love-war/<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>圣洛（Saint-Lô），法国西北市镇。在第二次世界大战中成为德军与美军的战场。<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>格林纳达（Grenada），加勒比海西印度群岛国家。在 1983 年因为亲近苏联和古巴遭美军入侵。<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>原文为：“... while the rest of us careered off in the truck.”，似乎将“carried off”拼错，变成了“careered off”。<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>原文为：“For every time that I didn't salute...”，“I”似乎是笔误，应为“he”。<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>原文为：“And those gooks a just waiting for us to salute...”，gook 是对东南亚人的蔑称。<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>原文为：“Praxiteles Swan”，应该指代 John W. Thomason 所著的 <em>The Reverend Praxiteles Swan</em> 一书中的主角，是一名南北战争中的联邦军上尉。著名形象为一手持《圣经》，一手持枪。如果此处译为“联邦军上尉”会与后文重复，便只译为“联邦军人”。<a href="#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>原文分别为“hooch”和“gook”，都是对越南人使用的蔑称。这里翻译为“猴窝”和“猴子”。<a href="#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>原文为：“deuce-and-a-half truck”， 是一种美军在二战时开始使用的卡车，可以承载二又二分之一美吨的货物并因此得名。<a href="#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p>原文为：“why we can bring forth Fe and snuff it out”， 这里的“Fe”似乎是扫描错误，“life”（生命）更为合适。<a href="#fnref10" class="footnote-back">↩</a></p></li>
</ol>
</section>
]]></content>
      <tags>
        <tag>translation</tag>
      </tags>
  </entry>
  <entry>
    <title>相册</title>
    <url>/gallery/index.html</url>
    <content><![CDATA[<div style="text-align: center; font-size: 2em">
<span style="color: #ffdd00; font-size: 2em">⚠ </span> <span style="color: #ffdd00; font-size: 2em; ">施=====工=====中</span> <span style="color: #ffdd00; font-size: 2em"> ⚠</span>
</div>
]]></content>
  </entry>
  <entry>
    <title>应用</title>
    <url>/apps/index.html</url>
    <content><![CDATA[<p>这里是一些小应用。由于博客是静态网页，所以这些应用无需上传任何数据。</p>
<h3 id="应用列表">应用列表</h3>
<ul>
<li><a href="webp_converter">WEBP 转换器 / WEBP Converter</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>书单</title>
    <url>/booklist/index.html</url>
    <content><![CDATA[<div style="text-align: center">
<table>
<tr>
<th style="text-align: center">
<img width="200px" src="https://raw.githubusercontent.com/LucunJi/LucunJi.github.io/master/booklist/covers/cypher-punk.jpg">
</th>
<th style="text-align: center">
<img width="200px" src="https://raw.githubusercontent.com/LucunJi/LucunJi.github.io/master/booklist/covers/basic-writings.jpg">
</th>
<th style="text-align: center">
<img width="200px" src="https://raw.githubusercontent.com/LucunJi/LucunJi.github.io/master/booklist/covers/a-history-of-western-thought.jpg">
</th>
<th style="text-align: center">
<img width="200px" src="https://raw.githubusercontent.com/LucunJi/LucunJi.github.io/master/booklist/covers/the-human-use-of-human-beings.jpg">
</th>
</tr>
<tr>
<th style="text-align: center">
<i>密码朋克</i><br>朱利安·阿桑奇
</th>
<th style="text-align: center">
<i>Basic Writings</i><br>Jane-Paul Satre
</th>
<th style="text-align: center">
<i>西方哲学史</i><br>奎纳尔·希尔贝克
</th>
<th style="text-align: center">
<i>The Human Use of Human Beings</i><br>Norbert Wiener
</th>
</tr>
</table>
</div>
]]></content>
  </entry>
</search>
